Title,Category,Description,Query ,Author,Published,Modified
Logon Types within a Windows Environment (with logon count) -,WinEventLog:Security,This query will identify logon types within a windows environment and list the number of logons associated with each type. ,"source=""WinEventLog:security"" | eval LogonType=case(Logon_Type=""2"", ""Local Console Access"", Logon_Type=""3"", ""Accessing Network Folders or Files"", Logon_Type=""4"", ""Scheduled Task, Batch File, or Script"", Logon_Type=""5"", ""Service Account"", Logon_Type=""7"", ""Local Console Unlock"", Logon_Type=""8"", ""Network User Logon"", Logon_Type=""9"", ""Program launched with RunAs using /netonly switch"", Logon_Type=""10"", ""Remote Desktop via Terminal Services"", Logon_Type=""11"", ""Mobile Access or Network Domain Connection Resumed"") | top limit=15 LogonType | eval percent = round(percent,2) . "" %""",Go Splunk,2014-10-07,2014-10-07
Number of Accounts Created in a Windows Environment -,WinEventLog:Security,Account Creation Gauge used to indicate number of accounts created in a Windows environment. EventCodes (EventID’s) used are for server 2003/XP and newer. Modify the gauge to fit your environment’s needs. ,"sourcetype=WinEventLog:Security (EventCode=624 OR EventCode=4720) | eval NewAccount=case(EventCode=624, ""New Account Created"", EventCode=4720, ""New Account Created"") | stats count(NewAccount) as creation | gauge creation 1 5 15 25",Go Splunk,2014-10-07,2014-10-07
Gauge of Windows Successful Logons -,WinEventLog:Security,Gauge of Windows Successful Logons. Adjust the gauge to meet your needs. ,"source=""WinEventLog:security"" (EventCode=528 OR EventCode=540 OR EventCode=4624) | stats count(user) as Success_Logon | gauge Success_Logon 1 1000",Go Splunk,2014-10-07,2014-10-07
Gauge of Windows Failed Logons -,WinEventLog:Security,Gauge of Windows Failed Logons. Adjust the gauge to meet your environments needs. ,"sourcetype=""WinEventLog:Security"" (""EventCode=4625"") OR (""EventCode=529"" OR ""EventCode=530"" OR ""EventCode=531"" OR ""EventCode=532"" OR ""EventCode=533"" OR ""EventCode=534"" OR ""EventCode=535"" OR ""EventCode=536"" OR ""EventCode=537"" OR ""EventCode=539"") (Logon_Type=*) | stats count(user) as Failed_Logon | gauge Failed_Logon 1 25 50 150",Go Splunk,2014-10-07,2014-10-07
Escalation of Privileges in a Windows Environment by User -,WinEventLog:Security,Escalation of Privileges in a Windows Environment by user. ,"sourcetype=""WinEventLog:Security"" (EventCode=576 OR EventCode=4672 OR EventCode=577 OR EventCode=4673 OR EventCode=578 OR EventCode=4674) | stats count by user",Go Splunk,2014-10-07,2014-10-07
Password changes in a Windows environment by user account -,WinEventLog:Security,Password changes in a Windows environment by user account. ,"sourcetype=""WinEventLog:Security"" (EventCode=628 OR EventCode=627 OR EventCode=4723 OR EventCode=4724) | chart count by user",Go Splunk,2014-10-07,2014-10-07
Accounts Deleted via EventID's that Correspond with Post XP/2003 Operating Systems -,WinEventLog:Security,"This query will search for accounts deleted via EventID’s that correspond with post XP/2003 operating systems. It will output the admin account, account deleted, details about the action, and the machine that the account deletion took place on. ","sourcetype=WinEventLog:Security (EventCode=630) |eval Date=strftime(_time, ""%Y/%m/%d"")| stats count by User, Target_Account_Name, name, host, index Date | rename User as ""Administrator Account"" | rename Target_Account_Name as ""Account Name Deleted"" | rename name as ""Detailed Information"" |rename host as ""Computer the Account was Created on"" | rename index as ""Index of origin""| sort - Date Target_User_Name_as_user,Primary_User_Name_as_user,Target_Account_Name_as_user,New_Account_Name_as_user,Account_Name_as_user,User_Name_as_user,User_as_user",Go Splunk,2014-10-07,2014-10-07
Security Access granted to an Account -,WinEventLog:Security,Like most windows security logs there are two formats depending on which version of windows you are running. The query for a Windows 7 / Server 2008 and newer looks like this: ,"sourcetype=""WinEventLog:Security"" EventCode=4717 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by src_user, user, Access_Right, Date, Keywords |rename src_user as ""Source Account"" | rename user as ""Target Account"" | rename Access_Right as ""New Rights Granted"" sourcetype=""WinEventLog:Security"" EventCode=621 Account_Modified!=""%{*"" | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by User_Name, Account_Modified, Access_Granted, Date, action |rename User_Name as ""Source Account"" | rename Account_Modified as ""Target Account"" | rename Access_Granted as ""New Rights Granted""",SplunkNinja,2014-10-31,2014-10-31
System Security Access Removed from Account -,WinEventLog:Security,The following queries will list security access that was removed from an account in a Windows environment. Queries look different depending on which version of Windows you are running as the syntax and the EventID’s changed after 2003. Windows Server 2008 and newer: ,"sourcetype=""WinEventLog:Security"" EventCode=4718 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by src_user, user, Access_Right, Date, Keywords |rename src_user as ""Source Account"" | rename user as ""Target Account"" | rename Access_Right as ""Rights Removed"" sourcetype=""WinEventLog:Security"" EventCode=622 Account_Modified!=""%{*"" | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by User_Name, Account_Modified, Access_Removed, Date, action |rename User_Name as ""Source Account"" | rename Account_Modified as ""Target Account"" | rename Access_Removed as ""Rights Removed""",SplunkNinja,2014-10-31,2014-10-31
Console Lock Duration -,WinEventLog:Security,The following code works only in windows 2008 and newer operating systems: ,"sourcetype=WinEventLog:Security (EventCode=4800 OR EventCode=4801) | eval Date=strftime(_time, ""%Y/%m/%d"") | transaction host Account_Name startswith=EventCode=4800 endswith=EventCode=4801 | eval duration = duration/60 | eval duration=round(duration,2)| table host, Account_Name, duration, Date |rename duration as ""Console Lock Duration in Minutes"" | sort - date",SplunkNinja,2014-11-07,2014-11-07
Windows Power Off Duration -,WinEventLog:System,This query will indicate the time it took between a computer shutdown and a computer powering back on. Typically found in restarts and shutdowns. This would not occur during a hard-reset or loss of power. ,"sourcetype=WinEventLog:System (EventCode=6005 OR EventCode=6006) | transaction host startswith=""EventCode=6006"" endswith=""EventCode=6005"" | eval restart_duration=tostring(duration,""duration"") | eval Date=strftime(_time, ""%Y/%m/%d"")| where duration > 480 | table host index Date restart_duration | sort - Date | rename restart_duration as ""Restart Duration""",SplunkNinja,2014-11-10,2014-11-10
Time between rights granted and rights revoked -,WinEventLog:Security,"This query outputs a table that indicates the time difference between Rights granted and Rights revoked. Modify the maxspan time within the transaction function to meet your environments needs. Regex is used here, and is part of the query. Windows 2008 and newer: ","sourcetype=WinEventLog:Security (EventCode=4717 OR EventCode=4718) | rex ""Access\sGranted:\s+Access\sRight:\s+(?\w+)""| rex ""Access\sRemoved:\s+Access\sRight:\s+(?\w+)""| eval Rights=coalesce(RightGranted,RightRemoved) | eval status=case(EventCode=4717, ""New Rights Granted by:"", EventCode=4718, ""Rights Removed by:"")| transaction Rights user startswith=""Granted"" endswith=""Removed"" |where duration > 0| eval duration = duration/60 |eval n=round(duration,2) | eval Date=strftime(_time, ""%Y/%m/%d"") | table Date, host, status, Security_ID, user, Rights, n |rename Security_ID as ""Source Account"" | rename user as ""Target Account"" | rename n as ""Minutes between Rights Granted Then Removed"" | sort - date sourcetype=WinEventLog:Security (EventCode=608 OR EventCode=609) | rex ""Message=User\sRight\sAssigned:\s+User\sRight:\s+(?\w+)""| rex ""Message=User\sRight\sRemoved:\s+User\sRight:\s+(?\w+)""| eval Rights=coalesce(RightGranted,RightRemoved) | eval status=case(EventCode=608, ""New Rights Granted by:"", EventCode=609, ""Rights Removed by:"")| transaction Rights user startswith=""Assigned"" endswith=""Removed"" |where duration > 0| eval duration = duration/60 |eval n=round(duration,2) | eval Date=strftime(_time, ""%Y/%m/%d"") | table Date, host, status, User, user, Rights, n | rename User as ""Source Account"" | rename user as ""Target Account"" | rename n as ""Minutes between Rights Granted Then Removed"" | sort - date",SplunkNinja,2014-11-10,2014-11-10
Windows Time Change -,WinEventLog:Security,"This query will list all users who initiated a time change. System accounts change time automatically, as such I’ve ignored system accounts from the query output. Windows 2008 and newer: ","sourcetype=WinEventLog:Security EventCode=4616 Account_Name!=""*$"" Account_Name!=""LOCAL SERVICE""| stats count by Account_Name sourcetype=WinEventLog:Security user!=""*$"" user!=""LOCAL SERVICE"" EventCode=520 | stats count by user",SplunkNinja,2014-11-10,2014-11-10
Accounts Enabled -,WinEventLog:Security,This query will return results on all accounts enabled for a given time range. It is using EventCodes for windows 2008 and newer operating systems: ,"sourcetype=WinEventLog:Security (EventCode=4722) | stats count by index, user, host, name",ItsJohnLocke,2014-11-12,2014-11-12
Accounts Disabled -,WinEventLog:Security,This query will return results for accounts disabled on a windows 2008 or newer operating system for a given time range: ,"sourcetype=WinEventLog:Security (EventCode=4725) | stats count by index, user, host, name",ItsJohnLocke,2014-11-12,2014-11-12
Detailed list of Universal Forwarders Reporting to Indexer -,splunkd,The following query will list in detail information on the universal forwarders checking into the indexer. I’ve renamed some of the fields to be more user-friendly. ,"index=_internal sourcetype=splunkd destPort!=""-""| stats sparkline count by hostname, sourceHost, host, destPort, version | rename destPort as ""Destination Port"" | rename host as ""Indexer"" | rename sourceHost as ""Universal Forwarder IP"" | rename version as ""Splunk Forwarder Version"" | rename hostname as ""Universal Forwarder Host Name"" | rename sparkline as ""Traffic Frequency"" | sort - count",SplunkNinja,2014-11-13,2014-11-13
Total Number of Hosts reporting in. -,splunkd,This query will list the total number of hosts reporting to the indexer for any specified time range. This only works for universal forwarders. If you have hosts reporting in over syslog (typically port 514) they will not be listed. ,"index=_internal sourcetype=splunkd | stats dc(hostname) as ""Number of Hosts""",SplunkNinja,2014-11-13,2014-11-13
Microsoft AntiMalware Scan Completion -,WinEventLog:System,"This query lists a count by scan type, duration of scan, and the host the scan took place on. Modify as needed. ","sourcetype=""WinEventLog:System"" SourceName=""Microsoft Antimalware"" EventCode=1001 | stats count by Scan_Type, Scan_Time, host",SplunkNinja,2014-11-17,2014-11-17
Microsoft Antimalware Malware Detection Details -,WinEventLog:System,"This query will return results if malware is detected, and return detailed information on the Malware detected. ","sourcetype=""WinEventLog:System"" SourceName=""Microsoft Antimalware""  EventCode=1116 |eval Date=strftime(_time, ""%Y/%m/%d"")| stats count by host, Category, Name, Path, Severity, Date",SplunkNinja,2014-11-17,2014-11-17
Microsoft Antimalware Virus Remediation Details -,WinEventLog:System,This query will return detailed results on malware/virus remediation. ,"sourcetype=""WinEventLog:System"" SourceName=""Microsoft Antimalware"" EventCode=1117 |eval Date=strftime(_time, ""%Y/%m/%d"")| stats count by host, Category, Name, Severity, Date, Action_Status",SplunkNinja,2014-11-17,2014-11-17
Average CPU Usage on a Windows box -,Perfmon:CPU Load,This query will return the average CPU usage by minute. ,"sourcetype=""Perfmon:CPU Load"" | bucket _time span=1m | stats avg(Value) by _time",SplunkNinja,2014-11-17,2014-11-18
Available Disk Space on a Windows Box -,Perfmon:Free Disk Space,This splunk query will return available disk space in Gigabytes. ,"sourcetype=""Perfmon:Free Disk Space"" | bucket _time span=1d | eval gigabytes=(Value/1024) | stats avg(gigabytes) by _time",SplunkNinja,2014-11-18,2014-11-18
Median Duration of a Session within an IIS Web Environment -,IIS,This query will report back the median duration of a session within an IIS web environment. The time format will be HH:MM:SS ,"sourcetype=""iis"" | stats range(_time) as duration by JSESSIONID | stats median(duration) as AVD | fieldformat AVD=tostring(AVD,""duration"") | eval AVD=round(AVD, 0)",Go Splunk,2014-10-07,2014-11-18
Average Duration of a Session within an IIS Web Environment -,IIS,This query will report back the average duration of a session within an IIS web environment. The time format will be HH:MM:SS ,"sourcetype=""iis"" | stats range(_time) as duration by JSESSIONID | stats avg(duration) as AVG | fieldformat AVG=tostring(AVG,""duration"") | eval AVG=round(AVG, 0)",Go Splunk,2014-10-07,2014-11-18
Network Usage by KB per minute on a Windows Box -,Perfmon:Network Interface,The following query will return average network usage per minute by Kilobyte: ,"sourcetype=""Perfmon:Network Interface"" | bucket _time span=1m | eval KB=(Value/1024) | stats avg(KB) by _time",SplunkNinja,2014-11-18,2014-11-18
Real Time IIS Web Site Connections -,IIS,"Assuming JSESSIONID is auto-extracted, run the following REAL-TIME search (choose your window, I typically go with 5 minutes): ","sourcetype=""iis"" | stats dc(JSESSIONID)",SplunkNinja,2014-11-18,2014-11-18
Successful Login to OSX -,osx_secure,The following splunk query (with regex) will return a result of users who have successfully authenticated to an OSX machine: ,"sourcetype=osx_secure | rex ""authinternal\sauthenticated\suser\s(?\S+)"" |eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by USER, host, Date | sort - count",ItsJohnLocke,2014-11-20,2014-11-20
Failed Login to OSX -,osx_secure,The following splunk query will return results on users who made unsuccessful attempts to login to an OSX machine: ,"sourcetype=osx_secure | rex ""authinternal\sfailed\sto\sauthenticate\suser\s(?\S+)"" |eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by USER, host, Date | sort - count",ItsJohnLocke,2014-11-20,2014-11-20
List of Source Names and Frequency of Events -,Uncategorized,The following splunk query will output a list of all SourceNames in a windows environment and include a sparkline to indicate frequency: ,"eventtype=""windows_events"" sourcetype=""*EventLog:*"" (host=""*"" OR ComputerName=""*"") TaskCategory=""*""  SourceName=""*"" EventCode=""*"" Type=""*""  | stats sparkline as Activity, count by host | sort -count",SplunkNinja,2014-12-01,2014-12-01
Weekend User Activity -,WinEventLog:Security,Run the following (modify user field as needed) to show weekend activity: ,"sourcetype=""WinEventLog:Security"" (date_wday=saturday OR date_wday=sunday) | stats count by Account_Name, date_wday",SplunkNinja,2015-01-19,2015-01-19
Failed Logins Windows -,WinEventLog:Security,Splunk query for all failed logon attempts within a windows environment. ,"sourcetype=""WinEventLog:Security"" (""EventCode=4625"") OR (""EventCode=529"" OR ""EventCode=530"" OR ""EventCode=531"" OR ""EventCode=532"" OR ""EventCode=533"" OR ""EventCode=534"" OR ""EventCode=535"" OR ""EventCode=536"" OR ""EventCode=537"" OR ""EventCode=539"") ",SplunkNinja,2015-02-02,2015-02-02
Time between Account Creation and Account Deletion -,WinEventLog:Security,"Below is the query indicating time (duration) between account creation and account deletion. I have added a range to indicate severity, remove and modify as needed. Windows 2008 and newer: ","sourcetype=WinEventLog:Security (EventCode=4726 OR EventCode=4720) |eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Subject:\s+\w+\s\S+\s+\S+\s+\w+\s\w+:\s+(?<SourceAccount>\S+)"" | rex ""Target\s\w+:\s+\w+\s\w+:\s+\S+\s+\w+\s\w+:\s+(?<DeletedAccount>\S+)"" | rex ""New\s\w+:\s+\w+\s\w+:\s+\S+\s+\w+\s\w+:\s+(?<NewAccount>\S+)"" | eval SuspectAccount=coalesce(DeletedAccount,NewAccount) | transaction SuspectAccount startswith=""EventCode=4720"" endswith=""EventCode=4726"" |eval duration=round(duration/60, 2) | eval Age=case(duration<=240, ""Critical"", duration>240 AND duration<=1440, ""Warning"", duration>1440, ""Normal"")| table Date, index, host, SourceAccount, SuspectAccount, duration, Age | rename duration as ""Minutes Account was Active"" |rename index as ""SSP or Index"" | sort + ""Minutes Account was Active""",SplunkNinja,2015-02-13,2015-02-13
Failed Authentication to Non-existing Accounts -,WinEventLog:Security,This splunk query will return results for failed logon attempts to accounts that do not exist. This has been tested and confirmed on Windows Server 2008 and newer machines: ," source=""WinEventLog:security"" sourcetype=""WinEventLog:Security"" EventCode=4625 Sub_Status=0xC0000064 |eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Which\sLogon\sFailed:\s+Security\sID:\s+\S.*\s+\w+\s\w+\S\s.(?<uacct>\S.*)"" | stats count by Date, uacct, host | rename count as ""Attempts"" | sort - Attempts",SplunkNinja,2015-03-10,2015-03-10
File Accesses in a Windows Environment by user -,WinEventLog:Security,File Accesses in a Windows Environment by user ,"sourcetype=""WinEventLog:Security"" user=* (EventCode=560 OR EventCode=4656) | chart count by Type",Go Splunk,2014-10-07,2015-03-11
Account Modifications in a Windows Environment -,WinEventLog:Security,The following splunk query will give you all permission changes for each user. There are four queries. 1. Windows 2008 Permission Increases: ," sourcetype=WinEventLog:Security (EventCode=4717) | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Access\sGranted:\s+Access\sRight:\s+(?<RightGranted>\w+)"" | rex ""Account\sModified:\s+\w+\s\S+\s+.*\\\(?<AccountModified>.*)"" | stats count by Date, AccountModified, RightGranted, host | sort - Date  sourcetype=WinEventLog:Security (EventCode=4718) | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Access\sRemoved:\s+Access\sRight:\s+(?<RightRemoved>\w+)""| rex ""Account\sModified:\s+\w+\s\S+\s+.*\\\(?<AccountModified>.*)"" | stats count by Date, AccountModified, RightRemoved, host | sort - Date | rename RightRemoved as ""Rights Removed"" | rename AccountModified as ""Account Modified"" sourcetype=WinEventLog:Security EventCode=608 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Message=User\sRight\sAssigned:\s+User\sRight:\s+(?<RightGranted>\w+)"" | rex ""Assigned\sTo:\s+.*\\\(?<AccountModified>.*)"" | stats count by Date, AccountModified, RightGranted, host | sort - Date | rename RightGranted as ""Rights Granted"" | rename AccountModified as ""Account Modified"" sourcetype=WinEventLog:Security EventCode=609 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Message=User\sRight\sRemoved:\s+User\sRight:\s+(?<RightRemoved>\w+)"" | rex ""Removed\sFrom:\s+.*\\\(?<AccountModified>.*)"" | stats count by Date, AccountModified, RightRemoved, host | sort - Date | rename RightRemoved as ""Rights Removed"" | rename AccountModified as ""Account Modified""",ItsJohnLocke,2015-03-11,2015-03-11
Accounts Deleted in a Windows Environment -,WinEventLog:Security,These splunk queries will return deleted accounts in Associated with Windows Environments (NOTE* The 2003 query requires that the splunk for windows app be installed): 2003: ,"sourcetype=WinEventLog:Security (EventCode=630) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Target_Account_Name, Caller_User_Name, Type, host | sort - Date | rename Target_Account_Name as ""Deleted Account"" | rename Caller_User_Name as ""Source Account"" | sort - Date sourcetype=WinEventLog:Security (EventCode=4726) | eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Target\sAccount:\s+.*\s+\w+\s\w+:\s+(?<TargetAccount>.*)"" | rex ""Account\sName:\s+(?<SourceAccount>.*)"" | stats count by Date, TargetAccount, SourceAccount, Keywords, host | sort - Date | rename TargetAccount as ""Deleted Account"" | rename SourceAccount as ""Source Account""",ItsJohnLocke,2015-03-11,2015-03-11
Changes to Windows User Groups by Account -,WinEventLog:Security,This splunk query will return changes to any group in a windows environment. You MUST have the Splunk App for Windows Infrastructure app installed located here: https://apps.splunk.com/app/1680/ Windows Server 2003 and older: ,"sourcetype=WinEventLog:Security (EventCode=636 OR EventCode=632 OR EventCode=650 OR EventCode=655 OR EventCode=660 OR EventCode=665) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Caller_User_Name, Target_Account_Name, host, Type sourcetype=WinEventLog:Security (EventCode=4728 OR EventCode=4732 OR EventCode=4746 OR EventCode=4751 OR EventCode=4756 OR EventCode=4161 OR EventCode=4185) | eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Member:\s+\w+\s\w+:.*\\\(?<TargetAccount>.*)"" | rex ""Account\sName:\s+(?<SourceAccount>.*)"" | stats count by Date, TargetAccount, SourceAccount, Group_Name, host, Keywords | sort - Date | rename SourceAccount as ""Administrator Account"" | rename TargetAccount as ""Target Account""",SplunkNinja,2015-03-13,2015-03-13
New Service Installation on Windows -,WinEventLog:Security,The following splunk query will return results of all new services installed on windows machines (this works on any windows OS tested thus far). Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ ," sourcetype=WinEventLog:Security (EventCode=4697 OR EventCode=601) | eval Date=strftime(_time, ""%Y/%m/%d"") | eval Status=coalesce(Keywords,Type) |stats count by Date, Service_Name, Service_File_Name, Service_Account, host, Status",SplunkNinja,2015-03-13,2015-03-13
Windows File Access Attempts -,WinEventLog:Security,The following splunk queries will display any file access attempts (successful or failed) by user account. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ Windows 2003 and older: ,"sourcetype=""WinEventLog:Security"" EventCode=560 Object_Type=File | eval Date=strftime(_time, ""%Y/%m/%d"") |eval UserName=coalesce(Primary_User_Name, Client_User_Name)| search UserName!=""*$"" AND UserName!=""NETWORK SERVICE""| stats count by Date, Image_File_Name, UserName, Type, host | sort - Date sourcetype=""WinEventLog:Security"" EventCode=4656 Object_Type=File (Security_ID!=""NT AUTHORITY*"") (Security_ID!=""S-*"")| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Account_Name, Process_Name, Keywords, host",SplunkNinja,2015-03-18,2015-03-18
File Deletion Attempts In Windows -,WinEventLog:Security,The following splunk queries will return results based on any user account who attempts to delete a file. This will return both successful and failed attempts. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ Windows 2003 and older: ,"sourcetype=""WinEventLog:Security"" EventCode=564 |eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Image_File_Name, Type, host | sort - Date sourcetype=""WinEventLog:Security"" EventCode=4660 (Security_ID!=""NT AUTHORITY*"") (Security_ID!=""S-*"")| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Account_Name, Process_Name, Keywords, host",SplunkNinja,2015-03-18,2015-03-18
Modification to File Permissions in Windows -,WinEventLog:Security,The following splunk query works on Windows Sever 2008 and newer operating systems. It returns results based on modifications to individual file level permissions. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ ," source=""WinEventLog:Security"" sourcetype=""WinEventLog:Security"" EventCode=4670 (Security_ID!=""NT AUTHORITY*"") (Security_ID!=""S-*"")| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Account_Name, Process_Name, Keywords, host | sort - Date",SplunkNinja,2015-03-18,2015-03-18
Password Non Compliance Windows -,WinEventLog:Security,The following splunk queries will return results for failed attempts to change passwords. This is likely a result of users not meeting password requirements. Be sure to have the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ Windows 2003 and Older: ,"sourcetype=""WinEventLog:Security"" EventCode=627 Type=""Failure Audit""| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Target_Account_Name, host | sort - Date sourcetype=""WinEventLog:Security"" EventCode=4723  Keywords=""Audit Failure"" | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Target\sAccount:\s+Security\sID:.*\\\(?<account>\S+)"" | stats count by Date, account, host | sort - Date",SplunkNinja,2015-03-23,2015-03-23
Verify Windows Updates have been Applied -,WinEventLog:System,The following splunk query will return results on any Windows Updates (Patches) that have been applied by searching for the KB value associated with the EventID.   ,"sourcetype=WinEventLog:System EventCode=19 | eval Date=strftime(_time, ""%Y/%m/%d"")| rex ""\WKB(?<KB>.\d+)\W"" |stats count by Date, host, KB",SplunkNinja,2015-04-02,2015-04-02
Start a Windows Service -,WinEventLog:Application,This Splunk Query will return results for any Windows Service that has started. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ ,"sourcetype=WinEventLog:Application EventCode=105 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, SourceName, host | sort - Date | fields - count",SplunkNinja,2015-04-06,2015-04-06
Shutdown or Suspend a Service in Windows -,WinEventLog:Application,This splunk query will return results for any Windows Service that has been stopped. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ ,"sourcetype=WinEventLog:Application EventCode=108 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, SourceName, host | sort - Date | fields - count",SplunkNinja,2015-04-06,2015-04-06
Failed Attempt to Initiate Remote Desktop Session -,WinEventLog:Security,This splunk query will return any failed attempts initiated by users to launch an RDP (remote desktop) session in a Windows environment. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ Windows Server 2008 and Newer: ,"source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 EventCode=4625 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Failed:\s+.*\s+Account\sName:\s+(?<TargetAccount>\S+)\s"" | stats count by Date, TargetAccount, Failure_Reason, host source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 (EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, User_Name, Reason, host",SplunkNinja,2015-04-09,2015-04-08
Account Enabled in Windows -,WinEventLog:Security,The following Splunk queries will show any accounts that have been enabled from a previously disabled state. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/ Windows Server 2008 and Newer: ,"sourcetype=WinEventLog:Security (EventCode=4722) | eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""ID:\s+\w+\\\(?<sourceaccount>\S+)\s+"" | rex ""Account:\s+Security\sID:\s+\w+\\\(?<targetaccount>\S+)\s+"" | stats count by Date, sourceaccount, targetaccount, Keywords, host | rename sourceaccount as ""Source Account"" | rename targetaccount as ""Target Account"" | sort - Date sourcetype=WinEventLog:Security (EventCode=626) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Caller_User_Name, Target_Account_Name, Type, host | sort - Date",SplunkNinja,2015-04-09,2015-04-08
USB and Removable Media Detection -,WinRegistry,This splunk query will show information about USB mass storage device uses. You must be monitoring the registry using the Windows Technology Add-on (TA). ,"sourcetype=WinRegistry key_path=""HKLM\\system\\controlset*\\enum\\usbstor\\*""  registry_type=CreateKey | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"") | rex ""key_path.*usbstor\S(?<DeviceType>.*)&ven\S(?<Vendor>.*)&prod\S(?<Product>\S*)&rev\S""   | stats  count by Date, host, Vendor, Product, DeviceType   | fields  - count   | sort  - Date",SplunkNinja,2014-11-25,2015-04-08
Removal of USB Storage Device -,WinRegistry,This query will detect if any USB storage device was removed from a Windows machine (confirmed on Windows 7). ,"sourcetype=WinRegistry key_path=""HKLM\\system\\controlset*\\enum\\usbstor\\*""  process_image=""c:\\Windows\\System32\\svchost.exe""  registry_type=DeleteKey | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"") | rex ""key_path.*usbstor\S(?<DeviceType>.*)&ven\S(?<Vendor>.*)&prod\S(?<Product>\S*)&rev\S"" | stats count by Date, host, Vendor, Product, DeviceType   | fields  - count   | sort  - Date",SplunkNinja,2015-04-09,2015-04-08
List of Users in a Linux Environment -,linux_secure,The following splunk query will ouput a list of user accounts appearing in linux_secure audit logs: ,"sourcetype=linux_secure | rex ""\suser[^'](?<User>\S+\w+)"" | stats count by User",SplunkNinja,2015-04-14,2015-04-14
Count of Unique Users in a Linux Environment -,linux_secure,This splunk query will return the total number of unique users in a given time range.   ,"sourcetype=linux_secure | rex ""\suser[^'](?<User>\S+\w+)"" | stats dc(User)",SplunkNinja,2015-04-17,2015-04-17
Top 10 most active Users in Linux -,linux_secure,The following splunk query example will return the top 10 most active users in a given time range   ,"sourcetype=linux_secure | rex ""\suser[^'](?<User>\S+\w+)"" | top limit=10 User",SplunkNinja,2015-04-17,2015-04-17
List of Hosts in a Linux Environment -,linux_secure,The following splunk query example will return a list of hosts by hostname in a given time range. *NOTE* if the host field is being autoextracted (for instance if you are using a universal forwarder) you will not need the regex command and can call upon the auto extracted fieldname of “host” ,"sourcetype=linux_secure |rex "".*:\d{2}\s(?<hostname>\S+)"" | stats count by hostname",SplunkNinja,2015-04-17,2015-04-17
Count of Unique Hosts in Linux -,linux_secure,The following splunk query example will return a unique count of hosts in a given time range *NOTE* if the host field is being autoextracted (for instance if you are using a universal forwarder) you will not need the regex command and can call upon the auto extracted fieldname of “host” ,"sourcetype=linux_secure |rex "".*:\d{2}\s(?<hostname>\S+)"" | stats dc(hostname)",SplunkNinja,2015-04-17,2015-04-17
Top 10 Most Active Hosts in a Linux Environment -,linux_secure,The following splunk query example will return the top 10 most active hosts in a given time range. Active in this instance is determined simply the number of log entries. *NOTE* if the host field is being autoextracted (for instance if you are using a universal forwarder) you will not need the regex command and …,"sourcetype=linux_secure |rex "".*:\d{2}\s(?<hostname>\S+)"" | top limit=10 hostname",SplunkNinja,2015-04-17,2015-04-17
Number of Hosts the Root Account was Detected on -,linux_secure,The following splunk query example will return the total number of hosts the Root account was detected on  in a given time range *NOTE* if the host field is being autoextracted (for instance if you are using a universal forwarder) you will not need the regex command and can call upon the auto extracted fieldname …,"sourcetype=linux_secure |rex "".*:\d{2}\s(?<hostname>\S+)"" | rex ""\suser[^'](?<User>\S+\w+)"" | search User=""root"" | stats dc(hostname)",SplunkNinja,2015-04-17,2015-04-17
Escalation of Privileges via SU in Linux -,linux_secure,"The following splunk query example will return a list of users who escalated privileges on any host in a given time range. The query will count by day, if you need to count in a shorter or longer time range modify the “Date=strftime” value below. *NOTE* if the host field is being autoextracted (for instance …","sourcetype=linux_secure source=""/var/log/*"" ""su: (""  | eval Date=strftime(_time, ""%Y/%m/%d"") | rex "".*:\d{2}\s(?<hostname>\S+)"" | rex ""su:\s\Sto\sroot\S\s(?<SU>\S+)""  | stats  count by Date, hostname, SU  | rename  count as ""Occurrences""  | rename  SU as ""Account with Escalated Privileges"" | sort - Date",SplunkNinja,2015-04-17,2015-04-17
Failed Windows Remote Desktop Connection Attempt -,WinEventLog:Security,"The following splunk query example will return results on any Windows remote desktop connection attempts. This could be a result of a bad password, invalid user name, or any number of other reasons. Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/   Windows Server 2008 and Newer: ","source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 EventCode=4625 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Failed:\s+.*\s+Account\sName:\s+(?<TargetAccount>\S+)\s"" | stats count by Date, TargetAccount, Failure_Reason, host | sort - Date source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 (EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | eval Date=strftime(_time, ""%Y/%m/%d"") | sort - Date",SplunkNinja,2015-04-20,2015-04-20
Accounts Deleted within 24 Hours of Creation -,WinEventLog:Security,"This splunk query unmodified will return results on any account regardless of duration, however it uses an “eval case” argument to determine what is “critical” (such as accounts deleted within a day of being created) or what is simply note worthy (normal behavior). Ensure the Splunk App for Windows is installed grab it here: https://apps.splunk.com/app/742/   …","sourcetype=WinEventLog:Security (EventCode=4726 OR EventCode=4720) |eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Subject:\s+\w+\s\S+\s+\S+\s+\w+\s\w+:\s+(?<SourceAccount>\S+)"" | rex ""Target\s\w+:\s+\w+\s\w+:\s+\S+\s+\w+\s\w+:\s+(?<DeletedAccount>\S+)"" | rex ""New\s\w+:\s+\w+\s\w+:\s+\S+\s+\w+\s\w+:\s+(?<NewAccount>\S+)"" | eval SuspectAccount=coalesce(DeletedAccount,NewAccount) | transaction SuspectAccount startswith=""EventCode=4720"" endswith=""EventCode=4726"" |eval duration=round(((duration/60)/60)/24, 2) | eval Age=case(duration<=1, ""Critical"", duration>1 AND duration<=7, ""Warning"", duration>7, ""Normal"")| table Date, index, host, SourceAccount, SuspectAccount, duration, Age | rename duration as ""Days Account was Active"" | sort + ""Days Account was Active"" sourcetype=WinEventLog:Security (EventCode=630 OR EventCode=624) |eval Date=strftime(_time, ""%Y/%m/%d"") | transaction Target_Account_Name startswith=""EventCode=624"" endswith=""EventCode=630"" |eval duration=round(((duration/60)/60)/24, 2) | eval Age=case(duration<=1, ""Critical"", duration>1 AND duration<=7, ""Warning"", duration>7, ""Normal"")| table Date, index, host, Caller_User_Name, Target_Account_Name, duration, Age | rename duration as ""Days Account was Active"" | sort - Date",SplunkNinja,2015-04-20,2015-04-20
Linux Cron Job Information -,Cron,This splunk query example uses regex (regular expressions) to extract information on Linux cron jobs. *Note* this query has not been extensively tested ,"sourcetype=""cron"" | eval Date=strftime(_time, ""%Y/%m/%d"") | rex "".*:\d{2}\s(?<hostname>\S+)"" | rex ""]:\sfinished(?<Info>.*)""  | stats count by Date, hostname, Info",SplunkNinja,2015-04-20,2015-04-20
Windows Failed Logons with Average Overlay -,WinEventLog:Security,This Splunk search will show any failed login attempt and graphically overlay an average value.   ,"sourcetype=""WinEventLog:Security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=4625 OR EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | timechart count(EventCode) as count | eventstats avg(count) as Average | eval average=round(average,0) | rename count as ""Failed Logons""",ItsJohnLocke,2015-04-24,2015-04-24
Successful Windows Logons with Average Overlay -,WinEventLog:Security,The following Splunk query will display successful windows logins and overlay an average on visualizations. ,"sourcetype=""WinEventLog:Security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=528 OR EventCode=540 OR EventCode=4624) | timechart count(EventCode) as count | eventstats avg(count) as Average | eval average=round(average,0) | rename count as ""Successful Logons""",ItsJohnLocke,2015-04-24,2015-04-24
Clearing of Windows Audit Logs -,WinEventLog:Security,"This Splunk search will show anytime the windows audit logs (event viewer logs) have been cleared or deleted. Ensure the Splunk App for Windows is installed, you can grab it here: https://apps.splunk.com/app/742/ ","source=WinEventLog:security (EventCode=1102 OR EventCode=517) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Client_User_Name, host, index, Date | sort - Date | rename Client_User_Name as ""Account Name""",ItsJohnLocke,2015-04-24,2015-04-24
Unintended Windows Shutdowns -,WinEventLog:System,"This splunk query will show any unintended Windows system Shutdowns. Ensure the Splunk App for Windows is installed, you can grab it here: https://apps.splunk.com/app/742/ ","sourcetype=""WinEventLog:system"" EventCode=6008 | eval Date=strftime(_time, ""%Y/%m/%d"") | table  Date host, index, Message  | sort  - Date",ItsJohnLocke,2015-04-24,2015-04-24
List of Legitimate Account Names in Windows -,WinEventLog:Security,"This splunk query will list all successful logins by account name for a given time range. This query will work on a variety of Windows Operating systems to include XP, 2003, Vista, 2008, 7, 8, and server 2012. I’ve tested in some capacity in Windows 10 for some of my queries, so far they appear …","source=""WinEventLog:security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=528 OR EventCode=540 OR EventCode=4624) | rex ""New\sLogon:\s+.*\s+Account\sName:\s+(?<UserName>\S+)"" | eval Account=coalesce(User_Name,UserName) | stats count by Account | sort - count",ItsJohnLocke,2015-04-24,2015-04-24
Comparing Stats Time Over Time -,_internal,,"index=_internal earliest=-48h latest=-24h | bin _time span=10m | stats count by _time | eval window=""yesterday"" | append [search index=_internal earliest=-24h | bin _time span=10m | stats count by _time | eval window=""today"" | eval _time=(_time-(60*60*24))] | timechart span=10m sum(count) by window",kfeagans,2015-04-28,2015-04-28
Clean or Delete Data in a given Source -,Uncategorized,The following Splunk query will wipe or clear a data source. Ensure you specify an index else it will wipe the given source for all indexes. ,source=path\to\sourcename | delete,SplunkNinja,2015-05-01,2015-05-01
Repeated Unsuccessful Logon Attempts in Linux -,linux_secure,"The following Splunk search query will return results for failed login attempts in a Linux environment for a specified time range. The regular expressions are defined within the search string, however if you already extracted the necessary fields you can ignore the regex section.   ","sourcetype=linux_secure | eval Date=strftime(_time, ""%Y/%m/%d"") | rex "".*:\d{2}\s(?<hostname>\S+)"" | rex ""gdm\S+\sauthentication\s(?<status>\w+)"" | rex ""\suser[^'](?<User>\S+\w+)"" | search status=failure| stats count as fails by Date, User, hostname | eval ""Alert Level""=case(fails>=50, ""Critical"", fails<50 AND fails>=20, ""Warning"", fails<20, ""Normal"") | sort - fails| rename fails as ""Failed Logon Attempts"" | rename User as ""Account in Question""",SplunkNinja,2015-05-01,2015-05-01
Splunk License Gauge -,Uncategorized,This Splunk search query will show current license usage ,"| rest splunk_server=local /services/licenser/pools | rename title AS Pool | search [rest splunk_server=local /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields stack_id] | join type=outer stack_id [rest splunk_server=local /services/licenser/stacks | eval stack_id=title | eval stack_quota=quota | fields stack_id stack_quota] | stats sum(used_bytes) as used max(stack_quota) as total | eval usedGB=round(used/1024/1024/1024,3) | eval totalGB=round(total/1024/1024/1024,3) | eval gauge_base=0 | eval gauge_danger=totalGB*0.8 | eval gauge_top=totalGB+0.001 | gauge usedGB gauge_base gauge_danger totalGB gauge_top",SplunkNinja,2015-05-02,2015-05-02
Splunk License Usage Over the Last 30 Days -,Uncategorized,The following Splunk Search will show license usage over the past 30 days: ,"index=_internal source=*license_usage.log type=""RolloverSummary"" earliest=-30d@d   | eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" fixedrange=false | join type=outer _time [search index=_internal source=*license_usage.log type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | stats latest(stacksz) AS ""stack size"" by _time] | fields - _timediff  | foreach * [eval <<FIELD>>=round('<<FIELD>>'/1024/1024/1024, 3)]",SplunkNinja,2015-05-02,2015-05-02
Rename _time field in a TimeChart -,Uncategorized,When running a timechart splunk search query you may wish to rename the field _time. In order to do this you must first save the search to a dashboard or report. Once saved edit the source and add the following in the panel: ,"<option name=""charting.axisTitleX.text"">Date</option>",SplunkNinja,2015-05-12,2015-05-12
Top 5 Visiting Countries in IIS -,IIS,The following Splunk query will list the top 5 visiting countries using the built in “iplocation” feature in Splunk: ,"sourcetype=""iis"" | iplocation c_ip |top limit=5 Country | eval percent = round(percent,2) . "" %"" | rename count as Views | rename percent as Percent",SplunkNinja,2015-05-16,2015-05-15
Visits by Days of the Week in IIS -,IIS,The following Splunk query will show the number of web visits for each weekday: ,"sourcetype=""iis"" | eval uppercase=upper(substr(date_wday,1,1)).substr(date_wday,2)|dedup JSESSIONID| top limit=7 uppercase | eval sort_field=case(uppercase==""Sunday"",1, uppercase==""Monday"",2, uppercase==""Tuesday"",3, uppercase==""Wednesday"",4, uppercase==""Thursday"",5, uppercase==""Friday"",6, uppercase==""Saturday"",7) | sort + sort_field | fields - sort_field |rename count as Visits | rename uppercase as ""Day of the Week""",SplunkNinja,2015-05-16,2015-05-15
Most Active Day and Least Active Day for IIS Web Traffic -,IIS,The following Splunk query will return the most active and the least active days for web traffic in an IIS environment: ,"sourcetype=""iis"" | bucket span=1d _time |top limit=1 _time | eval Date=strftime(_time, ""%m/%d/%Y"") | eval Metric=""Most Active Date"" | append [search sourcetype=""iis"" | bucket span=1d _time |rare limit=1 _time | eval Date=strftime(_time, ""%m/%d/%Y"") | eval Metric=""Least Active Date""] | fields - _time, count, percent | fields Metric, Date",SplunkNinja,2015-05-16,2015-05-15
Total Hits on Least Active Day in IIS -,IIS,The following Splunk Query will return the total number of hits to a web site on the least active day of a given time range: ,"sourcetype=""iis"" |  rare limit=1 date_mday | rename count as Value | fieldformat Value=tostring(Value,""commas"")| eval Metric=""Number of hits on least active date"" | fields - date_mday, count, percent | fields Metric, Value",SplunkNinja,2015-05-16,2015-05-15
Total Hits on Most Active Day in IIS -,IIS,The following Splunk query will return the total number of hits on the most active day in a given time range within an IIS environment: ,"sourcetype=""iis"" |  top limit=1 date_mday | rename count as Value| fieldformat Value=tostring(Value,""commas"") | eval Metric=""Number of hits on Most active date"" | fields - date_mday, count, percent | fields Metric, Value",SplunkNinja,2015-05-16,2015-05-15
Visits by Hour of the Day in IIS -,IIS,The following Splunk query will list the total visits for each hour in a given time range. ,"sourcetype=""iis"" | top limit=24 date_hour | sort +date_hour | rename count as Visits | rename date_hour as ""Hour of the Day""",SplunkNinja,2015-05-16,2015-05-15
Weekend Web Traffic Summary in IIS -,IIS,The following Splunk query will return a summary of weekend activity for a given IIS hosted website. ,"sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday) | stats count(JSESSIONID) as Value | eval Metric=""Total Hits on Weekends"" | append [search sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday)| stats dc(JSESSIONID) as Value | eval Metric=""Total Visits on Weekends""] | append [search sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday) JSESSIONID=* | stats dc(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Visits per day on Weekends""]| append [search sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday) JSESSIONID=* | stats count(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Hits per day on Weekends""] | fieldformat Value=tostring(Value,""commas"") | fields - count, percent | fields Metric, Value",SplunkNinja,2015-05-16,2015-05-15
Weekday Web Traffic Summary in IIS -,IIS,The following Splunk query will show a summary of all weekday activity for a given website in IIS. ,"sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) | stats count(JSESSIONID) as Value | eval Metric=""Total Hits on Weekdays"" | append [search sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) | stats dc(JSESSIONID) as Value | eval Metric=""Total Visits on Weekdays""] | append [search sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) JSESSIONID=* | stats dc(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Visits per day on Weekdays""]| append [search sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) JSESSIONID=* | stats count(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Hits per day on Weekdays""] | fieldformat Value=tostring(Value,""commas"") | fields - count, percent |fields Metric, Value",SplunkNinja,2015-05-16,2015-05-15
List of Indexes -,Uncategorized,This simple Splunk query will return results for indexes that the current user (typically you) have access to: *NOTE* depending on settings this may or may not return internal indexes. ,host=* | dedup index |table index,ItsJohnLocke,2015-06-08,2015-06-08
Total Unique Browsers detected in IIS logs -,IIS,The following Splunk search query will show a count of unique browsers (calculation to include version) that hit a given website within IIS logs: ,sourcetype=iis | stats dc(cs_User_Agent),SplunkNinja,2015-06-10,2015-06-10
User Agent - Browser Details & Information for IIS -,IIS,"This Splunk query will reference a lookup table to return user agent (browser information) within IIS logs.  Specifically the output will list browser name and version, crawler, and mobile. It will give a count based on visits not hits (hence the dedup). Depending on the length of time this query can take a very long …","sourcetype=iis |dedup JSESSIONID| eval http_user_agent=urldecode(cs_User_Agent) | lookup browscap_lookup_express http_user_agent OUTPUT ua_parent ua_crawler ua_ismobiledevice| stats count by ua_parent ua_crawler ua_ismobiledevice | rename ua_parent as ""Browser Name and Version"" ua_crawler as Crawler ua_ismobiledevice as ""Mobile Device""",SplunkNinja,2015-06-18,2015-06-18
User Agent – Operating System Info for web traffic -,IIS,The following Splunk Query will return a list of operating systems used within IIS logs traffic. It essentially uses a lookup to check the user agent against a known list. *NOTE* The app TA-browscap_express – HTTP User Agent lookup with browscap must be installed ,"sourcetype=iis |dedup JSESSIONID | eval http_user_agent=urldecode(cs_User_Agent) | lookup browscap_lookup_express http_user_agent OUTPUT ua_platform_description | stats count by ua_platform_description | rename ua_platform_description as ""Operating Systems Used"" | sort - count",SplunkNinja,2015-06-22,2015-06-22
Get list of concurrent users on a specific server -,WinEventLog:Security,  The following Splunk query will return results for concurrent logon sessions (in a Windows Environment) on any given server (or multiple servers) with slight modification. First you must define the time span in which you consider “concurrent” this is defined in the “bucket” section below and the example uses a 30 minute range (widen …,"sourcetype=""WinEventLog:Security"" EventCode=4624 (Logon_Type=10 OR Logon_Type=2) | bucket span=30m _time | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"") | rex ""New\sLogon:\s*Security\sID:\s+\S*\s+Account\sName:\s+(?<ACCT>\S+)""  | stats count by ACCT, _time, host | where count>1 | sort - count",rupya1983,2015-06-30,2015-06-30
Event Logs | System Logs | Warnings and Errors -,WinEventLog:Application,This will hit all of the host and pull back the eventlogs and group them by Message. You can change the source to what ever windows eventlogs you need ,"source=wineventlog:application source=wineventlog:security source=wineventlog:system host=""*"" source=wineventlog:system NOT Type=Information | stats count by Message | sort -count | table count, Message",kharris,2015-07-06,2015-07-06
List of hosts and sourcetypes not sending data in last 24 Hours -,_internal,,"|noop |append [ |metadata type=hosts | table *] | append [|metadata type=sourcetypes | table *] | eval t = now() - lastTime | where t > 86400 | eval name = coalesce(host,sourcetype)| table name t lastTime totalCount type |rename t as ""Seconds since Event"" | convert ctime(lastTime) timeformat=""%m/%d/%Y %H:%M:%S %z""",alacer.cogitatus,2015-07-09,2015-07-09
Failed Versus Successful Logon Attempts -,WinEventLog:Security,This Splunk search query example will return results indicating failed vs successful login attempts in a Windows environment: ,"source=""WinEventLog:security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=528 OR EventCode=540 OR EventCode=4624 OR EventCode=4625 OR EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | eval status=case(EventCode=528, ""Successful Logon"", EventCode=540, ""Successful Logon"", EventCode=4624, ""Successful Logon"", EventCode=4625, ""Failed Logon"", EventCode=529, ""Failed Logon"", EventCode=530, ""Failed Logon"", EventCode=531, ""Failed Logon"", EventCode=532, ""Failed Logon"", EventCode=533, ""Failed Logon"", EventCode=534, ""Failed Logon"", EventCode=535, ""Failed Logon"", EventCode=536, ""Failed Logon"", EventCode=537, ""Failed Logon"", EventCode=539, ""Failed Logon"") | stats count by status | sort - count",SplunkNinja,2015-07-21,2015-07-21
List of Universal Forwarders with Version -,_internal,"The following Splunk query will return results of any host using a universal forwarder to transmit data back to a Splunk indexer. The query will return hostname, version, as well as architecture (64-bit vs 32-bit).   ","index=""_internal"" sourcetype=splunkd group=tcpin_connections NOT eventType=* | eval Hostname=if(isnull(hostname), sourceHost,hostname) | eval version=if(isnull(version),""pre 4.2"",version) | eval architecture=if(isnull(arch),""n/a"",arch) | stats count by Hostname version architecture | sort + version",SplunkNinja,2015-07-25,2015-07-24
Last Time a Forwarder Checked In -,_internal,"The following Splunk Search Query will return results based on the last time a forwarder (universal forwarder, heavy forwarder, or otherwise) checked in. The query is a modified version of a query that was packaged with the Deployment Monitor app. ","index=""_internal"" source=""*metrics.lo*"" group=tcpin_connections NOT eventType=* | eval sourceHost=if(isnull(hostname), sourceHost,hostname) | eval connectionType=case(fwdType==""uf"",""universal forwarder"", fwdType==""lwf"", ""lightweight forwarder"",fwdType==""full"", ""heavy forwarder"", connectionType==""cooked"" or connectionType==""cookedSSL"",""Splunk forwarder"", connectionType==""raw"" or connectionType==""rawSSL"",""legacy forwarder"")| eval build=if(isnull(build),""n/a"",build) | eval version=if(isnull(version),""pre 4.2"",version) | eval os=if(isnull(os),""n/a"",os)| eval arch=if(isnull(arch),""n/a"",arch) | eval lastReceived = case(kb>0, _time) | eval seconds=30 | eval event_count= tcp_eps * seconds | bin _time span=10m | stats first(connectionType) as connectionType first(version) as version max(_time) as lastConnected max(lastReceived) as lastReceived sum(kb) as kbTotal  sum(event_count) as events sum(seconds) as secs by sourceHost _time | stats first(connectionType) as connectionType first(version) as version max(lastConnected) as lastConnected max(lastReceived) as lastReceived by sourceHost | eval LastReceived=strftime(lastReceived, ""%Y/%m/%d %H:%M:%S"") | fields sourceHost, connectionType, LastReceived | sort + LastReceived",SplunkNinja,2015-07-29,2015-07-29
License Usage by Sourcetypes -,_internal,The following Splunk query will return results for license usage by sourcetype: ,"index=_internal source=""*license_usage.lo*"" type=Usage | stats sum(b) as bytes by st | eval Megabytes=bytes/1048576 |eval Megabytes=round(Megabytes,2) | fieldformat Megabytes=tostring(Megabytes,""commas"")| rename st as sourcetype | fields - bytes | sort - Megabytes",SplunkNinja,2015-08-04,2015-08-12
Top 5 License Consuming Hosts -,_internal,The following Splunk search query will return the top five licensing consuming hosts: ,"index=_internal source=*license_usage.log type=""Usage"" | stats sum(b) AS volume by h  | eval  GB=round(volume/1024/1024/1024,5)  | table h GB  | sort 5 - GB",SplunkNinja,2015-08-24,2015-08-24
Percentage of Daily License Usage -,_internal,"This Splunk search query will indicate the percentage of license used for the current day. This is already shown in the licensing tab under settings, however this query is extracted if you would want to use it within a dashboard or any other reason. NOTE – splunk_server= should be set to your license master.   …","| rest splunk_server=* /services/licenser/pools | rename title AS Pool | search [rest splunk_server=* /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields stack_id] | eval quota=if(isnull(effective_quota),quota,effective_quota) | eval ""% used""=round(used_bytes/quota*100,2) | fields ""% used""",SplunkNinja,2015-08-24,2015-08-24
Internal Splunk User Modifications -,audittrail,"This query will search the internal audit sourcetype of splunk and report on any user modification attempts, both success and fail. ","index=_audit sourcetype=audittrail action=edit_user | eval Date=strftime(_time, ""%Y/%m/%d"") |where user!=object| stats count by user, info, object, Date | rename user as ""Authenticated User"" | rename info as ""Success Status"" | rename object as ""Modified Account"" | sort - count",CattyWampus,2014-11-10,2015-08-25
Low Disk Space Alert for Windows Servers -,Perfmon:Free Disk Space,,"eventtype=hostmon_windows Type=Disk host=""*"" FileSystem=""*"" DriveType=""*"" | dedup host, Name | eval FreeSpacePct=round(FreeSpaceKB/TotalSpaceKB*100) | eval TotalSpaceGB=round(TotalSpaceKB/1024/1024) | eval FreeSpaceGB=round(FreeSpaceKB/1024/1024) | search FreeSpacePct<10 TotalSpaceGB=""*"" | dedup host, Name, DriveType, TotalSpaceGB, FreeSpaceGB, FreeSpacePct | table host, Name, DriveType, TotalSpaceGB, FreeSpaceGB, FreeSpacePct | sort FreeSpacePct",Suren,2015-08-27,2015-08-27
Apache access_logs status code reporting -,access_combined,,"index=apache sourcetype=access_combined | chart count(eval(like(status,""2%""))) AS Success, count(eval(like(status,""4%"") OR like(status,""5%""))) AS Error by status index=apache source=""/var/log/httpd/access_log"" | timechart count by status_description useother=f index=apache sourcetype=access_combined| timechart count by status_type limit=10 usenull=f index=apache sourcetype=access_combined status_type=""Server Error"" | table host status status_description method uri_path | rename host AS ""Server Name"" status AS ""Status Code"" status_description AS ""Description"" method AS ""Method"" uri_path AS ""URL Path"" index=apache source=""/var/log/httpd/access_log"" | dedup useragent | eval browser=useragent | replace *Firefox* with Firefox, *Chrome* with Chrome, *MSIE* with ""Internet Explorer"", *Version*Safari* with Safari, *Opera* with Opera, *rv:11.0* with ""Internet Explorer"" in browser| top limit=5 useother=t browser index=apache source=""/var/log/httpd/access_log"" | dedup useragent| eval device=useragent |replace *Windows* with Windows, *Macintosh* with Apple, *Android* with Android, *iPhone* with iPhone, *iPad* with iPad in device | top limit=5 useother=t device",Suren,2015-08-27,2015-08-27
Free Disk Space for each Drive Letter -,Perfmon:Free Disk Space,The following Splunk query will return results for all hosts reporting in Perfmon data on available disk space per assigned drive letter (NOTE you must make the change to include free diskspace per partition in your inputs.conf file) Query: ,"sourcetype=""Perfmon:Free Disk Space"" counter=""Free Megabytes"" (instance!=""HarddiskVolume*"") (instance!=_Total) |eval FreeSpace=(Value/1024)| eval GB=tostring(FreeSpace,""commas"") | table host instance GB | sort + host instance | rename instance as ""Drive Letter"" GB as ""GigaBytes Free"" [perfmon://Free Disk Space]
disabled = 0
counters = Free Megabytes;% Free Space
instances = *
interval = 3600",SplunkNinja,2015-09-01,2015-09-01
Network Traffic Received in Megabytes over Time -,Perfmon:Network Interface,"The following splunk query will show a timechart of network traffic received over a period of time for any host specified (make sure you edit the query to specify a host, this one defaults to all). The query also converts the default value of Bytes to Megabytes.   ","sourcetype=""Perfmon:Network Interface"" (host=""*"")  counter=""Bytes Received/sec""| eval MB=(Value/1024/1024)| timechart avg(MB) by host",SplunkNinja,2015-09-03,2015-09-03
Network Traffic Sent in Megabytes over Time -,Perfmon:Network Interface,"The following splunk query will show a timechart of network traffic sent over a period of time for any host specified (make sure you edit the query to specify a host, this one defaults to all). The query also converts the default value of Bytes to Megabytes.   ","sourcetype=""Perfmon:Network Interface"" (host=""*"")  counter=""Bytes Sent/sec"" | eval MB=(Value/1024/1024) | timechart  avg(MB) by host",SplunkNinja,2015-09-03,2015-09-03
Splunk Query Count by users -,_internal,,index=_audit search=* NOT (search_id='scheduler* OR search_id='Summary*) user=admin | timechart span=1d count by user usenull=f,databeastmaster,2015-09-15,2015-09-15
Introspection - Memory used by SID (Search ID) -,_internal,Chart memory used by each SID (search ID) using the Introspection logs ,"index=""_introspection""  ""data.process""=splunkd | timechart max(data.mem_used) by data.search_props.sid usenull=f useother=f",chubbybunny,2015-09-28,2015-09-28
"CPU Thresholds, Warnings, and Risk Scoring -",Perfmon:CPU Load,The following splunk query can be used to do as the title says. Risk scoring is done via color codes in the source information of the chart (see below for an example). The following query looks at the average CPU time for 30 minute chunks of time over a selected time range (ie: what was …,"sourcetype=""Perfmon:CPU Load"" |bucket _time span=30m | eval Load=round(Value,2) | stats avg(Load) as AVGL by host, _time | chart avg(AVGL) as AverageCPU by host |  eval ""CPULoad""=case(AverageCPU>90, ""Critical"", AverageCPU>=70 AND AverageCPU<=89, ""Warning"", AverageCPU>=40 AND AverageCPU<=69, ""Elevated"", AverageCPU<40, ""Normal"") | stats count by CPULoad | sort - count CPULoad <option name=""charting.fieldColors"">{""Critical"":0xD64541,""Warning"":0xF89406,""Elevated"":0x3498DB,""Normal"":0x2ECC71}</option>",SplunkNinja,2015-10-14,2015-10-14
Splunk User Search Activity -,audittrail,"This will return a table of users who conducted searches, the total time it took for searches to complete, a count of said searches, and the last time a search was conducted. *NOTE* You will need to modify “splunk_server=local” specifically the “local” section to represent your Splunk server. ","index=_audit splunk_server=local action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace '*' with * in search_id | rex ""search='search\s(?<search>.*?)',\sautojoin""| search search_id!=scheduler_* | convert num(total_run_time) | eval user = if(user=""n/a"", null(), user) | stats min(_time) as _time first(user) as user max(total_run_time) as total_run_time first(search) as search by search_id | search search!=*_internal* search!=*_audit* | chart sum(total_run_time) as ""Total search time"" count as ""Search count"" max(_time) as ""Last use"" by user | fieldformat ""Last use"" = strftime('Last use', ""%F %T.%Q"")",CattyWampus,2014-11-10,2015-10-22
Successful Linux Logons by Username -,linux_secure,"As stated in the title, this Splunk search query will return a list of all successful logons by user name on linux hosts. The regex is provided in the event the field is not extracted: ","sourcetype=linux_secure |rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s\S+\s(?<session>gdm-\w+)\S:\s""| search session=gdm-password | rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s(?<hostname>\S+)\s.+\Sgdm-password:auth\S:\s(?<authstatus>\w+\s\w+);\s.+user=(?<username>\S+)"" | search authstatus=""authentication success"" | stats count by username",ItsJohnLocke,2015-11-19,2015-11-24
Timechart of Linux Logons -,linux_secure,The following splunk search will return a timechart of all successful logons for a given linux environment (regex provided): ,"sourcetype=linux_secure |rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s\S+\s(?<session>gdm-\w+)\S:\s""| search session=gdm-password | rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s(?<hostname>\S+)\s.+\Sgdm-password:auth\S:\s(?<authstatus>\w+\s\w+);\s.+user=(?<username>\S+)"" | search authstatus=""authentication success"" | timechart count(username) sourcetype=linux_secure |rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s\S+\s(?<session>gdm-\w+)\S:\s""| search session=gdm-password | rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s(?<hostname>\S+)\s.+\Sgdm-password:auth\S:\s(?<authstatus>\w+\s\w+);\s.+user=(?<username>\S+)"" | search authstatus=""authentication failure"" | timechart count(username)",ItsJohnLocke,2015-11-24,2015-11-24
List of Failed Login Attempts in Linux -,linux_secure,"This Splunk search will show a count of all user accounts and a number of times they have attempted to logon. The REGEX is written into the query, remove it if you are already extracting those field names:   ","sourcetype=linux_secure |rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s\S+\s(?<session>gdm-\w+)\S:\s""| search session=gdm-password | rex ""\w{3}\s\d{1,2}\s\d{2}:\d{2}:\d{2}\s(?<hostname>\S+)\s.+\Sgdm-password:auth\S:\s(?<authstatus>\w+\s\w+);\s.+user=(?<username>\S+)"" | search authstatus=""authentication failure"" | stats count by username | sort - count",ItsJohnLocke,2015-11-18,2015-11-25
List Ports Forwarders are Using -,_internal,Use the following Splunk Search Query to list what ports your Universal Forwarders are using to communicate to the Indexer: ,"index=""_internal"" source=""*metrics.lo*"" group=tcpin_connections NOT eventType=*  | dedup sourceHost |stats count by destPort",ItsJohnLocke,2015-11-17,2015-11-25
Splunk Server Restart Duration -,_internal,"As titled, the following Splunk search query will show the restart duration (using the transaction command) of the Splunk service itself.   ","index=_audit (action=""splunkShuttingDown"" OR action=""splunkStarting"") | eval Date=strftime(_time, ""%Y/%m/%d"") | transaction splunk_server startswith=action=""splunkShuttingDown"" endswith=action=""splunkStarting"" | eval duration=round(duration/60, 2) |table Date splunk_server duration| rename duration as ""Splunk Restart Duration"" splunk_server as ""Splunk Server""",ItsJohnLocke,2015-12-07,2015-12-07
Queries Executed in DBConnect -,audittrail,This Splunk query will show the DBX or DBConnect queries executed. I have limited information to work with so check back for updates.   Disclaimer – I’m using rex to replace HTML markup that is outputted and ingested by splunk. You may need to add to or remove this depending on your output (see query …,"index=_audit sourcetype=audittrail action=""db_connect_execute_query"" |rex ""user=(?<user>\S+),\s"" | rex mode=sed ""s/%20/ /g"" |rex mode=sed ""s/%5D/]/g"" |rex mode=sed ""s/%5B/[/g"" |rex mode=sed ""s/%3D/=/g"" |rex mode=sed ""s/%0A/ /g"" |rex mode=sed ""s/%2C/,/g"" |rex mode=sed ""s/%2F/\//g"" |rex mode=sed ""s/%22/\""/g"" | rex ""\sREST:\s\/db_connect\/query\/.+SELECT(?<DB_Query>.+)].\w\S\w]"" | table timestamp user DB_Query",ItsJohnLocke,2015-12-08,2015-12-08
Permissions for splunk users -,_internal,Another view for which splunk user can do what in your splunk environment ,"| rest /services/authentication/users | mvexpand roles | table realname, title, roles, email | join roles [ rest /services/authorization/roles | rename title as roles | search srchIndexesAllowed=* | table roles srchIndexesAllowed]",manderso,2015-12-09,2015-12-16
Simple GeoIP Information for Web Traffic -,IIS,This simple query will show if IIS traffic came to a given site from three geographical possibilities: “United States” “International” or “Unknown” sources. This relies entirely on geoip lookup. You can change the country of “United States” to anything you desire for you own data set (just make the change in the eval section below!). …,"sourcetype=""iis"" | iplocation c_ip | fillnull value=""Unknown"" Country | eval GeoLocation=case(Country=""United States"", ""Views from the United States"", Country=""Unknown"", ""Views from Unknown Origins"", Country!=""United States"" AND Country!=""Unknown"", ""International Views"") | top limit=3 GeoLocation | eval percent = round(percent,2) . "" %"" | rename GeoLocation as ""Visitor Nationality"" | rename percent as Percent | fields - count",ItsJohnLocke,2015-10-29,2015-12-16
rangemap command with single value string -,_internal,,"index=_internal sourcetype=splunkd OR sourcetype=splunkd_access | stats latest(sourcetype) as sourcetype | eval sourcetypeidx=case(sourcetype=""splunkd"",2,sourcetype=""splunkd_access"",1) | rangemap field=sourcetypeidx severe=0-1 low=2-4 default=low",Suren,2016-01-13,2016-01-13
Search to show what apps are ready to be updated -,_internal,,"| rest splunk_server=local /services/apps/local | search update.version=* | table title version update.version <i><span style=""font-size: 10.0pt; color: #333333;"">update.*</span></i> <i><span style=""font-size: 10.0pt; color: #333333;"">splunk_server</span></i>",manderso,2016-01-13,2016-01-13
How to Check When Splunk is finished Indexing a log file -,_internal,How can I tell when Splunk is finished indexing a log file? (Credit for this one goes to learnsplunk.com author who originally posted it on his website) By watching  data from splunk’s metrics log in real-time. ************************************************************ ,"index=""_internal"" source=""*metrics.log"" group=""per_sourcetype_thruput"" series=""your_sourcetype_here"" | eval MB=kb/1024 | chart sum(MB) index=""_internal"" source=""*metrics.log"" group=""per_sourcetype_thruput"" | eval MB=kb/1024 | chart sum(MB) avg(eps) over series",Suren,2016-01-13,2016-01-14
User Activity in DBConnect -,_internal,The following Splunk query is for the DBConnect app.  This will return all user activity using this particular app. I’ve provided the regex in the search.   ,"index=_audit sourcetype=audittrail action=""db_connect*"" |eval Date=strftime(_time, ""%Y/%d/%m"") |rex ""user=(?<user>\S+),"" | stats count by Date, user, info, action",SplunkNinja,2016-01-26,2016-01-26
Qualys Active OS Vuln Count -,Qualys,The following Splunk Search (query) is for Qualys and will show vulnerability count for Windows Hosts. This query assumes that your index is defined as qualys. ,"index=qualys HOSTVULN SEVERITY=3 OR 4 OR 5 TYPE=""CONFIRMED"" earliest=-30d@d | dedup HOST_ID, QID | search STATUS!=""FIXED"" |join QID [search index=qualys QID_INFO PATCHABLE=1] | join HOST_ID [search index=qualys HOSTSUMMARY: OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP) ] | stats count(QID) as #_Vulns by OS | sort -#_Vulns | addcoltotals #_Vulns",CattyWampus,2016-01-28,2016-01-28
Qualys Hosts not Scanned in 30 days+ -,Qualys,The following Splunk Search (query) is for Qualys and will show hosts that have not been scanned in 30 days or more. This query assumes that your index is defined as qualys. ,"index=qualys HOSTVULN earliest=-30d@d STATUS=""RE-OPENED""  | dedup HOST_ID, QID sortby +_time  | join HOST_ID [search index=qualys HOSTSUMMARY OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP) ] | timechart span=1d count(QID) by SEVERITY",CattyWampus,2016-01-28,2016-02-01
Qualys 30 Day trending of Re-Opened Vulnerabilities -,Qualys,The following Splunk Search (query) is for Qualys and will show a trending over 30 days for re-opened vulnerabilities. This query assumes that your index is defined as qualys. ,"index=qualys HOSTVULN earliest=-30d@d STATUS=""RE-OPENED""  | dedup HOST_ID, QID sortby +_time  | join HOST_ID [search index=qualys HOSTSUMMARY OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP) ] | timechart span=1d count(QID) by SEVERITY",CattyWampus,2016-01-28,2016-02-01
Qualys Top 10 Vulnerabilities by Severity -,Qualys,The following Splunk Search (query) is for Qualys and will show the top 10 vulnerabilities by severity as well as a Count of Devices. ,"sourcetype=qualys_vm_detection HOSTVULN SEVERITY=3 OR 4 OR 5 TYPE=""CONFIRMED"" earliest=-30d@d| dedup HOST_ID, QID | search STATUS!=""FIXED"" | join QID [search sourcetype=qualys_knowledgebase PATCHABLE=1 ]   | eval Published=strftime(strptime(PUBLISHED_DATETIME, ""%Y-%m-%d""), ""%m/%d/%Y"") | join HOST_ID [search sourcetype=qualys_vm_detection HOSTSUMMARY OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP)  ]  |  stats count(HOST_ID) as #_Hosts by QID, Published, TITLE, SEVERITY | sort  -SEVERITY, 10 -#_Hosts",CattyWampus,2016-01-28,2016-02-01
List of Login Attempts to Splunk -,audittrail,This will return a list of users who attempted to login to the splunk searchhead. It will list both successful attempts and failed attempts. ,"index=_audit tag=authentication | stats count by user, info | sort - info",CattyWampus,2014-11-10,2016-02-01
Splunk Query to report on users logging on to the Splunk Web Console -,_internal,,index=_audit tag=authentication info=succeeded |dedup user | table user timestamp,Suren,2015-08-27,2016-02-01
Traffic Volume by Forwarder -,_internal,"This Splunk search query will show you the top 10 “chattiest” forwarders on your network. I’ve used this query to determine why some forwarders were sending more data than others. The results are displayed in kilobits, you could use an eval to change it to the appropriate size for your network. ","index=""_internal"" source=""*metrics.lo*"" group=tcpin_connections NOT eventType=* | eval sourceHost=if(isnull(hostname), sourceHost,hostname) | search sourceHost=*** | timechart per_second(kb) by sourceHost WHERE max in top5 useother=f",SplunkNinja,2016-02-02,2016-02-02
Convert non timestamp time to Epoch -,Uncategorized,Scenario: You have a non timestamp field that you need to convert to epoch time to perform statistics on within splunk. Here’s how you do it: ,"your search goes here |eval Epoch_Time=strptime(Field_Date, ""%Y-%m-%d %H:%M:%S"")",SplunkNinja,2016-02-29,2016-02-29
Count of Attackers on Juniper Devices -,Juniper,The following is a Splunk search query that indicates potential “attacks” by source IP.  Further investigation will be needed to determine accuracy of attacks. ,"sourcetype = ""juniper:idp"" attack* | stats count by src_ip",ItsJohnLocke,2016-03-19,2016-03-19
Available Memory in a Windows box -,Perfmon:Available Memory,"This query will return results based on amount of available memory. I output it to a gauge, you’ll want to modify your gauge to show up red as it approaches zero. ","sourcetype=""Perfmon:Available Memory"" | bucket _time span=1m | eval gigabytes=(((Value/1024)/1024)/1024) | eval GB=round(gigabytes, 2) | gauge GB source=”Perfmon:Memory” counter=”Available Mbytes” | bucket _time span=1m | eval gigabytes=(Value/1024) | eval GB=round(gigabytes, 2) | gauge GB",SplunkNinja,2014-11-18,2016-04-01
Top Visited Pages in IIS Web Logs -,IIS,There are a number of ways to track user behavior within web logs. One such method is to use the JSESSIONID which in this query is used. The variable you can/will change in this query is the reference to JSESSIONID as to better align with your web logs and web site(s) in general. This working …,"sourcetype=""iis"" cs_Referer!=""-"" |dedup 20 JSESSIONID| top limit=21 cs_Referer |addtotals col=t labelfield=change_name label=Total |fields - Total | eval percent = round(percent,2) . "" %"" | rename count as Visits | rename percent as ""% Visits"" | rename change_name as ""Subtotal for rows 1-20"" | fields cs_Referer, ""Subtotal for rows 1-20"", Visits, ""% Visits"" |sort - Visits|rename cs_Referer to Page",SplunkNinja,2016-04-08,2016-04-08
Timestamp vs Indextime of Events (Diagnostic Query) -,splunkd,"This query has in the past help me track down issues between forwarders and indexers, and even on occasion finding some time sync issues. Feel free to tweak, modify, and improve upon this query as I’m not 100% certain the math will work in your favor outside of highlighting (positive or negative) time differences! ","index=* |eventstats max(_time) as MAXt max(_indextime) as MAXit by host|eval timediff=round(MAXt - MAXit)| convert ctime(MAXit) as idxtime ctime(MAXt) as Date |dedup timediff host | table idxtime Date timediff host | sort - timediff | rename Date as ""Timestamp of Event"" idxtime as ""Index Time Timestamp""",SplunkNinja,2016-04-08,2016-04-08
Memory Usage and Information on Splunk Server -,REST,"This Splunk Search Query will perform a rest call to indicate current memory consumption on the Splunk server(s) itself/themselves: *NOTE* The following has been modified from the “Distributed Management Console” to be more generic for a copy, paste, and search example. ","| rest splunk_server=* /services/server/status/resource-usage/hostwide  | stats first(normalized_load_avg_1min) as load_average first(cpu_system_pct) as system, first(cpu_user_pct) as user first(mem) AS mem first(mem_used) AS mem_used by splunk_server | fields splunk_server mem mem_used | eval pctmemused=round((mem_used/mem)*100).""%"" | table splunk_server pctmemused | rename splunk_server as ""Splunk Server"" pctmemused as ""Percent of Memory Used""",ItsJohnLocke,2016-05-04,2016-05-04
Count of Splunk Errors Per Host -,_internal,The following Splunk query will list the number of errors associated with each host over a given time range: ,"index=_internal sourcetype=""splunkd"" log_level=""ERROR""  host!=splunk_server | stats count by host | sort - count",ItsJohnLocke,2016-05-06,2016-05-05
Detailed list of Errors Per Host -,_internal,The following Splunk search will return a detailed list (by message) of errors associated with hosts running a universal forwarder: ,"index=_internal sourcetype=""splunkd"" log_level=""ERROR"" | stats sparkline count dc(host) as uniqhosts last(message) as message last(_time) as last first(_time) as first by punct  | convert ctime(last) ctime(first) | table message count uniqhosts sparkline first last | sort -count | rename message as ""Error Output"" count as Count uniqhosts as ""Number of Hosts"" first as ""First Occurance"" last as ""Most Recent Occurance""",ItsJohnLocke,2016-05-06,2016-05-05
List of Sourcetypes Sent by Forwarder -,_internal,The following Splunk search will show a list of sourcetypes (or perhaps sources I need to confirm) being sent by each Forwarder: ,"index=""_internal"" |where host!=splunk_server | stats values(series) as Sourcetypes by host",SplunkNinja,2016-05-06,2016-05-05
Count of Host added to Splunk by Month -,_internal,Can we get a Splunk Query that list of hosts added to Splunk in a month.  Like Month 1 : 200 devices added Month 2: 400 devices added   You would do this: ,host=* | stats dc(host) as host by date_month,kishorebk,2016-05-13,2016-05-13
RFQ (Request For Query) - Port Scan -,RFQ - Request For Query,I am looking for the query,,rashid47010,2016-06-03,2016-06-03
Malware Detection -,Malware,I’m reposting this query I stumbled upon in a blog here. The description states that it can be used to detect malware reporting out to the web. Check out the article it’s a decent read. ,"search.goes.here | convert mktime(_time) as epoch | sort 0 uri_host,client_ip,epoch | delta epoch as epoch_delta | search epoch_delta>0 epoch_delta<30 | chart count over epoch_delta by uri_host",ItsJohnLocke,2016-06-15,2016-06-15
Worldmap with unique visitors last 24 hours -,access_combined,,"sourcetype=access_combined | iplocation sourceIP | stats dc(sourceIP) by Country | geom geo_countries featureIdField=""Country"" earliest=-24h",m1ll3n1umf4lc0n,2016-06-30,2016-06-29
Number of mails sent over time (Postfix) -,postfix_syslog,,sourcetype=postfix_syslog host=insertHostnameHere status=sent | timechart span=1d count,m1ll3n1umf4lc0n,2016-06-30,2016-06-30
Nr. of unique visitors per hour timechart -,access_combined,,host=insertHostnameHere sourcetype=access_combined | timechart span=1h dc(sourceIP),m1ll3n1umf4lc0n,2016-06-30,2016-06-30
Convert Seconds to Hours Minutes Seconds HHMMSS -,eval,Take any field in splunk that outputs a value in seconds and change it to report in HH:MM:SS format: ,"your.search.here | eval HHMMSS=tostring(Field_In_Seconds, ""duration"") | table HHMMSS",SplunkNinja,2016-07-15,2016-07-15
Show uptime in Days -,Unix:Uptime,The following query shows uptime of all systems over a certain period of time (days_uptime). Replace my indexes w/ yours. ," index=os OR index=idx_appdev sourcetype=Unix:Uptime OR sourcetype=""WMI:Uptime"" |dedup host |eval DaysUp=round(SystemUpTime/86400,2) |eval Years=round(DaysUp/365,2) |eval Months=round(DaysUp/30,2)|search DaysUp > $days_uptime$ | table host DaysUp Years Months SystemUpTime |sort - SystemUpTime |",manderso,2016-07-20,2016-07-19
License Usage by Index per Day -,_internal,The following Splunk search query will output license usage for each index for each day for the week to date. It will also output an average for each index over the course of the given time period.   ,"index=_internal source=*license_usage.log type=""Usage"" splunk_server=* earliest=-1w@d | eval Date=strftime(_time, ""%Y/%m/%d"") | eventstats sum(b) as volume by idx, Date | eval MB=round(volume/1024/1024,5)| timechart first(MB) AS volume by idx ",SplunkNinja,2015-08-25,2016-08-12
Pass the Hash Detection -,WinEventLog:Security,,"index=""wineventlog"" ( EventCode=4624 Logon_Type=3 ) OR ( EventCode=4625 Logon_Type=3 ) Authentication_Package=""NTLM"" NOT Account_Domain=YOURDOMAIN NOT Account_Name=""ANONYMOUS LOGON""",srilankanmonkey,2016-08-12,2016-08-12
Linux Free Disk Space -,Linux Performance,The following Splunk query shows a percentage of free disk space over a period of time using timechart: ,"index=os sourcetype=df PercentFreeSpace=* mount=""/"" | timechart latest(PercentFreeSpace) by host",SplunkNinja,2016-09-10,2016-09-10
Linux Memory Usage -,Linux Performance,The following Splunk Search will show memory usage on a linux machine over a period of time using timechart: ,index=os sourcetype=top pctMEM=*| transaction host _time | streamstats window=1 global=f sum(pctMEM) as MEM | timechart latest(MEM) by host,SplunkNinja,2016-09-10,2016-09-12
Linux CPU Usage -,Linux Performance,The following query will output CPU usage per host over a period of time using timechart: ,index=os sourcetype=top pctCPU=* | transaction host _time | streamstats window=1 global=f sum(pctCPU) as CPU | timechart latest(CPU) by host,SplunkNinja,2016-09-10,2016-09-12
Top Header cpu & memory status -,Linux Performance,"I didn’t like the CPU input from the Splunk TA Nix app, so I created this small ingest from top. The script takes a snapshot of the top command, and looks directly at the header: ","top -b -n 1 | sed -n '1,5p' top - 15:20:55 up 26 days, 9:53, 1 user, load average: 0.89, 0.59, 0.48
 Tasks: 125 total, 1 running, 124 sleeping, 0 stopped, 0 zombie
 Cpu(s): 3.5%us, 0.7%sy, 0.0%ni, 95.7%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st
 Mem: 8059752k total, 4138600k used, 3921152k free, 759256k buffers
 Swap: 2097148k total, 96532k used, 2000616k free, 2228520k cached index=os sourcetype=top_header host=* |timechart span=1m values(load_1minavg) values(load_5minavg) values(load_15minavg) by host index=os sourcetype=top_header host=* | eval percentUsed=mem_used/mem_total*100 | gauge percentUsed by host",manderso,2016-09-22,2016-09-22
Pearson Coefficient of Two Fields -,Fun Stuff & Helpful Hints,The following SPL query calculates the Pearson coefficient of two fields named x and y. ,"index=*
| fields x y
| eval n=1 | eval xx=x*x | eval xy=x*y | eval yy=y*y
| addcoltotals | tail 1
| eval rho_xy=(xy/n-x/n*y/n)/(sqrt(xx/n-(x/n)*(x/n))*sqrt(yy/n-(y/n)*(y/n)))
| fields rho_xy",yangzd,2016-10-13,2016-10-13
All indexes not explicitly granted to a role -,REST,,"| rest /servicesNS/-/-/data/indexes count=0
 | stats max(isInternal) as internal, max(disabled) as disabled, max(isReadOnly) as readonly by title
 | fillnull
 | where internal=0 AND disabled=0 AND readonly=0
 | fields title
 | rename title as index
 | join index type=left
 [ rest /servicesNS/-/-/authorization/roles count=0 splunk_server=local
 | fields title,srchIndexesAllowed
 | rename srchIndexesAllowed as index title as role
 | mvexpand index
 | where NOT match(index,"".*\*.*"") ]
 | search NOT role=*
 | fields index",ItsJohnLocke,2016-10-19,2016-10-19
Every index explicitly granted to a role -,REST,"Self explanatory, maps roles to indexes. Useful if you have a lot of indexes! ","| rest /servicesNS/-/-/authorization/roles count=0 splunk_server=local
 | fields title,srchIndexesAllowed
 | rename srchIndexesAllowed as index title as role
 | mvexpand index
 | where NOT match(index,"".*\*.*"")",ItsJohnLocke,2016-10-19,2016-10-19
Splunk Objects With Permissions Granted to Non-existent Roles -,REST,Useful search to show a bit of detail on roles and user permissions. ,"| rest /servicesNS/-/-/admin/directory count=0 splunk_server=local
 | fields eai:acl.app, eai:acl.owner, eai:acl.perms.*, eai:acl.sharing, eai:location, title
 | eval perms=mvappend('eai:acl.perms.read','eai:acl.perms.write')
 | fields - eai:acl.perms.*
 | mvexpand perms
 | where perms!=""*"" AND NOT
 [
 | rest /servicesNS/-/-/authorization/roles count=0 splunk_server=local
 | fields title
 | rename title as perms
 ]",ItsJohnLocke,2016-10-19,2016-10-19
IIS Response Time -,IIS,,"host=""*""  sourcetype=iis (insertIISurl) | eval time_taken = time_taken/1000  | stats  max(time_taken) AS ""Highest Response Time"" host=""*""  sourcetype=iis (insertIISurl) | eval time_taken = time_taken/1000  | stats  avg(time_taken) AS ""Average Response Time"" host=""*""  sourcetype=iis (insertIISurl) | eval time_taken = time_taken/1000  | stats  fastest(time_taken) AS ""Fastest Response Time"" host=""*""  sourcetype=iis ""google.com"" | eval time_taken = time_taken/1000  | stats  max(time_taken) AS ""Highest Response Time""  ",kharris,2016-10-21,2016-10-21
REST Call for Splunk Server Role Status -,REST,This REST Splunk search returns the status of roles on each Splunk server in your environment. ,| rest /services/server/introspection | table title splunk_server status updated,ItsJohnLocke,2016-10-25,2016-10-25
REST Call for a list of Lookup Files -,REST,Use this splunk search to get a list of all lookup files: ,| rest /services/data/transforms/lookups | table eai:acl.app eai:appName filename title fields_list updated id,ItsJohnLocke,2016-10-26,2016-10-26
Average Splunk Web requests by hour -,_internal,This query is pretty awesome! It helped enlighten us to exactly when our splunk infrastructure is being hit with users ,"index=_internal sourcetype=splunk_web_access
 [ rest / splunk_server=local
 | fields splunk_server
 | rename splunk_server as host ]
 | bin _time span=1d
 | stats count by date_hour _time
 | appendpipe [ fields _time
 | dedup _time
 | eval date_hour=mvrange(0,24,1)
 | eval count=0
 | mvexpand date_hour ]
 | stats sum(count) as count by date_hour _time
 | stats avg(count) as avg by date_hour
 | sort date_hour",ItsJohnLocke,2016-10-19,2016-10-27
REST Call for Memory & CPU usage on Splunk Servers -,REST,This Splunk search will show you use and available CPU and Memory statistics. Depending on your environment you may see multiple Splunk servers: ,"| rest  /services/server/status/resource-usage/hostwide | eval cpu_count = if(isnull(cpu_count), ""N/A"", cpu_count) | eval cpu_usage = cpu_system_pct + cpu_user_pct | eval mem_used_pct = round(mem_used / mem * 100 , 2) | eval mem_used = round(mem_used, 0) | eval mem = round(mem, 0) |eval mem=tostring(mem, ""commas"") | eval mem_used=tostring(mem_used, ""commas"")| fields splunk_server, cpu_count, cpu_usage, mem, mem_used, mem_used_pct | sort - cpu_usage, -mem_used | rename splunk_server AS Instance, cpu_count AS ""CPU Cores"", cpu_usage AS ""CPU Usage (%)"", mem AS ""Physical Memory Capacity (MB)"", mem_used AS ""Physical Memory Usage (MB)"", mem_used_pct AS ""Physical Memory Usage (%)""",ItsJohnLocke,2016-11-03,2016-11-02
Show all currently logged in users -,REST,Use this Splunk rest query to list all currently logged in users (to your Splunk server).   | rest /services/authentication/current-context | search NOT username=”splunk-system-user” | table username roles updated  ,,ItsJohnLocke,2016-11-03,2016-11-03
List Inputs using REST -,REST,As the title says. Pretty nice Splunk Search if you’ve forgotten what inputs you have configured and need a central place to list them. ,"| rest /services/data/inputs/all | convert ctime(starttime) AS ""Start Time""  | convert ctime(endtime) AS ""End Time"" | table index interval source sourcetype title updated starttime endtime ""Start Time"" ""End Time""",ItsJohnLocke,2016-11-10,2016-11-10
List of Props.conf Extractions -,REST,Useful Splunk Query to show extractions from Props.conf: ,| rest /services/data/props/extractions | table title type value attribute,ItsJohnLocke,2016-11-10,2016-11-10
List of Extractions in Transforms.conf -,REST,Useful Splunk Query to show REGEX extractions in Transforms.conf ,| rest /services/data/transforms/extractions | table title eai:appName REGEX FORMAT updated,ItsJohnLocke,2016-11-10,2016-11-10
List of Alerts via REST -,REST,The following Splunk search (query) will show a list of alerts within Splunk via the | rest call: ,| rest /services/alerts/fired_alerts splunk_server=local| table eai:acl.owner eai:acl.app id title triggered_alert_count,ItsJohnLocke,2016-11-29,2016-11-29
Monitor File Shares being Accessed in Windows -,WinEventLog:Security,This splunk search will show file shares being accessed within windows environments. ,"sourcetype=""WinEventLog:Security"" EventCode=5140 (Share_Name=""*\\C$"" OR Share_Name=""*D$"" OR Share_Name=""*E$"" OR Share_Name=""*F$"" OR Share_Name=""*U$"") NOT Source_Address=""::1"" | eval Destination_Sys1=trim(host,""1"") | eval Destination_Sys2=trim(host,""2"") | eval Dest_Sys1=lower(Destination_Sys1) | eval Dest_Sys2=lower(Destination_Sys2) | rename host AS Destination | rename Account_Domain AS Domain | where Account_Name!=Dest_Sys1 | where Account_Name!=Dest_Sys2 | stats count values(Domain) AS Domain, values(Source_Address) AS Source_IP, values(Destination) AS Destination, dc(Destination) AS Dest_Count, values(Share_Name) AS Share_Name, values(Share_Path) AS Share_Path by Account_Name",john117,2016-11-29,2016-11-29
Monitor for Service Changes in Windows -,WinEventLog:System,The following splunk search looks for changes in services within Windows.   ,"sourcetype=""WinEventLog:System"" EventCode=7045 NOT (Service_Name=mgmt_service) | eval Message=split(Message,""."") | eval Short_Message=mvindex(Message,0) | table _time host Service_Name, Service_Type, Service_Start_Type, Service_Account, Short_Message",john117,2016-11-29,2016-11-29
Events Sent to Null Que - Internal Logs -,_internal,This will show events that have been sent to the null que within the splunk internal logs.   ,"index=_internal component=metrics processor=nullqueue group=pipeline sourcetype=splunkd | table _time log_level name processor cpu_seconds executes, cumulative_hits",john117,2016-12-14,2016-12-14
Qualys - Number of Hosts Scanned -,Qualys,The following Splunk query will show the number of hosts scanned within the Qualys Sourcetype: ,"eventtype=""qualys_vm_detection_event"" |eval Success= if(SEVERITY >3,1,0)|stats count as total sum(Success) as success|eval Per_high=(success/total)*100 |",SplunkNinja,2016-12-15,2016-12-15
Number of Vulnerabilities Detected - Qualys -,Qualys,The following Splunk query will show the number of vulnerabilities detected all severities and all types within the Qualys Sourcetype: ,"eventtype=""qualys_vm_detection_event"" STATUS=""NEW""  | dedup QID |stats count by SEVERITY",SplunkNinja,2016-12-15,2016-12-15
New Vulnerabilities Detected Since Last Scan - Qualys -,Qualys,As the title suggests this Splunk Search will dedup results so you can better see changes in Vulnerability detection scan to scan within the Qualys Sourcetype: ,"eventtype=""qualys_vm_detection_event"" | dedup QID |stats count by SEVERITY",SplunkNinja,2016-12-15,2016-12-15
Hosts Taking a Long Time to Scan - Qualys -,Qualys,The following Splunk query will show the hosts taking an abnormally lengthy time to scan (helps find that needle in a haystack) within the Qualys Sourcetype: ,"sourcetype=""qualys:hostDetection"" eventtype=qualys_host_summary_event SCAN_DURATION> 1800 | sort -SCAN_DURATION | table IP, DNS, OS, SCAN_DURATION",SplunkNinja,2016-12-15,2016-12-15
High Severity Vulnerabilities - Qualys -,Qualys,The following Splunk query will show the percentage of high severity vulnerabilities within the Qualys Sourcetype: ,"eventtype=""qualys_vm_detection_event"" |eval Success= if(SEVERITY >3,1,0)|stats count as total sum(Success) as success|eval Per_high=(success/total)*100",SplunkNinja,2016-12-15,2016-12-15
Top 25 Most Prevailing Vulnerabilities with Patches Available (Multiple OSs)- Qualys -,Qualys,The following Splunk Search Queries within the Qualys Sourcetype list the top 25 most prevailing vulnerabilities that have patches available. The queries are separated by Operating System or Device Type: Linux ,"eventtype=qualys_vm_detection_event SEVERITY > 3 STATUS=""ACTIVE"" | regex OS=""^((?!\/).)*Linux((?!\/).)*$"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 –count eventtype=qualys_vm_detection_event SEVERITY > 3 STATUS=""ACTIVE"" | regex OS=""(F5 Networks Big-IP)|(^Cisco((?!\/).)*$)|(Firewall)"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 –count eventtype=qualys_vm_detection_event SEVERITY > 3 STATUS=""ACTIVE"" | regex OS=""^Windows (2000$|XP|7|8)((?!\/).)*$"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 –count eventtype=qualys_vm_detection_event SEVERITY > 3 STATUS=""ACTIVE"" | regex OS=""^Windows .*Server((?!\/).)*$"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 –count",SplunkNinja,2016-12-15,2016-12-15
Remediation Tracking Trend - Qualys -,Qualys,The following Splunk query will help determine remediation tracking trends within the Qualys Sourcetype: ,"eventtype=""qualys_vm_detection_event"" | stats count as eachCount |eval STATUS=""Total"" | table STATUS eachCount| append [|search eventtype=""qualys_vm_detection_event""| stats count as eachCount by STATUS| eventstats sum(eachCount) as total | eval fixedPerc = ((eachCount/total)*100) | search STATUS=FIXED |table STATUS eachCount ]",SplunkNinja,2016-12-15,2016-12-15
Top 25 Most Vulnerable Systems by OS - Qualys -,Qualys,The following Splunk Search Queries within the Qualys Sourcetype list the top 25 most vulnerable systems. The queries are separated by Operating System or Device Type: Linux ,"eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""^((?!\/).)*Linux((?!\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25 eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""(F5 Networks Big-IP)|(^Cisco((?!\/).)*$)|(Firewall)"" |dedup QID IP| stats count by IP | sort -count | head 25 eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""^Windows (2000$|XP|7|8)((?!\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25 eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""^Windows .*Server((?!\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25",SplunkNinja,2016-12-15,2016-12-15
Track Remediation Progress by OS - Qualys -,Qualys,The following Splunk Search Queries within the Qualys Sourcetype track the remediation progress for a variety of operating systems. The queries are separated by Operating System or Device Type: OS & Device Agnostic ,"eventtype=""qualys_vm_detection_event"" STATUS =""FIXED"" earliest=-30d@d | dedup HOST_ID, QID | stats count by QID eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""^((?!\/).)*Linux((?!\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25 eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""(F5 Networks Big-IP)|(^Cisco((?!\/).)*$)|(Firewall)"" |dedup QID IP| stats count by IP | sort -count | head 25 eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""^Windows (2000$|XP|7|8)((?!\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25 eventtype=qualys_vm_detection_event SEVERITY > 3 | regex OS=""^Windows .*Server((?!\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25",SplunkNinja,2016-12-15,2016-12-15
Potential Suspicious Activity in Windows -,WinEventLog:Security,The following Splunk search should be ran over a long period of time (at least it worked best that way in my environment). This query will show potentially suspicious activity based on processes within a Windows environment. It could also indicate a sanctioned security scan (so don’t run out there and start pointing fingers based …,"sourcetype=""WinEventLog:Security"" EventCode=4688 NOT (Account_Name=*$) (arp.exe OR at.exe OR bcdedit.exe OR bcp.exe OR chcp.exe OR cmd.exe OR cscript.exe OR csvde OR dsquery.exe OR ipconfig.exe OR mimikatz.exe OR nbtstat.exe OR nc.exe OR netcat.exe OR netstat.exe OR nmap OR nslookup.exe OR netsh OR OSQL.exe OR ping.exe OR powershell.exe OR powercat.ps1 OR psexec.exe OR psexecsvc.exe OR psLoggedOn.exe OR procdump.exe OR qprocess.exe OR query.exe OR rar.exe OR reg.exe OR route.exe OR runas.exe OR rundll32 OR schtasks.exe OR sethc.exe OR sqlcmd.exe OR sc.exe OR ssh.exe OR sysprep.exe OR systeminfo.exe OR system32\\net.exe OR reg.exe OR tasklist.exe OR tracert.exe OR vssadmin.exe OR whoami.exe OR winrar.exe OR wscript.exe OR ""winrm.*"" OR ""winrs.*"" OR wmic.exe OR wsmprovhost.exe OR wusa.exe) | eval Message=split(Message,""."") | eval Short_Message=mvindex(Message,<wbr />0) | table _time, host, Account_Name, Process_Name, Process_ID, Process_Command_Line, New_Process_Name, New_Process_ID, Creator_Process_ID, Short_Message",john117,2016-12-08,2016-12-15
Current Vulnerability Summary by Severity (tenable) -,Tenable,"Having Tenable Security Center connected via the splunk plugin, this search gives an overview of all vulnerabilties, summarized by severity. ","sourcetype=""tenable:sc:vuln"" severity.name=* | chart count over severity.name by ip",Ronald (Access42),2017-02-12,2017-02-11
Top exploitable vulnerabilities (tenable) -,Tenable,To see the top of exploitable vulnarabilities from the Tenable Security Center: ,"sourcetype=""tenable:sc:vuln"" exploitAvailable=""yes"" | chart count over pluginName by riskFactor",Ronald (Access42),2017-02-12,2017-02-11
Overall CVSS score (tenable) -,Uncategorized,"Tenable uses the CVSS scoring method for detected vulnerabilities. To have an overall CVSS, use the following query: ","sourcetype=""tenable:sc:vuln"" ip=* |stats mean(baseScore) as base | eval base = round(base,2)",Ronald (Access42),2017-02-12,2017-02-11
Top 10 most vulnerable systems (Tenable) -,Tenable,Get an overview of the 10 most vulnerable systems in your network ,"sourcetype=""tenable:sc:vuln"" baseScore > 3 | dedup cve ip | stats count by ip, riskFactor | sort 10-count | lookup dnslookup clientip as ip | chart sum(count) by clienthost",Ronald (Access42),2017-02-13,2017-02-13
SSL Certificates expired -,Tenable,The query below will give an overview of all hosts running expired certificates: ,"sourcetype=""tenable:sc:vuln"" synopsis=""The remote server's SSL certificate has already expired."" | dedup ip | chart count by ip",Ronald (Access42),2017-02-13,2017-02-13
SSL certificates about to expire -,Tenable,The query below will give an overview of all certificates about to expire (within 60 days) ," sourcetype=""tenable:sc:vuln"" synopsis=""The SSL certificate associated with the remote service will expire soon."" | dedup ip | lookup dnslookup clientip as ip | chart count by ip,clienthost",Ronald (Access42),2017-02-13,2017-02-13
Time Offset on Splunk Servers -,REST,"This Splunk Query shows if there is a time offset on your Splunk servers. I borrowed and modified this one from the splunk clock skew search posted on www.bbosearch.com (another pretty awesome site like this one!).  My version strips the unnecessary and renames some fields, but feel free to do what you want with it: …","| rest /services/server/info | eval updated_t=round(strptime(updated, ""%Y-%m-%dT%H:%M:%S%z""), 2) | eval delta=now()-updated_t | table serverName, updated, delta | convert ctime(updated_t)| rename updated as ""Local Time on Server on Request"" delta as ""Offset - Time in Seconds""",john117,2017-02-17,2017-02-17
Overview SMB Shares with unprivileged access (tenable) -,Tenable,This search will give an overview of all SMB shares with unprivilged access. ,"sourcetype=""tenable:sc:vuln"" pluginID=42411 | table ip dnsName pluginText | rename ""pluginText"" as ""Shares enabled"" | rename ""dnsName"" as ""DNS Name"" | rename ""ip"" as ""IP address""",Ronald (Access42),2017-02-24,2017-02-24
Detect ShellShock Attempts in Apache Logs -,apache,,"sourcetype=""apache:access"" http_method=POST request=""*{ :;};*"" OR request=""*/bin/*"" | table _time, request, src_ip, dst_ip",mjeffery,2017-03-01,2017-02-28
License Usage by Pool per hour for last 24 hours -,_internal,Have a misbehaving License Pool that the admin swears he fixed this morning? ,"index=_internal source=*license_usage.log* type=Usage earliest=-24h| bucket _time span=1h | stats sum(b) as bytes by _time, pool | eval GB = round(bytes/1024/1024/1024,5) | fields _time pool GB",xoff00,2017-03-16,2017-03-16
Use REST to gather Index Info -,REST,Here is some SPL to get useful information via REST on indexes within your Splunk environment: ,"| REST /services/data/indexes
| eval currentDBSizeMB=tostring(currentDBSizeMB, ""commas"")
| eval totalEventCount=tostring(totalEventCount, ""commas"")
| eval frozenTimePeriodInHours=(frozenTimePeriodInSecs/60/60)
| table title splunk_server currentDBSizeMB frozenTimePeriodInHours maxTime minTime totalEventCount",ItsJohnLocke,2017-03-28,2017-03-28
User Info Dashboard - Using REST -,REST,I found this very useful user statistics/information splunk dashboard on www.function1.com/2016/06/rest-easy-with-the-splunk-rest-api. They have additional Splunk REST queries and examples worth checking out! ,"<dashboard>
      <label>REST API: access control</label>
      <row>
        <panel>
          <single>
            <title>You are</title>
            <searchString>| rest /services/authentication/current-context | where NOT username=""splunk-system-user"" | fields username</searchString>
            <earliestTime>0</earliestTime>
            <latestTime/>
            <option name=""drilldown"">none</option>
          </single>
        </panel>
        <panel>
          <table>
            <title>And you have these permissions</title>
            <searchString>| rest /services/authentication/current-context | where NOT username=""splunk-system-user"" | fields capabilities | mvexpand capabilities</searchString>
            <earliestTime>0</earliestTime>
            <latestTime/>
            <option name=""wrap"">true</option>
            <option name=""rowNumbers"">false</option>
            <option name=""dataOverlayMode"">none</option>
            <option name=""drilldown"">cell</option>
            <option name=""count"">5</option>
          </table>
        </panel>
      </row>
      <row>
        <panel>
          <table>
            <title>Active users (sessions)</title>
            <searchString>| rest /services/authentication/httpauth-tokens | fields userName, timeAccessed | dedup userName sortby timeAccessed</searchString>
            <earliestTime>0</earliestTime>
            <latestTime/>
            <option name=""wrap"">true</option>
            <option name=""rowNumbers"">false</option>
            <option name=""dataOverlayMode"">none</option>
            <option name=""drilldown"">cell</option>
            <option name=""count"">10</option>
          </table>
        </panel>
        <panel>
          <table>
            <title>All users (limited to 100)</title>
            <searchString>| rest /services/authentication/users | fields title, realname | head 100</searchString>
            <earliestTime>0</earliestTime>
            <latestTime/>
            <option name=""wrap"">true</option>
            <option name=""rowNumbers"">false</option>
            <option name=""dataOverlayMode"">none</option>
            <option name=""drilldown"">cell</option>
            </table>
        </panel>
        <panel>
          <chart>
            <title>Users by authentication system</title>
            <searchString>| rest /services/authentication/users | fields title, type | stats count by type</searchString>
            <earliestTime>0</earliestTime>
            <latestTime/>
            <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
            <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
            <option name=""charting.axisTitleX.visibility"">visible</option>
            <option name=""charting.axisTitleY.visibility"">visible</option>
            <option name=""charting.axisTitleY2.visibility"">visible</option>
            <option name=""charting.axisX.scale"">linear</option>
            <option name=""charting.axisY.scale"">linear</option>
            <option name=""charting.axisY2.enabled"">false</option>
            <option name=""charting.axisY2.scale"">inherit</option>
            <option name=""charting.chart"">pie</option>
            <option name=""charting.chart.nullValueMode"">gaps</option>
            <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
            <option name=""charting.chart.stackMode"">default</option>
            <option name=""charting.chart.style"">shiny</option>
            <option name=""charting.drilldown"">all</option>
            <option name=""charting.layout.splitSeries"">0</option>
            <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
            <option name=""charting.legend.placement"">right</option>
          </chart>
        </panel>
      </row>
    </dashboard>",ItsJohnLocke,2017-03-30,2017-03-30
Overview of all medium to critical risks for Win20xx -,Tenable,Get an overview of all medium to critical risks for Windows 2008 / 2012: Windows 2008: ,"sourcetype=""tenable:sc:vuln"" cpe:/o:microsoft:windows_server_2008  | table ip, netbiosName, dnsName, severity.name, pluginName, solution, description | join ip type=inner max=0 [search index=main sourcetype=""tenable:sc:vuln"" baseScore>3  | table ip, netbiosName, dnsName, severity.name, pluginName, solution, description ] | sort by severity.name | chart count by severity.name sourcetype=""tenable:sc:vuln"" cpe:/o:microsoft:windows_server_2012  | table ip, netbiosName, dnsName, severity.name, pluginName, solution, description | join ip type=inner max=0 [search index=main sourcetype=""tenable:sc:vuln"" baseScore>3  | table ip, netbiosName, dnsName, severity.name, pluginName, solution, description ] | sort by severity.name | chart count by severity.name",Ronald (Access42),2017-04-06,2017-04-06
Sysmon - Find Processes with Renamed Executables -,Uncategorized,,"index=* sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational"" EventCode=1 | rex field=Image ""[\\\/](?<filename>[^\\\/]*)$"" | eval filename=lower(filename)| stats dc(filename) as NumFilenames values(filename) as Filenames values(Image) as Images by Hashes | where NumFilenames>1",jwalzer,2017-07-02,2017-07-01
Sysmon - Outbound Connections by Process -,Uncategorized,,"sourcetype=""XmlWinEventLog:Microsoft-Windows-Sysmon/Operational"" EventCode=3 Protocol=tcp Initiated=true | eval src=if(isnotnull(SourceHostname), SourceHostname+"":""+SourcePort, SourceIp+"":""+SourcePort) | eval
 dest=if(isnotnull(DestinationHostname), DestinationHostname+"":""+DestinationPort, DestinationIp+"":""+DestinationPort) | eval src_dest=src+ "" => "" + dest | stats values(src_dest) as Connection by ProcessGuid ProcessId User Computer Image",jwalzer,2017-07-02,2017-07-01
Sysmon - cmd line for non -local connections -,Uncategorized,,"sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational"" EventCode=3 Protocol=tcp Initiated=true | where DestinationIp!=""127.0.0.1"" AND DestinationHostname!=SourceHostname| table _time User Computer
 ProcessId ProcessGuid DestinationHostname DestinationPort | join type=inner [search sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational"" EventCode=1 | table _time ProcessGuid ProcessId CommandLine]",jwalzer,2017-07-02,2017-07-01
Extract DNS Queries from netscaler syslog -,citrix:netscaler:syslog,To extract the DNS logging from netscaler:syslog you need the following regex: ^," index=network_netscaler sourcetype=""citrix:netscaler:syslog"" DNS | regex ""^\s+(?P<date>[^:]+):(?P<time>[^ ]+)(?:[^:\n]*:){3}(?P<source_ip>[^#]+)(?:[^/\n]*/){8}\d+#(?P<dns>(?#)[_a-zA-Z0-9.-]+)(\.\/)"" | table time, date, source_ip, dns",Ronald (Access42),2017-07-06,2017-07-05
Find queues that are nearly full -,_internal,Easily find Splunk Instances (both forwarders and full installs) that have queues that are over 80% full! ,"index=_internal group=queue | eval percfull=((current_size_kb/max_size_kb)*100) | search percfull>80 | dedup host, name | table _time host name current_size_kb max_size_kb",xoff00,2017-08-23,2017-08-23
Fishies! Fun Query and Easter Egg -,Fun Stuff & Helpful Hints,Here is a fun query that you may have seen as an Easter egg in an app. I stumbled on this while cleaning up old saved searches. If you know the app comment below!   FYI make sure you run this in real time otherwise you won’t see the fun part :) ,"index=_* OR index=* | head 1 | eval fish=""><((*>"" | eval fishies=mvappend(fish,fish) | eval fishies=mvappend(fishies,fishies) | eval fishies=mvappend(fishies,fishies) | eval fishies=mvappend(fishies,fishies) | eval spawnify=fishies | mvexpand spawnify | eval fishies=mvjoin(fishies,"" "") | streamstats count as offset | eval offset=(offset*3) % 7 | addinfo | eval make_swim=round(info_max_time-info_search_time) | eval fishies=substr(fishies,(10*16)-(make_swim-offset+10),100+offset) | fields fishies | streamstats count | eval fishies=if(count==16,""FATAL ERROR: you have unleashed an army of fish."",fishies) | fields fishies | rename fishies as _raw | fields - _time | eval _raw=substr(_raw,0,100)",SplunkNinja,2017-10-12,2017-10-12
Failed Attempts to Logon to Splunk Web -,_internal,The following Splunk Search Query will return all users who have failed to logon to the Splunk Web console. This query will also include an average (from eventstats).   ,"index=_audit action=""login attempt"" info=failed | timechart count(user) as Failed_Attempts| eventstats avg(Failed_Attempts) as Average",SplunkNinja,2015-09-14,2017-10-13
Unable to get a search to work properly -,RFQ - Request For Query,"Hi All, I have been trying to get the following search to work for weeks now, with no luck. My entire team has looked at it as well as our local user group and our Account Manager’s SE. No one has been able to figure out why the search isn’t working properly. Here is some …","| inputlookup flash_mi-000085-mw | lookup dnsLookup host as fqdn | inputlookup flash_mi-000085-mw | lookup dnsLookup host as fqdn | search sourcetype=cisco:asa dest_ip=""xxx.xxx.0.0/16"" OR src_ip=""xxx.xxx.0.0/16"" AND ip | inputlookup flash_mi-000085-mw | lookup dnsLookup host as fqdn | search sourcetype=cisco:asa dest_ip=""xxx.xxx.0.0/16"" OR src_ip=""xxx.xxx.0.0/16"" AND ip | where fqdn!="""" | table fqdn ip dest_ip src_ip",irishjd,2017-11-14,2017-11-13
Find passwords in User_Name field -,eval,"This eval for password can be easily used for any field where a user can accidentally type in a password or even worse both username/password during login which generates a failed event.   Below example is for Windows failed login.  The eval will match 10 or more characters with 1 uppercase, 1 lower case, 1 …"," source=WinEventLog:Security TaskCategory=Logon Keywords=""Audit Failure"" | eval password=if(match(User_Name, ""^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[\W])(?=.{10,})""), ""Yes"", ""No"") | stats count by password User_Name | search password=Yes",thall,2017-12-02,2017-12-02
Remove Z or T string from your Timestamp -,eval,| rest /services/authentication/current-context | table username roles updated | search username!=splunk-system-user | rex field=updated (?<timestampA>,,sahr.lebbie,2018-01-03,2018-01-02
IIS: Indicators of XSS and SQLi attacks -,IIS,"The following query show IoC for XSS and SQLi. The complete query is wrapped up since this site is not accepting it. The query should also include “OR javascript”, followed by “:alert”. ","index=* sourcetype=""ms:iis:default"" NOT (""cookie.js"" OR ""script.js"" OR ""cookie-min.js"" OR ""RESET-COOKIE"" OR ""form.user-info-from-cookie"") AND (“&#” OR ""script>"" OR ""script%3E"" OR ""`"" OR ""cookie"" OR alert\( OR ""</"" OR ""@@"" OR ""%40%40"" OR ""<scr"" OR ""%3Cscr"" OR ""<"" OR ""%3C%2F"" OR ""..%2F"" OR "".."" OR ""%2E%2E"") uri_query!=""-"" uri_query!=""utm_*""| table _time, clientip, status, uri_query | sort by _time desc",Ronald (Access42),2018-02-07,2018-02-06
IIS: 401 and 403 errors -,IIS,"Get an overview of 401 and 403 errors, an increase might be an IoC. ","<code>index=* sourcetype=""ms:iis:default"" sc_status=401 OR sc_status=403 |table _time, sc_status, sc_substatus, uri_path | timechart count by sc_status</code>",Ronald (Access42),2018-02-07,2018-02-06
IIS: 404 errors -,IIS,"Get an overview of all 404 errors, an increase might be an IoC ","index=web_p sourcetype=""ms:iis:default"" status=404 | timechart count",Ronald (Access42),2018-02-07,2018-02-06
"IIS: Indicators of directory traversal, RFI and LFI -",IIS,"The following shows IoC for directory traversal, RFI and LFI within IIS logging: ","index=* sourcetype=""ms:iis:default""NOT (""cookie.js"" OR ""script.js"") AND (referer=""-"" OR referer="""") AND (uri_query=""*passwd*"" OR uri_query=""*cmd*"" OR uri_query=""*%00*"" OR uri_query=""*.txt*"")|table _time, clientip, status, uri_query",Ronald (Access42),2018-02-07,2018-02-06
Basic binary conversion for IPv4 Mask -,Hack,"Given an IP network address and it’s netmask represented under integer format, the bellow search will create a CIDR representation from the lookup without using built-in tools.   ","|inputlookup geoip | head 100

| eval mask_int=end_ip_int-start_ip_int

| eval mask_bin=replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(tostring(mask_int, ""hex""), 3), ""0"", ""0000""), ""1"", ""0001""), ""2"", ""0010""), ""3"", ""0011""), ""4"", ""0100""), ""5"", ""0101""), ""6"", ""0110""), ""7"", ""0111""), ""8"", ""1000""), ""9"", ""1001""), ""A"", ""1010""), ""B"", ""1011""), ""C"", ""1100""), ""D"", ""1101""), ""E"", ""1110""), ""F"", ""1111"")

| eval mask_bin=ltrim(tostring(mask_bin),""0"")

| eval mask_cidr=32-length(mask_bin)

| eval cidr=start_ip_oct . ""/"" . mask_cidr
| table start_ip_oct, end_ip_oct, cidr |inputlookup geoip | head 100 | eval mask_int=end_ip_int-start_ip_int | eval mask_cidr=32-ceiling(log(mask_int,2)) | eval cidr=start_ip_oct . ""/"" . mask_cidr
| table start_ip_oct, end_ip_oct, cidr",masdeeper,2018-03-10,2018-03-10
date_zone=local is bad -,Hygiene,"Impact: since there is no timezone, the logs will have the same timezone as the local user. Therefore in another timezone, the logs won’t have the same order. If no TZ is specified, perhaps we could hard code one. ","|tstats count where index=* date_zone=local by index, sourcetype",masdeeper,2018-03-10,2018-03-10
Parsing Military Time Zones -,Hygiene,"Sorry but a query would not be elegant. TIME_FORMAT=%Y-%m-%dT%H:%M:%S.%3N%Z TZ_ALIAS = A=GMT+1:00, B=GMT+2:00, C=GMT+3:00, D=GMT+4:00, E=GMT+5:00, F=GMT+6:00, G=GMT+7:00, H=GMT+8:00, I=GMT+9:00, K=GMT+10:00, L=GMT+11:00, M=GMT+12:00",,masdeeper,2018-03-10,2018-03-10
"List skipped searches by name, reason -",splunkd,,index=_internal sourcetype=scheduler savedsearch_name=* status=skipped | stats count by savedsearch_name reason,masdeeper,2018-03-10,2018-03-10
List of index available to your role -,splunkd,,|tstats count WHERE index=* OR index=_ BY index,masdeeper,2018-03-10,2018-03-10
Detect Scheduler Running Twice a Search -,splunkd,There is a bug that make a search being executed 2 times or more. ,"index=_internal sourcetype=scheduler scheduled_time=* savedsearch_name=* |stats count by scheduled_time, savedsearch_name | where count > 1",masdeeper,2018-03-10,2018-03-10
Top Offending SSH Failure by Source IP -,Monitoring,This displays a list of failed attempts against each connecting IP. Can be used to detect brute force from a particular source IP. You can then put a block up via ACL or whatever method you chose to mitigate the issue. The NOT clause on the first line ignore all attempts to logon to “invalid …," index=hosts ""Failed password for "" NOT ""Failed password for invalid"" 
 | rex ""Failed\spassword\sfor\s(?<username>.*)\sfrom\s(?<source_ip>\d+.\d+.\d+.\d+)\sport\s(?<port>\d+)\s(?<protocol>.*)"" 
 | stats count(source_ip) as ""Failed Attempts"" by source_ip
 | iplocation source_ip
 | sort - ""Failed Attempts""
 | table source_ip,""Failed Attempts"",City,Country",DaveyBoy,2018-04-24,2018-04-23
Easter egg that created sample data -,Fun Stuff & Helpful Hints,, | windbag,Azeemering,2018-04-27,2018-04-26
Compare Successful Internal Vs External Connections -,Monitoring,This query will display a bar chart of all successful Internal vs External SSH connections. Useful for identifying any spikes in connectivity coming from within your network remit or outside of it. Simply change the CIDR matches to match your required LANs. ,"""sshd"" AND ""Accepted password"" 
 | rex ""[a-zA-z]{3}\s\d+\s\d+:\d+:\d+\s[a-zA-Z0-9-.]*\s[a-zA-z]{3}\s\d+\s\d+:\d+:\d+\s(?<hostname>.*)\ssshd\[\d+\]:\sAccepted\spassword\sfor\s(?<username>.*)\sfrom\s(?<sourceip>.*)\sport\s(?<sourceport>.*)\sssh2""
 | eval network=case(cidrmatch(""192.168.0.0/24"", sourceip),""Internal"",
                     cidrmatch(""10.10.0.0/16"",sourceip),""Internal"",
                     cidrmatch(""192.168.20.0/24"",sourceip),""Internal"",
                     1=1,""External"")
| timechart count(username) by network",DaveyBoy,2018-04-27,2018-04-26
Detect Username Guessing Brute Force Attacks -,Monitoring,"The below will detect a form of brute force which most will miss. Whereas other scripts detect multiple logins against a single account, they fail to detect 4 failed logins against 40 accounts. This first checks for all accounts having an account login failure of 4 or more, it then checks for the quantity of …","sourcetype=windows EventCode=4625 OR EventCode=4624 
 | bin _time span=5m as minute 
 | rex ""Security ID:\s*\w*\s*\w*\s*Account Name:\s*(?<username>.*)\s*Account Domain:"" 
 | stats count(Keywords) as Attempts,
 count(eval(match(Keywords,""Audit Failure""))) as Failed,
 count(eval(match(Keywords,""Audit Success""))) as Success by minute username
 | where Failed>=4
 | stats dc(username) as Total by minute 
 | where Total>5",DaveyBoy,2018-04-27,2018-04-26
Search for all errors in splunkd -,_internal,,"index=_internal sourcetype=""splunkd"" log_level=""ERROR""
 | stats sparkline count dc(host) as hosts last(_raw) as last_raw_msg values(sourcetype) as sourcetype last(_time) as last_msg_time first(_time) as first_msg_time values(index) as index by punct
 | eval delta=round((first_msg_time-last_msg_time),2)
 | eval msg_per_sec=round((count/delta),2)
 | convert ctime(last_msg_time) ctime(first_msg_time)
 | table last_raw_msg count hosts sparkline msg_per_sec sourcetype index first_msg_time last_msg_time delta
 | sort -count",Azeemering,2018-05-16,2018-05-15
Search for duplicate events in Splunk -,Hygiene,,index=<indexname> | stats count values(host) values(source) values(sourcetype) values(index) by _raw | WHERE count>1,Azeemering,2018-05-16,2018-05-15
Search Traffic by Source IP -,datamodels,"GoSplunk Admin Notes: If you have a data model enabled that matches the search below, this might work for you! ","| datamodel Network_Traffic All_Traffic search | search All_Traffic.src_ip=10.x.x.x | stats count by All_Traffic.src_ip, All_Traffic.dest,All_Traffic.action, dstcountry | dedup All_Traffic.dest",pradeep577,2018-06-19,2018-06-19
Average Search Duration -,_internal,Ever wonder how your search performance is across search heads? Try this query. Depending on your environment you’ll want to specify the host=* section to better represent your environment. Say if you have a naming convention that includes “shc” and a number representing searchheads in a cluster (distributed environment) you can use (host=shc1.fq.dn OR host=shc2.fq.dn …,"index=_audit sourcetype=audittrail action=search total_run_time=* host=* | dedup search_id | eval runtime=if(isnum(total_run_time), total_run_time, ""null"") | where runtime!=""null"" | timechart span=15m avg(runtime) as ""Average Run Time"" by host limit=0",ItsJohnLocke,2018-06-28,2018-06-28
Find success login after 10 failures with streamstats -,datamodels,If you have the Authentication data model configured you can use the following search to quickly find successful logins after 10 failed attempts! ,"| from datamodel:""Authentication"".""Authentication""
| search action=failure or action=success
| reverse
| streamstats window=0 current=true reset_after=""(action=\""success\"")"" count as failure_count by src
| where action=""success"" and failure_count > 10",iv.shamanow,2018-07-05,2018-07-05
List all fields for an index -,Fun Stuff & Helpful Hints,A few different queries / methods to list all fields for indexes. ,index=yourindex| fieldsummary | table field index=yourindex | stats values(*) AS * | transpose | table column | rename column AS Fieldnames index=yourindex | stats dc() as * | transpose index=yourindex | table *,Azeemering,2018-07-17,2018-07-17
Direct and Referred Apache Web Traffic -,apache,"The following query will show all traffic to an Apache web server that is direct, meaning no referring site. ","sourcetype=""access_combined"" referer=""-"" | stats count sourcetype=""access_combined"" referer!=""-"" | stats count sourcetype=""access_combined"" referer=""-"" | timechart span=1d count sourcetype=""access_combined""
| eval Direct=if(referer=""-"", ""1"", ""0"")
| eval Referred=if(referer!=""-"", ""1"", ""0"")
| timechart span=1d sum(Direct) as ""Direct Traffic"" sum(Referred) as ""Referred Traffic""",SplunkNinja,2018-07-20,2018-07-20
Apache High Level Visitor Info -,apache,The following query gives a breakdown on traffic by clientip. I run this over all time so I can get detailed information on first visit versus latest visit as you can see below. ,"sourcetype=access_combined (referer_domain!=""https://gosplunk.com"" AND referer_domain!=""http://gosplunk.com"")
| iplocation clientip
| stats first(_time) as First_Visit latest(_time) as Last_Visit sum(eval(round(bytes/1024/1024,2))) as MB first(Country) as Country count as Views first(referer_domain) as Referer_Domain first(uri) as Landing_Page by clientip
| eval diff_time_days=round((Last_Visit-First_Visit)/60/60/24, 6)
| convert ctime(First_Visit) ctime(Last_Visit)
| fields clientip Country First_Visit Last_Visit diff_time_days MB Views Referer_Domain Landing_Page
| fillnull value=""0"" sourcetype=access_combined (referer_domain!=""https://gosplunk.com"" AND referer_domain!=""http://gosplunk.com"")
| iplocation clientip
| stats first(_time) as First_Visit latest(_time) as Last_Visit sum(eval(round(bytes/1024/1024,2))) as MB first(Country) as Country count as Views first(referer_domain) as Referer_Domain first(uri) as Landing_Page by clientip
| eval diff_time_days=round((Last_Visit-First_Visit)/60/60/24, 6)
| convert ctime(First_Visit) ctime(Last_Visit)
| fields clientip Country First_Visit Last_Visit diff_time_days MB Views Referer_Domain Landing_Page
| fillnull value=""0""
| outputlookup historical_client_insight.csv | inputlookup historical_client_insight.csv",SplunkNinja,2018-07-21,2018-07-21
Add a count of events by fieldname -,Fun Stuff & Helpful Hints,The streamstats count command creates a field called eventCount that displays the amount of events from the fieldname you specify: ,| streamstats count as eventCount by fieldname,Azeemering,2018-07-24,2018-07-24
Active Directory Password change attempts -,WinEventLog:Security,Use the following search to create a stacked barchart of AD Password change attempts: ,"source=""WinEventLog:Security"" ""EventCode=4723"" src_user!=""*$"" src_user!=""_svc_*"" | eval daynumber=strftime(_time,""%Y-%m-%d"") | chart count by daynumber, status | eval daynumber = mvindex(split(daynumber,""-""),2)",Azeemering,2018-07-24,2018-07-24
Timechart of the status of an Locked Out Account -,WinEventLog:Security,This query will show a timechart of the status of an Locked Out Account ,"sourcetype=""WinEventLog:Security"" EventCode=4625 AND Status=0xC0000234 | timechart count by user | sort -count",Azeemering,2018-07-24,2018-07-24
Universal Forwarder Throughput Statistics -,_internal,This search creates a table to list all  Universal Forwarders. There is also an eval in there that classifies hosts based on their average Kbps. You can modify this as needed. ,"index=_internal source=*metrics.log group=tcpin_connections splunk_server=* 
| eval host=if(isnull(hostname), sourceHost,hostname) 
| search (host=*) AND (host!=""(ALL)"")
| eval connectionType=case(fwdType==""uf"",""univ fwder"", fwdType==""lwf"", ""lightwt fwder"",fwdType==""full"", ""heavy fwder"", connectionType==""cooked"" or connectionType==""cookedSSL"",""Splunk fwder"", connectionType==""raw"" or connectionType==""rawSSL"",""legacy fwder"") 
| eval Ver=if(isnull(version),""pre 4.2"",version) 
| fields connectionType sourceIp host kb tcp_eps tcp_KBps splunk_server Ver
| stats min(_time) as first_time, max(_time) as last_time, max(tcp_KBps) as max_tcp_KBps, avg(tcp_KBps) as avg_tcp_KBps, avg(tcp_eps) as avg_tcp_eps, sum(kb) as sum_kb by connectionType sourceIp host Ver 
| dedup host
| eval sum_mb = round(sum_kb/1024,0) 
| fields - sum_kb 
| eval avg_tcp_KBps = round(avg_tcp_KBps,0)
| eval max_tcp_KBps = round(max_tcp_KBps,0)
| eval class=case(
avg_tcp_KBps>0 AND avg_tcp_KBps<=128, ""Standard Hosts"",
avg_tcp_KBps>128 AND avg_tcp_KBps<=256, ""Better Hosts"",
avg_tcp_KBps>256, ""Special Hosts"")
| convert ctime(*time) 
| rename first_time as ""First seen"", last_time as ""Last seen"", avg_tcp_KBps as ""AVG KB/s"", avg_tcp_eps as ""AVG Events/s per 30 seconds"", sum_mb as ""Total MB"", max_tcp_KBps as ""Peak Kbps"" connectionType AS ""Forwarder Type"" sourceIp as ""Source IP"" host AS ""Host"" Ver As ""Splunk Version""
| sort - ""Peak Kbps""",Azeemering,2018-07-24,2018-07-24
Top 10 Accessed Dashboards -,_internal,"Where “host=”your_sh_host”” you could specify a host, or put a wildcard * in place. ","index=""_internal"" source=*access.log user!=""-"" */app/* (host=""your_sh_host"") 
| rex field=referer ""/en-US/app/(?<app>[^/]+)/(?<dashboard>[^?/\s]+)"" 
| top 10 dashboard",Azeemering,2018-07-24,2018-07-24
Universal Forwarder Throughput Limit Hit Count -,_internal,This search counts the amount of times the UF’s throughput limit is hit. I also threw in a sparkline: ,"index=_internal sourcetype=splunkd ""current data throughput"" | rex ""Current data throughput \((?<kb>\S+)"" | eval rate=case(kb < 500, ""256"", kb > 499 AND kb < 520, ""512"", kb > 520 AND kb < 770 ,""768"", kb>771 AND kb<1210, ""1024"", 1=1, "">1024"") | stats count as Count sparkline as Trend by host, rate | where Count > 4 | rename host as ""Host"" rate as ""Throughput rate(kb)"" count as ""Hit Count""| sort -""Throughput rate(kb)"",-Count",Azeemering,2018-07-24,2018-07-24
Show all Indexes and Sourcetypes via REST -,REST,The following Splunk query uses REST to display non internal indexes associated with sourcetypes. It is my understanding that this is all time (such is the way of REST searches) ,"| rest /services/data/inputs/all
| search index!=_*
| stats values(sourcetype) by index",ItsJohnLocke,2018-07-25,2018-07-25
Forwarder Diagnostics - Last time Data Was Received by Index and Sourcetype -,_internal,"The following Splunk query was modified from the Splunk Health Overview app on Splunkbase. This particular Splunk search returns a list of hosts with their indexes and sourcetypes and determines when each last sent data. This query can help diagnose which Splunk Universal Forwarders may be having issues sending data, or simply stopped sending a …","| tstats latest(_time) as Latest where index=* by host sourcetype index 
| eval current=now() 
| eval Minimum_Age=round(((current-Latest)/60)/60,2) 
| rangemap field=Minimum_Age default=Critical Normal=0-0.5 Elevated=0.5-2 Warning=2-4
| eval stIDX=tostring(index) + "" -- "" + tostring(sourcetype)
| stats values(stIDX) as ""Index -- Sourcetype"" list(Latest) as ""Latest Event"" list(Minimum_Age) as Minimum_Age list(range) as Threshold by host 
| convert ctime(""Latest Event"") 
| eventstats avg(Minimum_Age) as average by host 
| eval average=round(average,2) 
| sort - average
| rename Minimum_Age as ""Hours Since Last Communication"" average as ""Average Time in Hours Since Last Communication""",SplunkNinja,2016-06-17,2018-07-25
Memory Usage (MB) per Splunk Process Class -,_internal,Use the following search with a column chart visualisation. It will give you a good overview of what Splunk processes use the most memory: ,"index=_introspection sourcetype=splunk_resource_usage component=PerProcess host=* | eval process = 'data.process' | eval args = 'data.args' | eval sid = 'data.search_props.sid' | eval elapsed = 'data.elapsed' | eval mem_used = 'data.mem_used' | eval mem = 'data.mem' | eval pct_memory = 'data.pct_memory' | eval app = 'data.search_props.app' | eval type = 'data.search_props.type' | eval mode = 'data.search_props.mode' | eval user = 'data.search_props.user' | eval role = 'data.search_props.role' | eval process_class = case( process==""splunk-optimize"",""index service"", process==""sh"" OR process==""ksh"" OR process==""bash"" OR like(process,""python%"") OR process==""powershell"",""scripted input"", process==""mongod"", ""KVStore"") | eval process_class = case( process==""splunkd"" AND (like(args,""-p %start%"") OR like(args,""service"")),""splunkd server"", process==""splunkd"" AND isnotnull(sid),""search"", process==""splunkd"" AND (like(args,""fsck%"") OR like(args,""recover-metadata%"") OR like(args,""cluster_thing"")),""index service"", process==""splunkd"" AND args==""instrument-resource-usage"", ""scripted input"", (like(process,""python%"") AND like(args,""%/appserver/mrsparkle/root.py%"")) OR like(process,""splunkweb""),""Splunk Web"", isnotnull(process_class), process_class) | eval process_class = if(isnull(process_class),""other"",process_class) | stats latest(data.mem_used) AS resource_usage_dedup latest(process_class) AS process_class by data.pid, _time | stats sum(resource_usage_dedup) AS resource_usage by _time, process_class | timechart minspan=10s median(resource_usage) AS ""Resource Usage"" by process_class ",Azeemering,2018-07-26,2018-07-26
Bucket Count by indexer/index -,_internal,This search displays the amount of buckets per indexer/index To learn more about the | dbinspect command go to: http://docs.splunk.com/Documentation/Splunk/7.1.2/SearchReference/Dbinspect ,|dbinspect index=* | search index!=_* | chart dc(bucketId) over splunk_server by index,Azeemering,2018-07-26,2018-07-26
Bucket Count by State over Index -,_internal,This search counts the amount of buckets per state for each index. To learn more about | dbinspect go to: http://docs.splunk.com/Documentation/Splunk/7.1.2/SearchReference/Dbinspect ,"|dbinspect index=* | eval state=case(state==""warm"" OR state==""hot"",""hot/warm"",1=1, state) | chart dc(bucketId) over index by state",Azeemering,2018-07-26,2018-07-26
Show Splunk User to Role mapping -,REST,"The following Splunk REST query shows all roles, number of  capabilities, and landing app for each user. ","| rest /services/authentication/users 
| eval name=coalesce(realname, title) 
| stats values(roles) as Role first(defaultApp) as ""Landing App"" count(capabilities) as ""Number of Capabilities"" by name",SplunkNinja,2018-07-27,2018-07-26
Retention Period in days per index -,REST,This query will give you a table of all indexes and their respective retention period in days: ,"| rest splunk_server=* /services/data/indexes | join type=outer title [
| rest splunk_server=* /services/data/indexes-extended
] | eval retentionInDays=frozenTimePeriodInSecs/86400
| table title retentionInDays",Azeemering,2018-07-31,2018-07-31
Percentage of skipped searches -,_internal,This query will give you a table with a percentage of skipped searches and an evaluation with 3 ranges ,"index=_internal sourcetype=scheduler | stats count as total, count(eval(status=""skipped"")) as skipped | eval pct=round(skipped/total * 100, 0) | rangemap field=pct low=0-10, elevated=10-20 severe=20-100 | eval pct = pct . ""%"" | fields pct, range",Azeemering,2018-07-31,2018-07-31
Show indexing queue sizes -,_internal,Use a linechart with this search to show you the indexing queue sizes: ,index=_internal source=*metrics.log group=queue (name=parsingqueue OR name=indexqueue OR name=typingqueue OR name=aggqueue) | timechart avg(current_size) by name,Azeemering,2018-07-31,2018-07-31
Saved Search Scheduler Activity -,_internal,"I use this query a lot to tune and adjust scheduling, find out what searches need attention: ","index=_internal sourcetype=scheduler result_count | extract pairdelim="","", kvdelim=""="", auto=f | stats avg(result_count) min(result_count) max(result_count), sparkline avg(run_time) min(run_time) max(run_time) sum(run_time) values(host) AS hosts count AS execution_count by savedsearch_name, app | join savedsearch_name type=outer [| rest /servicesNS/-/-/saved/searches | fields title eai:acl.owner cron_schedule dispatch.earliest_time dispatch.latest_time search | rename title AS savedsearch_name eai:acl.app AS App eai:acl.owner AS Owner cron_schedule AS ""Cron Schedule"" dispatch.earliest_time AS ""Dispatch Earliest Time"" dispatch.latest_time AS ""Dispatch Latest Time""]| rename savedsearch_name AS ""Saved Search Name"" search AS ""SPL Query"" app AS App | makemv delim="","" values(host) | sort - avg(run_time) | table ""Saved Search Name"", App, Owner, ""SPL Query"", ""Dispatch Earliest Time"" ""Dispatch Latest Time"" ""Cron Schedule"" hosts, execution_count, sparkline, *(result_count), sum(run_time) *(run_time)",Azeemering,2018-07-31,2018-07-31
Indexes in Splunk -,REST,For those who have more than a few indexes (we’ve got 27 non-administrative indexes) I wrote this search so people could figure-out what we have and what it is used for. The search requires that there be a file called indexdescriptions.csv located in $SPLUNK_HOME/etc/apps/search/lookups (or “Program Files”,"| REST /services/data/indexes | rename title as index
| search NOT index=_* NOT index=splunklogger NOT index=firedalerts NOT index=history
| sort index
| streamstats count as Row
| eval State=case(disabled==0, “Enabled”, disabled==1, “Disabled <<==="")
| eval ""Retention Days""=frozenTimePeriodInSecs/86400
| lookup indexdescriptions.csv index OUTPUTNEW description
| fields Row index State description ""Retention Days""",wrangler2x,2018-08-01,2018-07-31
License Usage Prediction -,_internal,"There is an older Splunk query here that had previously predicted license usage. I’m not sure why (perhaps the predict command has changed since the original post in 2015?), but the query is no longer working. I’ve updated the query to predict Splunk license usage using the Splunk predict command as shown below: ","index=_internal source=""*license_usage.lo*"" type=Usage 
| eval GB=round(b/1024/1024/1024, 2) 
| timechart span=1d avg(GB) as Gigabytes 
| predict Gigabytes",ItsJohnLocke,2018-08-02,2018-08-02
Windows security daily domain activities -,WinEventLog:Security,,"sourcetype=WinEventLog:Security src_nt_domain!=""NT AUTHORITY"" EventCode=4720 OR EventCode=4726 OR EventCode=4738 OR EventCode=4767 OR EventCode=4781 OR EventCode=4727 OR EventCode=4730 OR EventCode=4731 OR EventCode=4734 OR EventCode=4735 OR EventCode=4737 OR EventCode=4744 OR EventCode=4745 OR EventCode=4748 OR EventCode=4749 OR EventCode=4750 OR EventCode=4753 OR EventCode=4754 OR EventCode=4755 OR EventCode=4758 OR EventCode=4759 OR EventCode=4760 OR EventCode=4763 OR EventCode=4764 OR EventCode=4728 OR EventCode=4729 OR EventCode=4732 OR EventCode=4733 OR EventCode=4746 OR EventCode=4747 OR EventCode=4751 OR EventCode=4752 OR EventCode=4756 OR EventCode=4757 OR EventCode=4761 OR EventCode=4762
| rex field=member_id ""^\w+\W(?<ITS_Admin>\w*\s\w*\s\w*|\w+_\w+|\w*\s\w*|\w*)(\s\w+\W|\s)(?<Target_Account>.*\S)""
| eval Target_Account=if(Target_Account=""NONE_MAPPED"", trim(member_dn, ITS_Admin), Target_Account)
| table _time, EventCode, EventCodeDescription, src_nt_domain, ITS_Admin, Target_Account,src_nt_domain,msad_action,Group_Name
| sort EventCodeDescription,ITS_Admin, Target_Account
| rename ITS_Admin as ""ITS Admin"", src_nt_domain as ""Source Domain""",ddanielnp,2018-08-16,2018-08-16
count all events for 1 or multiple index(es) -,Monitoring,Total count of all events for 1 or more index(es) Approach 1 (fastest) ,"| eventcount index=foo | eventcount index=foo index=bar | tstats count where index=foo OR index=bar by span=1d _time index index=foo OR index=bar
| chart count(index) by index
| sort - count(index)
| rename count(index) as ""Eventcount""",sedi,2018-08-18,2018-08-18
Concurrent Users on Apache Web -,apache,I’ve been working through this query and depending on the length of time you are looking back you can use one of the following two methods. Option 1 – Short time window (30 days or less) concurrent users for a span of 5 minutes. ,"sourcetype=""access_combined""
| timechart span=5m dc(clientip) as ""Concurrent Users"" sourcetype=""access_combined""
| streamstats time_window=5m dc(clientip) as uniq_user
| timechart span=1h min(uniq_user) as ""Minimum Concurrent Users"" max(uniq_user) as ""Maximum Concurrent Users"" eval(round(avg(uniq_user),0)) as ""Average Concurrent Users""",SplunkNinja,2018-07-13,2018-08-18
List forwarders generating socket errors due to unkown SSL protocol -,_internal,"If you are using SSL on port 9997 or 9998 (or other port) to send logs from your forwarders to your indexers, you know that a misconfigured forwarder or one with incorrect certs can generate these errors. This search gives you a succinct summary of those hosts. Use Today in the timepicker. Note: Add an …","index=_internal source=""/opt/splunk/var/log/splunk/splunkd.log"" HttpListener ""Socket error from ""
| rex ""(?<errorLog>WARN\s+HttpListener\s.*?Socket error.*)""
| rex field=errorLog ""WARN\s+HttpListener\s.*?Socket error from\s+(?<ip>[^ ]+)""
| lookup dnsLookup ip OUTPUT host as ForwarderInDNS
| rename ip as ForwarderIP
| stats earliest(_time) AS EarliestSeen latest(_time) as LatestSeen count by ForwarderIP ForwarderInDNS errorLog
| convert timeformat=""%Y/%m/%d - %H:%M:%S"" ctime(EarliestSeen)
| convert timeformat=""%Y/%m/%d - %H:%M:%S"" ctime(LatestSeen)
| Eval Comment=""This error indicates a problem with certificate installation or path to certs configuration""
| fields EarliestSeen LatestSeen ForwarderIP ForwarderInDNS errorLog Comment count
| sort ForwarderInDNS",wrangler2x,2018-08-21,2018-08-21
"identify knowledge objects, permissions and extractions -",Uncategorized,"The following will: list all knowledge objects for your SH (or given search peer(s)) each objects name, type, app, permissions, sharing (e.g. global, app, private) and owner if props-extract: the props stanza, props type (e.g if its Inline or Transforms), props sourcetype and props value (e.g. the regex) if transforms-extract: the state (tf_disabled), format (tf_format), tf_fields …","| rest /servicesNS/-/-/admin/directory count=0 splunk_server=local | fields eai:acl.app, eai:acl.owner, eai:acl.perms.*, eai:acl.sharing, title, eai:type, disabled
| foreach eai:*.* 
    [ rename ""<<FIELD>>"" TO <<MATCHSEG2>> ]
| foreach eai:* 
    [ rename ""<<FIELD>>"" TO <<MATCHSTR>> ]
| eval attribute=replace(title,""(.*:\s+)(.*)"",""\2"")
| eval st=replace(title,""(.*)(\s+:.*)"",""\1"")
| eval props_sourcetype=if(st==attribute,"""",st)
| join type=outer attribute
    [| rest /servicesNS/-/-/admin/props-extract count=0 splunk_server=local | fields attribute value stanza type | rename value TO props_value, stanza to props_stanza, type to props_type ]
| join type=outer attribute
    [| rest /servicesNS/-/-/admin/transforms-extract count=0 splunk_server=local
    | fields REGEX FORMAT disabled eai:acl.app title FIELDS
    | makemv delim="","" FIELDS
    | rename FIELDS to tf_fields, disabled to tf_disabled, REGEX to tf_regex, FORMAT to tf_format, title to attribute, eai:acl.app to tf_app]
| fillnull disabled tf_disabled
| table disabled app type attribute props_type props_stanza props_value props_sourcetype tf_disabled tf_format tf_fields tf_regex sharing perms.* location owner |  search (app=""*"" AND (sharing=""*"")) AND disabled=*  
| rename attribute TO ""Object Name""",sedi,2018-08-31,2018-08-31
Universal Forwarder Splunk Versions -,_internal,Returns the version of Splunk Universal Forwarders in an environment via _internal logs. ,"index=_internal sourcetype=splunkd group=tcpin_connections version=* os=* arch=* build=* hostname=* source=*metrics.log
| stats latest(version) as version,latest(arch) as arch,latest(os) as os,latest(build) as build by hostname
| join hostname [ | metadata type=hosts index=*
| eval last_seen_hours=(now()-lastTime)/60/60
| table host, last_seen_hours
| rex field=host ""(?<hostname>[^\.]+)"" | fields - host ]",jaracan,2018-09-12,2018-09-12
List Deployment Apps and the associated serverClass -,REST,"| rest /servicesNS/nobody/system/deployment/server/applications/ | search title =* | rename title as DeploymentApplication, serverclasses as serverClass | eval line=1 | accum line | fields line DeploymentApplication serverClass",,wrangler2x,2018-09-14,2018-09-16
Get Sourcetype and Index Info via TSTATS -,_internal,Use the following simple tstats query to return the latest time events came in for a given index as well as list all sourcetypes for each index: ,|tstats values(sourcetype) as Sourcetype latest(_time) as Time groupby index | convert ctime(Time),john117,2018-09-19,2018-09-18
List of all enabled correlation rules that generate a notable -,REST,,"| rest splunk_server=local count=0 /services/saved/searches | search action.notable=""1"" is_scheduled=""1"" disabled=""0""
    `comment(""PERFORM A REST COMMAND ON SAVED SEARCHES WHERE THE SEARCH GENERATES A NOTABLE, IS SCHEDULED AND IS NOT DISABLED"")`
| table title action.notable.param.security_domain description search cron_schedule actions action.email.to action.notable.param.severity alert.suppress.fields alert.suppress.period action.notable.param.next_steps action.notable.param.rule_description action.risk.param._risk_score
     `comment(""TABLE FIELDS”)`",Rbecwar,2018-11-03,2018-11-03
REST API response time -,_internal,This is a Splunk query to measure REST API response time from the various rest URI’s in Splunk. ,"index=_internal sourcetype=splunkd_access source=*splunkd_access.log | rex ""- - - (?P<Response_Time>.*)"" | rex ""\""(?<REST_uri>[^\""]+)"" | table _time, REST_uri, Response_Time",SplunkNinja,2018-11-14,2018-11-14
Show how much disk space is used by _internal -,_internal,The following Splunk query will return disk space used by the _internal index. ,index=_internal source=*license_usage.log type=Usage | eval gb=b/1024/1024/1024 | timechart span=1d sum(gb) as GB by host useother=false | untable _time host gb | top limit=1 host | join time [search index=_internal source=*license_usage.log type=Usage | eval gb=b/1024/1024/1024 | timechart span=1d sum(gb) as GB by sourcetype useother=false |untable _time sourcteype sum(GB)],ItsJohnLocke,2018-11-23,2018-11-23
Port usage for opsec sourcetype -,opsec,Stats count by port usage ,index=* sourcetype=opsec | stats count by s_port proto dest dest_svc action product,pradeep577,2018-11-24,2018-11-24
Index Modifications -,_internal,This Splunk query should show which users attempted to modify an index and if that action was successful: ,index=_audit user=* action=indexes_edit | stats count by index info user action,john117,2018-11-29,2018-11-29
Splunk Admin Account Activity - Account Modifications -,_internal,This Splunk query shows when the admin account performed Account Modification / Deletion / Creation actions: ,index=_audit user=admin action=edit_user operation=* | table _time user operation object*,john117,2018-11-30,2018-11-29
Splunk Admin Account Activity - Role Modifications -,_internal,This Splunk query shows when the admin account performed Create or Modify Roles actions: ,"index=""_audit"" action=edit_roles operation=* | table _time user operation object*",john117,2018-11-30,2018-11-29
List All Splunk Users & Associated Roles -,REST,The following Splunk query will show a table of all users and their roles: ,| rest /services/authentication/users | stats values(roles) as Roles by user,john117,2018-11-30,2018-11-29
Forwarder TCP Connections info -,_internal,This search should help identify which forwarders are connected and give you more information on the forwarders. ,"index=""_internal"" sourcetype=""splunkd"" source=""*metrics.lo*"" group=tcpin_connections component=Metrics | eval sourceHost=if(isnull(hostname), sourceHost,hostname)| eval connectionType=case(fwdType==""uf"",""universal forwarder"", fwdType==""lwf"", ""lightweight forwarder"",fwdType==""full"", ""heavy forwarder"", connectionType==""cooked"" or connectionType==""cookedSSL"",""Splunk forwarder"", connectionType==""raw"" or connectionType==""rawSSL"",""legacy forwarder"") | eval version=if(isnull(version),""pre 4.2"",version) | eval guid=if(isnull(guid),sourceHost,guid) | eval os=if(isnull(os),""n/a"",os)| eval arch=if(isnull(arch),""n/a"",arch)| fields connectionType sourceIp sourceHost splunk_server version os arch kb guid | eval lastReceived = case(kb>0, _time)| eval lastConnected=max(_time)| stats first(sourceIp) as sourceIp first(connectionType) as connectionType first(version) as version first(os) as os first(arch) as arch max(lastConnected) as lastConnected max(lastReceived) as lastReceived by sourceHost guid | addinfo | eval status=if(lastConnected<(info_max_time-900),""missing"",if(mystatus=""quiet"",""quiet"",""active"")) | fields sourceHost sourceIp version connectionType os arch lastConnected lastReceived status | rename sourceHost as Forwarder version as ""Splunk Version"" connectionType as ""Forwarder Type"" os as ""Platform"" status as ""Current Status"" lastConnected as ""Last Connected"" lastReceived as ""Last Data Received"" | fieldformat ""Last Connected""=strftime('Last Connected', ""%D %H:%M:%S %p"") | fieldformat ""Last Data Received""=strftime('Last Data Received', ""%D %H:%M:%S %p"") | sort Forwarder",thall,2018-12-01,2018-12-01
System Time Modifications in Windows -,WinEventLog:Security,The following queries will return modifications to time in a windows environment. It ignores system and service accounts. Windows 2008 and newer: ,"source=""WinEventLog:Security"" EventCode=4616 (NOT Account_Name=""*$"") (NOT Account_Name=""LOCAL SERVICE"")| eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"")| eval oldtime = strptime(replace(Previous_Time, ""\D"", """"), ""%Y%m%d%H%M%S%9N"") |  eval t=_time | rename t as ""eventtime"" |eval diff=round(((eventtime-oldtime)/60)/60,2) | where diff!=0| stats count by host, Account_Name, diff, Date | sort - Date| rename diff as ""Hours Between New Time and Actual Time"" |rename Account_Name as ""Source Account"" | rename host as ""Target Machine""|rename Date as ""Date and Time""| fields - count source=""WinEventLog:Security"" (EventCode=520) (NOT User=""LOCAL SERVICE"") ( NOT User=""SYSTEM"") | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"")| eval YourDate=Previous_Time | eval epoch1=strptime(YourDate,""%H:%M:%S %p %m/%d/%Y"") | convert timeformat=""%H:%M:%S %p %m/%d/%Y"" mktime(YourDate) as oldtime |  eval t=_time | rename t as ""eventtime""| eval diff=round(((eventtime-oldtime)/60)/60,2) | where diff!=0| stats count by host, User, diff, Date | sort - Date| rename diff as ""Hours Between New Time and Actual Time"" |rename Account_Name as ""Source Account"" | rename host as ""Target Machine""|rename Date as ""Date and Time""| fields - count| fields - count",SplunkNinja,2014-12-11,2018-12-04
Show Searches with Details (Who | When | What) -,_internal,The following Splunk search will show a list of searches ran on a splunk server with the following details: Who ran the search What sourcetype was used What index was used What the search string was When the search was last ran ,"index=_audit action=search sourcetype=audittrail search_id=* NOT (user=splunk-system-user) search!=""'typeahead*""
| rex ""search\=\'(search|\s+)\s(?P<search>[\n\S\s]+?(?=\'))""
| rex field=search ""sourcetype\s*=\s*\""*(?<SourcetypeUsed>[^\s\""]+)"" 
| rex field=search ""index\s*=\s*\""*(?<IndexUsed>[^\s\""]+)""
| stats latest(_time) as Latest by user search SourcetypeUsed IndexUsed
| convert ctime(Latest)",SplunkNinja,2018-12-05,2018-12-04
User Logon / Session Duration -,WinEventLog:Security,The following query will return the duration of user logon time between initial logon and logoff events. I have a duration filter set to greater than 5 seconds to weed out any scripts that may quickly log on and log off (change this as needed to fit your environment). Windows 2008 and newer: ,"source=WinEventLog:Security (EventCode=4624 OR EventCode=4634) (Logon_Type=2 OR Logon_Type=10) | eval Date=strftime(_time, ""%Y/%m/%d"")| eval LogonType=case(Logon_Type=""2"", ""Local Console Access"", Logon_Type=""10"", ""Remote Desktop via Terminal Services"")| transaction host user startswith=EventCode=4624 endswith=EventCode=4634 | where duration > 5 | eval duration = duration/60 | eval duration=round(duration,2)| table host, user, LogonType duration, Date | rename duration as ""Session Duration in Minutes"" | sort - date source=WinEventLog:Security (EventCode=528 OR EventCode=538) (Logon_Type=2 OR Logon_Type=10) | eval Date=strftime(_time, ""%Y/%m/%d"") | eval LogonType=case(Logon_Type=""2"", ""Local Console Access"", Logon_Type=""10"", ""Remote Desktop via Terminal Services"")| transaction host User startswith=EventCode=528 endswith=EventCode=538 | where duration > 5 | eval duration = duration/60 | eval duration=round(duration,2)| table host, User, LogonType, duration, Date | rename duration as ""Session Duration in Minutes"" | sort - date",SplunkNinja,2014-11-07,2018-12-17
"User Logon, Logoff, and Duration -",WinEventLog:Security,Tweaked wenthold response to include more EventCodes. Also depending on the environment EventCode 4800|4801|4802 which is screen lock may be the closest thing to getting a log off time. > original post on splunk answers: https://answers.splunk.com/answers/597752/report-for-showing-users-logon-logoff-and-the-dura.html ,"source=""wineventlog:security"" action=success Logon_Type=2 (EventCode=4624 OR EventCode=4634 OR EventCode=4779 OR EventCode=4800 OR EventCode=4801 OR EventCode=4802 OR EventCode=4803 OR EventCode=4804 ) user!=""anonymous logon"" user!=""DWM-*"" user!=""UMFD-*"" user!=SYSTEM user!=*$ (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10)
| convert timeformat=""%a %B %d %Y"" ctime(_time) AS Date 
| streamstats earliest(_time) AS login, latest(_time) AS logout by Date, host
| eval session_duration=logout-login 
| eval h=floor(session_duration/3600) 
| eval m=floor((session_duration-(h*3600))/60) 
| eval SessionDuration=h.""h "".m.""m "" 
| convert timeformat="" %m/%d/%y - %I:%M %P"" ctime(login) AS login 
| convert timeformat="" %m/%d/%y - %I:%M %P"" ctime(logout) AS logout 
| stats count AS auth_event_count, earliest(login) as login, max(SessionDuration) AS sesion_duration, latest(logout) as logout, values(Logon_Type) AS logon_types by Date, host, user",kme723,2018-10-26,2018-12-17
Failed Logon Attempts - Windows -,WinEventLog:Security,The following Splunk query will show a timechart of failed logon attempts per host: ,"source=""WinEventLog:security"" EventCode=4625 
| timechart span=1h count by host source=""WinEventLog:security"" EventCode=4625
| eval Workstation_Name=lower(Workstation_Name)
| eval host=lower(host) 
| eval hammer=_time 
| bucket span=5m hammer 
| stats count sparkline by user host, hammer, Workstation_Name
| rename hammer as ""5 minute blocks"" host as ""Target Host"" Workstation_Name as ""Source Host""
| convert ctime(""5 minute blocks"")",SplunkNinja,2018-12-17,2018-12-17
Search Common EventCodes (EventID's) for Suspicious Behavior -,WinEventLog:Security,This query searches many common EventCodes (EventID’s) within a Windows environment for suspicious behavior. The query can take some time to run due to it’s length. Excellent for high-level security insight. ,"source=""wineventlog:security"" user!=""DWM-*"" user!=""UMFD-*"" user!=SYSTEM user!=""LOCAL SERVICE"" user!=""NETWORK SERVICE"" user!=""*$"" user!=""ANONYMOUS LOGON"" user!=""IUSR""
| eval Trigger=case(EventCode=516, ""Audit Logs Modified"",EventCode=517, ""Audit Logs Modified"",EventCode=612, ""Audit Logs Modified"",EventCode=623, ""Audit Logs Modified"",EventCode=806, ""Audit Logs Modified"",EventCode=807, ""Audit Logs Modified"",EventCode=1101, ""Audit Logs Modified"",EventCode=1102, ""Audit Logs Modified"",EventCode=4612, ""Audit Logs Modified"",EventCode=4621, ""Audit Logs Modified"",EventCode=4694, ""Audit Logs Modified"",EventCode=4695, ""Audit Logs Modified"",EventCode=4715, ""Audit Logs Modified"",EventCode=4719, ""Audit Logs Modified"",EventCode=4817, ""Audit Logs Modified"",EventCode=4885, ""Audit Logs Modified"",EventCode=4902, ""Audit Logs Modified"",EventCode=4906, ""Audit Logs Modified"",EventCode=4907, ""Audit Logs Modified"",EventCode=4912, ""Audit Logs Modified"", EventCode=642, ""Account Modification"",EventCode=646, ""Account Modification"",EventCode=685, ""Account Modification"",EventCode=4738, ""Account Modification"",EventCode=4742, ""Account Modification"",EventCode=4781, ""Account Modification"", EventCode=1102, ""Audit Logs Cleared/Deleted"",EventCode=517, ""Audit Logs Cleared/Deleted"", EventCode=628, ""Passwords Changed"",EventCode=627, ""Passwords Changed"",EventCode=4723, ""Passwords Changed"",EventCode=4724, ""Passwords Changed"", EventCode=528, ""Successful Logons"",EventCode=540, ""Successful Logons"",EventCode=4624, ""Successful Logons"", EventCode=4625, ""Failed Logons"",EventCode=529, ""Failed Logons"",EventCode=530, ""Failed Logons"",EventCode=531, ""Failed Logons"",EventCode=532, ""Failed Logons"",EventCode=533, ""Failed Logons"",EventCode=534, ""Failed Logons"",EventCode=535, ""Failed Logons"",EventCode=536, ""Failed Logons"",EventCode=537, ""Failed Logons"",EventCode=539, ""Failed Logons"", EventCode=576, ""Escalation of Privileges"",EventCode=4672, ""Escalation of Privileges"",EventCode=577, ""Escalation of Privileges"",EventCode=4673, ""Escalation of Privileges"",EventCode=578, ""Escalation of Privileges"",EventCode=4674, ""Escalation of Privileges"") 
| stats earliest(_time) as Initial_Occurrence latest(_time) as Latest_Occurrence values(user) as Users values(host) as Hosts count sparkline by Trigger
| sort - count
| convert ctime(Initial_Occurrence) ctime(Latest_Occurrence)",Go Splunk,2014-10-07,2018-12-17
Successful Logons - Windows -,WinEventLog:Security,The following is a Splunk query that will display a timechart for all successful logons to windows: ,"source=""WinEventLog:security"" EventCode=4624 Logon_Type IN (2,7,10,11) NOT user IN (""DWM-*"", ""UMFD-*"")
| timechart span=1h count by host source=""WinEventLog:security"" EventCode=4624 Logon_Type IN (2,7,10,11) NOT user IN (""DWM-*"", ""UMFD-*"")
| eval Workstation_Name=lower(Workstation_Name)
| eval host=lower(host)
| eval hammer=_time 
| bucket span=12h hammer 
| stats values(Logon_Type) as ""Logon Type"" count sparkline by user host, hammer, Workstation_Name
| rename hammer as ""12 hour blocks"" host as ""Target Host"" Workstation_Name as ""Source Host""
| convert ctime(""12 hour blocks"")
| sort - ""12 hour blocks""",SplunkNinja,2018-12-17,2018-12-17
Number of Hosts Associated with a Serverclass -,REST,The following query will list the number of hosts associated with all serverclasses on your Splunk Deployment server. This query should be run on your Deployment Server. ,"| rest /services/deployment/server/clients splunk_server=local | table hostname applications.*.serverclasses | untable hostname applications | rex field=applications ""applications\.(?<apps>.+)\.serverclasses"" | stats dc(hostname) as hostname by apps",SplunkNinja,2018-12-22,2018-12-21
Use TSTATS to find hosts no longer sending data -,_internal,"This is a simple tstats query shows all hosts and sourcetypes that have reported data, and shows the time in seconds since anything was sent. Be sure to run the query over a lengthy period of time in order to include machines that haven’t sent data for sometime. Don’t worry about the search-time so much, …","|tstats latest(_time) as lt by index, sourcetype, host | eval NOW=now() | eval difftime=NOW-lt |tstats latest(_time) as lt by index, sourcetype, host | eval NOW=now() | eval difftime=NOW-lt | rangemap field=difftime ""0 - 60 Min""=0-3600 ""1 - 24 Hours""=3601-86400 ""1-7 Days""=86401-604800 default=""Greater than 1 Week"" |tstats latest(_time) as lt by index, sourcetype, host | eval NOW=now() | eval difftime=NOW-lt | where difftime>=3600",SplunkNinja,2019-01-04,2019-01-03
High Level Windows Dashboard -,Dashboards,"Part 1 – User Logon Activity The following Splunk Dashboard provides a high level view of windows user logon activity. It should be emphasized that the focus of this dashboard is fairly high level, has a time picker (defaulting to 7 days) and shows both successful and failed user logons (table and timechart) as well …","<form>
  <label>Windows Security Dashboard</label>
  <fieldset submitButton=""false"">
    <input type=""time"" token=""timepicker"">
      <label></label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Failed Logon Attempts</title>
      <table>
        <search>
          <query>index=windows_events source=""WinEventLog:security"" EventCode=4625 
| eval hammer=_time
| eval Workstation_Name=lower(Workstation_Name)
| eval host=lower(host)
| bucket span=5m hammer 
| stats count sparkline by user host, hammer, Workstation_Name
| rename hammer as ""5 minute blocks"" host as ""Target Host"" Workstation_Name as ""Source Host""
| convert ctime(""5 minute blocks"")</query>
          <earliest>$timepicker.earliest$</earliest>
          <latest>$timepicker.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">20</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
        <format type=""color"" field=""user"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""Target Host"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""Source Host"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
      </table>
    </panel>
    <panel>
      <title>Timechart of Failed Attempts to Logon</title>
      <chart>
        <search>
          <query>index=windows_events source=""WinEventLog:security"" EventCode=4625 
| timechart span=1h count by host</query>
          <earliest>$timepicker.earliest$</earliest>
          <latest>$timepicker.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">line</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Successful Logons</title>
      <table>
        <search>
          <query>index=windows_events source=""WinEventLog:security"" EventCode=4624 (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10 OR Logon_Type=11) user!=""DWM-*"" user!=""UMFD-*""
| eval Workstation_Name=lower(Workstation_Name)
| eval host=lower(host)
| eval hammer=_time 
| bucket span=1d@d hammer 
| stats values(Logon_Type) as ""Logon Type"" count sparkline by user host, hammer, Workstation_Name
| rename hammer as ""Start of Day"" host as ""Target Host"" Workstation_Name as ""Source Host""
| convert ctime(""Start of Day"")
| sort - ""Start of Day""</query>
          <earliest>$timepicker.earliest$</earliest>
          <latest>$timepicker.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">none</option>
        <option name=""refresh.display"">progressbar</option>
        <format type=""color"" field=""Target Host"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""Source Host"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""user"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
      </table>
    </panel>
    <panel>
      <title>Timechart of Successful Logons</title>
      <chart>
        <search>
          <query>index=windows_events source=""WinEventLog:security"" EventCode=4624 (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10 OR Logon_Type=11) user!=""DWM-*"" user!=""UMFD-*""
| timechart span=1h count by host</query>
          <earliest>$timepicker.earliest$</earliest>
          <latest>$timepicker.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">line</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Windows Authentication events</title>
      <table>
        <search>
          <query>index=windows_events source=""wineventlog:security"" action=success (EventCode=4624 OR EventCode=4634 ) user!=""anonymous logon"" user!=""DWM-*"" user!=""UMFD-*"" user!=SYSTEM user!=*$ (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10)
| convert timeformat=""%a %B %d %Y"" ctime(_time) AS Date 
| streamstats earliest(_time) AS login, latest(_time) AS logout by Date, host, user
| eval session_duration=logout-login
| where session_duration &gt; 5
| eval h=floor(session_duration/3600) 
| eval m=floor((session_duration-(h*3600))/60) 
| eval SessionDuration=h.""h "".m.""m "" 
| convert timeformat="" %m/%d/%y - %I:%M %P"" ctime(login) AS login 
| convert timeformat="" %m/%d/%y - %I:%M %P"" ctime(logout) AS logout 
| stats count AS auth_event_count, earliest(login) as login, max(SessionDuration) AS sesion_duration, latest(logout) as logout, values(Logon_Type) AS logon_types by Date, host, user
| sort + login</query>
          <earliest>$timepicker.earliest$</earliest>
          <latest>$timepicker.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">20</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
        <format type=""color"" field=""host"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""user"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Common Event Codes - 10,000 foot view</title>
      <table>
        <search>
          <query>index=""windows_events"" source=""wineventlog:security"" user!=""DWM-*"" user!=""UMFD-*"" user!=SYSTEM user!=""LOCAL SERVICE"" user!=""NETWORK SERVICE"" user!=""*$$"" user!=""ANONYMOUS LOGON"" user!=""IUSR""
| eval Trigger=case(EventCode=516, ""Audit Logs Modified"",EventCode=517, ""Audit Logs Modified"",EventCode=612, ""Audit Logs Modified"",EventCode=623, ""Audit Logs Modified"",EventCode=806, ""Audit Logs Modified"",EventCode=807, ""Audit Logs Modified"",EventCode=1101, ""Audit Logs Modified"",EventCode=1102, ""Audit Logs Modified"",EventCode=4612, ""Audit Logs Modified"",EventCode=4621, ""Audit Logs Modified"",EventCode=4694, ""Audit Logs Modified"",EventCode=4695, ""Audit Logs Modified"",EventCode=4715, ""Audit Logs Modified"",EventCode=4719, ""Audit Logs Modified"",EventCode=4817, ""Audit Logs Modified"",EventCode=4885, ""Audit Logs Modified"",EventCode=4902, ""Audit Logs Modified"",EventCode=4906, ""Audit Logs Modified"",EventCode=4907, ""Audit Logs Modified"",EventCode=4912, ""Audit Logs Modified"", EventCode=642, ""Account Modification"",EventCode=646, ""Account Modification"",EventCode=685, ""Account Modification"",EventCode=4738, ""Account Modification"",EventCode=4742, ""Account Modification"",EventCode=4781, ""Account Modification"", EventCode=1102, ""Audit Logs Cleared/Deleted"",EventCode=517, ""Audit Logs Cleared/Deleted"", EventCode=628, ""Passwords Changed"",EventCode=627, ""Passwords Changed"",EventCode=4723, ""Passwords Changed"",EventCode=4724, ""Passwords Changed"", EventCode=528, ""Successful Logons"",EventCode=540, ""Successful Logons"",EventCode=4624, ""Successful Logons"", EventCode=4625, ""Failed Logons"",EventCode=529, ""Failed Logons"",EventCode=530, ""Failed Logons"",EventCode=531, ""Failed Logons"",EventCode=532, ""Failed Logons"",EventCode=533, ""Failed Logons"",EventCode=534, ""Failed Logons"",EventCode=535, ""Failed Logons"",EventCode=536, ""Failed Logons"",EventCode=537, ""Failed Logons"",EventCode=539, ""Failed Logons"", EventCode=576, ""Escalation of Privileges"",EventCode=4672, ""Escalation of Privileges"",EventCode=577, ""Escalation of Privileges"",EventCode=4673, ""Escalation of Privileges"",EventCode=578, ""Escalation of Privileges"",EventCode=4674, ""Escalation of Privileges"") 
| stats earliest(_time) as Initial_Occurrence latest(_time) as Latest_Occurrence values(user) as Users values(host) as Hosts count sparkline by Trigger
| sort - count
| convert ctime(Initial_Occurrence) ctime(Latest_Occurrence)</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">20</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
        <format type=""color"" field=""Trigger"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
      </table>
    </panel>
  </row>
</form>",SplunkNinja,2019-01-17,2019-01-18
List All Hosts Associated with All Indexes -,_internal,Using the Splunk Tstats command you can quickly list all hosts associated with all indexes: ,|tstats values(host) where index=* by index,SplunkNinja,2016-12-22,2019-01-24
Failed Attempt to Login to a Disabled Account -,WinEventLog:Security,This Splunk Search Query will indicate any user who attempted to login to a disabled account. (Tested only on Windows 7 / Server 2008 and newer Windows logs). ,"source=""WinEventLog:security"" EventCode=4625 (Sub_Status=""0xc0000072"" OR Sub_Status=""0xC0000072"") Security_ID!=""NULL SID"" Account_Name!=""*$"" | eval Date=strftime(_time, ""%Y/%m/%d"")| rex ""Which\sLogon\sFailed:\s+\S+\s\S+\s+\S+\s+Account\sName:\s+(?<facct>\S+)"" | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, facct, host, Keywords | rename facct as ""Target Account"" host as ""Host"" Keywords as ""Status"" count as ""Count""",SplunkNinja,2016-02-04,2019-01-24
Searching Your Searches -,Dashboards,"Below is the raw XML of a dashboard we wrote about on our blog a couple of months ago. Click here to read that blog, or copy/paste this XML in your Splunk instance! ","<form theme=""dark"">
  <label>Searching for Searches</label>
  <fieldset submitButton=""true"">
    <input type=""text"" token=""search_input"">
      <label>Search for field here:</label>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Dashboards</title>
      <single>
        <search>
          <query>| rest splunk_server=local /servicesNS/-/-/data/ui/views | search eai:data=""*$search_input$*"" | stats count</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
        </search>
        <option name=""colorMode"">block</option>
        <option name=""drilldown"">all</option>
        <option name=""height"">285</option>
        <option name=""rangeColors"">[""0xdc4e41"",""0x53a051""]</option>
        <option name=""rangeValues"">[0]</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""useColors"">1</option>
        <!--Setting the token for the hidden panel-->
        <drilldown>
          <set token=""peekaboo"">| rest splunk_server=local /servicesNS/-/-/data/ui/views | search eai:data=""*$search_input$*"" | rename author AS Author eai:acl.sharing AS Permissions eai:appName AS App eai:data AS ""Dashboard XML"" | fields Author Permissions App ""Dashboard XML""</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Saved Searches</title>
      <single>
        <search>
          <query>| rest splunk_server=local /services/saved/searches | search search=""*$search_input$*"" | stats count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name=""colorMode"">block</option>
        <option name=""drilldown"">all</option>
        <option name=""height"">285</option>
        <option name=""rangeColors"">[""0xdc4e41"",""0x53a051""]</option>
        <option name=""rangeValues"">[0]</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""useColors"">1</option>
        <!--Setting the token for the hidden panel-->
        <drilldown>
          <set token=""peekaboo"">| rest splunk_server=local /services/saved/searches | search search=""*$search_input$*"" | rename eai:acl.owner AS Author eai:acl.sharing AS Permissions eai:acl.app AS App search AS ""Saved Search"" | fields Author Permissions App ""Saved Search""</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Event Types</title>
      <single>
        <search>
          <query>| rest splunk_server=local /servicesNS/-/-/saved/eventtypes | search search=""*$search_input$*"" | stats count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name=""colorMode"">block</option>
        <option name=""drilldown"">all</option>
        <option name=""height"">285</option>
        <option name=""rangeColors"">[""0xdc4e41"",""0x53a051""]</option>
        <option name=""rangeValues"">[0]</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""useColors"">1</option>
        <!--Setting the token for the hidden panel-->
        <drilldown>
          <set token=""peekaboo"">| rest splunk_server=local /servicesNS/-/-/saved/eventtypes | search search=""*$search_input$*"" | rename eai:acl.owner AS Author eai:acl.sharing AS Permissions eai:acl.app AS App search AS ""Event Type"" | fields Author Permissions App ""Event Type""</set>
        </drilldown>
      </single>
    </panel>
  </row>
  <row>
    <!--Here is said hidden panel-->
    <panel depends=""$peekaboo$"">
      <table>
        <search>
          <query>$peekaboo$</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <option name=""drilldown"">cell</option>
        <drilldown>
          <unset token=""peekaboo""></unset>
        </drilldown>
      </table>
    </panel>
  </row>
</form>",kdor,2019-01-29,2019-01-29
Auditd hosts in all environments -,Dashboards,"Shows the login activity to our linux environments, sudo commands per host and users. Admin Notes: index=main was changed to index=* due to not everyone using the same index. This dashboard has been tested for code errors, but not for search errors. Please comment if you have any issues!   ","<form>
  <label>Audit All Hosts</label>
  <fieldset submitButton=""false"">
    <input type=""time"" token=""field1"">
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type=""dropdown"" token=""field2"" searchWhenChanged=""true"">
      <label>Environment</label>
      <choice value=""*"">All</choice>
      <choice value=""*dev*"">DEV</choice>
      <choice value=""*prd*"">PROD</choice>
      <choice value=""*int*"">INTG</choice>
      <choice value=""*tst*"">TEST</choice>
      <choice value=""*inf*"">INF</choice>
      <choice value=""*qa*"">QA</choice>
      <fieldForLabel>env</fieldForLabel>
      <fieldForValue>env</fieldForValue>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Audit Auth Logs By GeoIp</title>
      <map>
        <title>(ssh originating locations, not updated with Environment dropdown)</title>
        <search>
          <query>index=* ""ssh"" ""audit.res""=success type=USER_LOGIN hostname=*| iplocation addr | geostats latfield=lat longfield=lon count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""drilldown"">none</option>
        <option name=""mapping.choroplethLayer.colorBins"">5</option>
        <option name=""mapping.choroplethLayer.colorMode"">auto</option>
        <option name=""mapping.choroplethLayer.maximumColor"">0xaf575a</option>
        <option name=""mapping.choroplethLayer.minimumColor"">0x62b3b2</option>
        <option name=""mapping.choroplethLayer.neutralPoint"">0</option>
        <option name=""mapping.choroplethLayer.shapeOpacity"">0.75</option>
        <option name=""mapping.choroplethLayer.showBorder"">1</option>
        <option name=""mapping.data.maxClusters"">100</option>
        <option name=""mapping.legend.placement"">bottomright</option>
        <option name=""mapping.map.center"">(38.41,-108.41)</option>
        <option name=""mapping.map.panning"">1</option>
        <option name=""mapping.map.scrollZoom"">0</option>
        <option name=""mapping.map.zoom"">4</option>
        <option name=""mapping.markerLayer.markerMaxSize"">50</option>
        <option name=""mapping.markerLayer.markerMinSize"">10</option>
        <option name=""mapping.markerLayer.markerOpacity"">0.8</option>
        <option name=""mapping.showTiles"">1</option>
        <option name=""mapping.tileLayer.maxZoom"">7</option>
        <option name=""mapping.tileLayer.minZoom"">0</option>
        <option name=""mapping.tileLayer.tileOpacity"">1</option>
        <option name=""mapping.type"">marker</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </map>
    </panel>
    <panel>
      <title>Failed Auth by Host</title>
      <chart>
        <search>
          <query>index=* ""failed"" extracted_source=""/var/log/audit/audit.log"" ""audit.type""=USER_LOGIN hostname=$field2$ | bin size bins=30 |timechart count by hostname</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">line</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">minmax</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisEnd</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">bottom</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top Sudoers</title>
      <table>
        <search>
          <query>index=* extracted_source=""/var/log/secure"" sudoer!=nrpe hostname=$field2$| stats count by sudoer command | sort - count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">10</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
      </table>
    </panel>
    <panel>
      <title>Sudoers</title>
      <viz type=""simple_xml_examples.tagcloud"">
        <search>
          <query>index=* ""su"" extracted_source=""/var/log/secure"" hostname=$field2$ | stats count by sudoer</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""drilldown"">none</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""simple_xml_examples.tagcloud.labelField"">sudoer</option>
        <option name=""simple_xml_examples.tagcloud.maxFontSize"">36</option>
        <option name=""simple_xml_examples.tagcloud.minFontSize"">8</option>
        <option name=""simple_xml_examples.tagcloud.valueField"">count</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </viz>
    </panel>
    <panel>
      <title>Auditd Top Accounts</title>
      <viz type=""simple_xml_examples.tagcloud"">
        <search>
          <query>index=* ""su"" audit.log.acct=* extracted_source=""/var/log/audit/audit.log"" hostname=$field2$ | top audit.log.acct</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name=""drilldown"">none</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""simple_xml_examples.tagcloud.labelField"">audit.log.acct</option>
        <option name=""simple_xml_examples.tagcloud.maxFontSize"">48</option>
        <option name=""simple_xml_examples.tagcloud.minFontSize"">12</option>
        <option name=""simple_xml_examples.tagcloud.valueField"">count</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <title>Sudo count by User By Command By Host</title>
      <table>
        <search>
          <query>index=* ""su"" extracted_source=""/var/log/secure"" hostname=$field2$| stats count by sudoer command hostname</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">10</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
      </table>
    </panel>
  </row>
</form>",manderso,2019-01-29,2019-01-29
Simple File Integrity Monitoring Management Dashboard -,Dashboards,"This is the code for my original reddit post at https://www.reddit.com/r/Splunk/comments/am3tgr/simple_file_integrity_monitoring/ This dashboard allows users to manage simple File Integrity Monitoring (FIM) within Splunk. Please note that this isn’t a full FIM suite as it only validates if a checksum has been changed on a file, but I have included a simple TA for Linux. However, if you …","[script://.bin/fim-nix.sh]
disabled = 0
index = <index_name>
sourcetype = fim
source = fim
interval = 900 WATCHLIST=""../default/watchlist.conf""

while read line; do
   echo -n ""checksum"" && shasum $line
done < $WATCHLIST <form script=""fim_decorations.js, fim_interface.js, fim_modal.js"" stylesheet=""fim_decorations.css"">
  <label>File Integrity Monitoring Interface</label>
   <search id=""actionSearch"" depends=""$perform_action$"">
     <query>
       | outputlookup fim_hashtable
| append
    [ search index=logs-* sourcetype=fim checksum!=""checksum""
    | rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)""
    | search host IN ( ""*"" ) filename IN ( ""*"" )
    | stats latest(checksum) as expected by filename host ]
| outputlookup fim_hashtable
     </query>
    </search>
      <search id=""auditSearch"" depends=""$perform_action$"">
    <query>| inputlookup fim_auditlog
| append
    [ stats count
    | eval host=""N/A""
    | eval filename=""N/A""
    | eval expected=""Performed bulk modification to hashtable""
    | eval username=""$env:user_realname$""
    | eval created=now()
    | convert ctime(created) ]
| table host, filename, expected, username, created
| outputlookup fim_auditlog</query>
  </search>
  <search id=""updateExpectedHashSearch"" depends=""$update_key_tok$, $update_host_tok$, $update_filename_tok$, $update_expected_tok$"">
    <query>
            | inputlookup fim_hashtable | eval key=_key | WHERE key=""$update_key_tok$""
            | eval host=""$update_host_tok$""
            | eval filename=""$update_filename_tok$""
            | eval expected=""$update_expected_tok$""
            | outputlookup fim_hashtable append=t
        </query>
  </search>
  <search id=""createAuditEntrySearch"" depends=""$create_host_tok$, $create_filename_tok$, $create_expected_tok$"">
    <query>
            | inputlookup fim_auditlog | append [stats count | eval host=""$create_host_tok$""
            | eval filename=""$create_filename_tok$"" | eval expected=""$create_expected_tok$"" | eval expected=""Modified checksum to "" + expected | eval username=""$env:user_realname$"" | eval created=now() | convert ctime(created) ]
            | table host, filename, expected, username, created
            | outputlookup fim_auditlog
        </query>
  </search>
  <fieldset submitButton=""true"" autoRun=""true"">
    <input type=""time"" token=""timeselect"" searchWhenChanged=""true"">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type=""multiselect"" token=""host"" searchWhenChanged=""true"">
      <label>Hostname</label>
      <choice value=""*"">ALL</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>host</fieldForLabel>
      <fieldForValue>host</fieldForValue>
      <search>
        <query>index=logs-* sourcetype=fim | stats dc by host</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <valuePrefix>""</valuePrefix>
      <valueSuffix>""</valueSuffix>
      <delimiter>,</delimiter>
    </input>
    <input type=""multiselect"" token=""filename"" searchWhenChanged=""true"">
      <label>Filename</label>
      <choice value=""*"">ALL</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <valuePrefix>""</valuePrefix>
      <valueSuffix>""</valueSuffix>
      <delimiter>,</delimiter>
      <fieldForLabel>filename</fieldForLabel>
      <fieldForValue>filename</fieldForValue>
      <search>
        <query>index=logs-* sourcetype=fim host IN ( $host$) checksum!=""checksum""
| rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)"" | stats dc by filename</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
  </fieldset>
  <row>
    <panel id=""bulk_actions"">
      <html>
            <button class=""btn btn-primary actionBtn"" style=""float:right;"">Perform Bulk Rebase of Hashtable</button>
        </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Organizational Statistics</title>
      <single>
        <search>
          <query>index=logs-* sourcetype=fim checksum!=""checksum""
| rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)""
| stats latest(checksum) as current by filename host
| lookup
    fim_hashtable host filename output expected
| eval acknowledged=if(current!=expected,0,1)
| where acknowledged=0
| stats count
                    </query>
          <earliest>$timeselect.earliest$</earliest>
          <latest>$timeselect.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""colorBy"">value</option>
        <option name=""colorMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""numberPrecision"">0</option>
        <option name=""rangeColors"">[""0x65a637"",""0xd93f3c""]</option>
        <option name=""rangeValues"">[0]</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""showSparkline"">1</option>
        <option name=""showTrendIndicator"">1</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
        <option name=""trendColorInterpretation"">standard</option>
        <option name=""trendDisplayMode"">absolute</option>
        <option name=""underLabel"">MISMATCHED CHECKSUMS</option>
        <option name=""unitPosition"">after</option>
        <option name=""useColors"">1</option>
        <option name=""useThousandSeparators"">1</option>
      </single>
      <single>
        <search>
          <query>index=logs-* sourcetype=fim checksum!=""checksum""
| rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)""
                        | stats latest(checksum) as current by filename host
                        | lookup fim_hashtable host filename output expected
                        | eval acknowledged=if(current!=expected,0,1)
                        | where acknowledged=0
                        | stats count as mismatches
                        | eval compliant=if(mismatches>0,""Non-Compliant"",""Compliant"")
                        | fields compliant
                    </query>
          <earliest>$timeselect.earliest$</earliest>
          <latest>$timeselect.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""colorBy"">value</option>
        <option name=""colorMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""numberPrecision"">0</option>
        <option name=""rangeColors"">[""0x65a637"",""0x6db7c6""]</option>
        <option name=""rangeValues"">[0]</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""showSparkline"">1</option>
        <option name=""showTrendIndicator"">1</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
        <option name=""trendColorInterpretation"">standard</option>
        <option name=""trendDisplayMode"">absolute</option>
        <option name=""unitPosition"">after</option>
        <option name=""useColors"">0</option>
        <option name=""useThousandSeparators"">1</option>
        <option name=""underLabel"">CURRENT STATUS</option>
      </single>
      <single>
        <search>
          <query>index=logs-* sourcetype=fim checksum!=""checksum""
| rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)"" | stats dc(filename)</query>
          <earliest>$timeselect.earliest$</earliest>
          <latest>$timeselect.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""colorBy"">value</option>
        <option name=""colorMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""numberPrecision"">0</option>
        <option name=""rangeColors"">[""0x65a637"",""0x6db7c6""]</option>
        <option name=""rangeValues"">[0]</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""showSparkline"">1</option>
        <option name=""showTrendIndicator"">1</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
        <option name=""trendColorInterpretation"">standard</option>
        <option name=""trendDisplayMode"">absolute</option>
        <option name=""underLabel"">FILES MONITORED</option>
        <option name=""unitPosition"">after</option>
        <option name=""useColors"">1</option>
        <option name=""useThousandSeparators"">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>File Checksum Status</title>
      <input type=""dropdown"" token=""bool_status"" searchWhenChanged=""true"">
       <label>Status Filter:</label>
        <choice value="""">Show All</choice>
        <choice value=""| where status=0"">Only Mismatches</choice>
        <default></default>
      </input>
      <table id=""fim_status"">
        <search id=""fimStatusSearch"">
          <query>index=logs-* sourcetype=fim checksum!=""checksum""
| rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)"" | search host IN ( $host$ ) filename IN ( $filename$ )
                        | stats latest(checksum) as current by filename host
                        | join host filename
                        [| inputlookup fim_hashtable | eval key=_key ]
                        | eval status=if(current!=expected,0,1) $bool_status$
                        | eval action=if(status=1,"" "",""Update"")
                        | table status, action, key, host, filename, expected, current | sort + status</query>
          <earliest>$timeselect.earliest$</earliest>
          <latest>$timeselect.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">20</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">cell</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Compliancy Over Time</title>
      <chart>
        <search>
          <query>index=logs-* sourcetype=fim checksum!=""checksum""
| rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)"" | search host IN ( $host$ ) filename IN ( $filename$ )
                        | stats values(checksum) as current by filename host _time
                        | join host filename
                        [| inputlookup fim_hashtable ]
                        | eval status=if(current!=expected,""Non-Compliant"",""Compliant"")
                        | timechart count by status
                    </query>
          <earliest>$timeselect.earliest$</earliest>
          <latest>$timeselect.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">line</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>FIM Modification Audit Log</title>
      <input type=""multiselect"" token=""hostAudit"" searchWhenChanged=""true"">
        <label>Hostname</label>
        <choice value=""*"">ALL</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>host</fieldForLabel>
        <fieldForValue>host</fieldForValue>
        <search>
          <query>index=logs-* sourcetype=fim | stats dc by host</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <valuePrefix>""</valuePrefix>
        <valueSuffix>""</valueSuffix>
        <delimiter>,</delimiter>
      </input>
      <input type=""multiselect"" token=""filenameAudit"" searchWhenChanged=""true"">
        <label>Filename</label>
        <choice value=""*"">ALL</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <valuePrefix>""</valuePrefix>
        <valueSuffix>""</valueSuffix>
        <delimiter>,</delimiter>
        <fieldForLabel>filename</fieldForLabel>
        <fieldForValue>filename</fieldForValue>
        <search>
          <query>index=logs-* sourcetype=fim host IN ( $host$) checksum!=""checksum""
| rex field=_raw ""^(?P&lt;type&gt;\w+)\s+(?P&lt;checksum&gt;[^ ]+)\s+(?P&lt;filename&gt;.+)"" | stats dc by filename</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
      </input>
      <input type=""multiselect"" token=""userAudit"" searchWhenChanged=""true"">
        <label>Username</label>
        <choice value=""*"">ALL</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <valuePrefix>""</valuePrefix>
        <valueSuffix>""</valueSuffix>
        <delimiter>,</delimiter>
        <fieldForLabel>username</fieldForLabel>
        <fieldForValue>username</fieldForValue>
        <search>
          <query>| inputlookup fim_auditlog | search host IN ( $host$ ) | stats count by username</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
      </input>
      <table id=""fim_audit_log"">
        <search id=""fimAuditSearch"">
          <query>| inputlookup fim_auditlog
| fields created username host filename expected
| rename expected as ""action performed"" created as performed
| sort - performed</query>
          <earliest>$timeselect.earliest$</earliest>
          <latest>$timeselect.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">20</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
      </table>
    </panel>
  </row>
</form> [fim_hashtable]
enforceTypes = true
field.expected = string
field.host = string
field.filename = string
replicate = true

[fim_auditlog]
enforceTypes = true
field.expected = string
field.host = string
field.filename = string
field.created = string
field.username = string
replicate = true [fim_hashtable]
external_type = kvstore
default_match = unknown
collection = fim_hashtable
max_matches = 1
min_matches = 1
fields_list = _key,expected,host,filename

[fim_auditlog]
external_type = kvstore
default_match = unknown
collection = fim_auditlog
max_matches = 1
min_matches = 1
fields_list = _key,expected,host,filename,created,username require([
    'underscore',
    'jquery',
    'splunkjs/mvc',
    'splunkjs/mvc/simplexml/ready!'
], <b>function </b>(_, $, mvc) {

    <b>var </b>tokens = mvc.Components.get('submitted');

    /* --- Search Reference --- */
    <b>var </b>updateSearch = mvc.Components.get('updateExpectedHashSearch');
    <b>var </b>createSearch = mvc.Components.get('createAuditEntrySearch');
    <b>var </b>fimStatusSearch = mvc.Components.get('fimStatusSearch');
    <b>var </b>fimAuditSearch = mvc.Components.get('fimAuditSearch');

    <b>var </b>fimStatusTable = mvc.Components.get('fim_status');

    /* --- Reference to the input values --- */
    <b>var </b>host_Val, filename_Val, expected_Val, key_Val;

    fimStatusTable.on('click', <b>function </b>(e) {

        e.preventDefault();
        <b>if </b>(e['field'] === 'action') {
            /* --- Pull values from the current table row --- */
            host_Val = e.data['row.host'];
            filename_Val = e.data['row.filename'];
            expected_Val = e.data['row.current'];
            key_Val = e.data['row.key'];

            /* --- this is an update --- */
            e.preventDefault();
            tokens.set('update_key_tok', key_Val);
            tokens.set('update_host_tok', host_Val);
            tokens.set('update_filename_tok', filename_Val);
            tokens.set('update_expected_tok', expected_Val);

            console.log(""Updating Hashtable..."");
            console.log(""Key:"" + key_Val);
            console.log(""Host:"" + host_Val);
            console.log(""Filename:"" + filename_Val);
            console.log(""Expected:"" + expected_Val);

            /* --- this is a new create --- */
            tokens.set('create_tok', 'true');
            tokens.set('create_host_tok', host_Val);
            tokens.set('create_filename_tok', filename_Val);
            tokens.set('create_expected_tok', expected_Val);
        }

    });

    /* --- Search Jobs --- */
    updateSearch.on('search:done', <b>function </b>() {

        fimStatusSearch.startSearch();
        fimAuditSearch.startSearch();

    });

    createSearch.on('search:done', <b>function </b>() {

        fimStatusSearch.startSearch();
        fimAuditSearch.startSearch();
    });
}); require([
    'underscore',
    'jquery',
    'splunkjs/mvc',
    'splunkjs/mvc/tableview',
    'splunkjs/mvc/simplexml/ready!'
], <b>function</b>(_, $, mvc, TableView) {
    <b>var </b>CustomIconRenderer = TableView.BaseCellRenderer.extend({
        canRender: <b>function</b>(cell) {
            <b>return </b>cell.field === 'status';
        },
        render: <b>function</b>($td, cell) {
            <b>var </b>status = cell.value;
            // Compute the icon base on the field value
            <b>var </b>icon;
            <b>if</b>(status > 0) {
                icon = 'check';
            } <b>else </b>{
                icon = 'alert-circle';
            }
            // Create the icon element and add it to the table cell
            $td.addClass('icon-inline numeric').html(_.template('<i class=""icon-<%-icon%>""></i>', {
                icon: icon
            }));
        }
    });
    mvc.Components.get('fim_status').getVisualization(<b>function</b>(tableView){
        // Register custom cell renderer, the table will re-render automatically
        tableView.addCellRenderer(<b>new </b>CustomIconRenderer());
    });
}); require([
    'underscore',
    'backbone',
    'splunkjs/mvc',
    '../app/<app_name>/components/modalview',
    'splunkjs/mvc/searchmanager',
    'splunkjs/mvc/simplexml/ready!'
], <b>function </b>(_, Backbone, mvc, ModalView, SearchManager) {
    <b>var </b>auditSearch = mvc.Components.get('auditSearch');
    <b>var </b>actionSearch = mvc.Components.get('actionSearch');
    <b>var </b>tokens = mvc.Components.get('submitted');
    <b>var </b>fimStatusSearch = mvc.Components.get('fimStatusSearch');
    <b>var </b>fimAuditSearch = mvc.Components.get('fimAuditSearch');

    <b>var </b>fimStatusTable = mvc.Components.get('fim_status');

    $('.actionBtn').on(""click"", <b>function </b>(e) {
        e.preventDefault();
        <b>var </b>_title = ""Confirm Bulk Action"";
        <b>var </b>_message = ""Are you sure you want to complete this action? It will remove all current information in the hashtable! This operation will take 1-2 minutes to complete."";
        //pass the value of the item we clicked on to the title variable
        <b>var </b>modal = <b>new </b>ModalView.show({
            title: _title,
            message: _message,
            callback: <b>function </b>(confirmed) {
                <b>if </b>(!confirmed) <b>return</b>; // early return
                tokens.set('perform_action', 'true');
                actionSearch.startSearch();
                auditSearch.startSearch();

                actionSearch.on('search:done', <b>function </b>() {
                    fimStatusSearch.startSearch();
                });

                auditSearch.on('search:done', <b>function </b>() {

                    fimAuditSearch.startSearch();
                });
            }
        });
    });
}); define([
    'underscore',
    'backbone',
    'jquery'
], <b>function </b>(_, Backbone, $) {


    <b>var </b>modalTemplate = ""<div id=\""pivotModal\"" class=\""modal\"">"" +
        ""<div class=\""modal-header\""><h3><%- title %></h3><button class=\""dtsBtn close\"">Close</button></div>"" +
        ""<div class=\""modal-body\""><h3><%- message %></h3></div>"" +
        ""<div class=\""modal-footer\""><button "" +
        ""class=\""btn-default cancel\"">Cancel</button><button "" +
        ""class=\""btn-primary confirm\"">Confirm</button></div>"" +
        ""</div>"" +
        ""<div class=\""modal-backdrop\""></div>"";

    <b>var </b>ModalView = Backbone.View.extend({

        template: _.template(modalTemplate),
        events: {
            'click .close': 'close',
            'click .cancel': 'close',
            'click .modal-backdrop': 'close',
            'click .confirm': 'confirm',
        },
        initialize: <b>function </b>(options) {
            <b>this</b>.options = _.extend({title: 'Are you sure?', message: 'Please confirm your action'}, options);
        },
        render: <b>function </b>() {
            <b>this</b>.$el.html(<b>this</b>.template(<b>this</b>.options));
            <b>return this</b>;
        },
        show: <b>function </b>() {
            $(document.body).append(<b>this</b>.render().el);
            <b>return this</b>;
        },
        close: <b>function </b>() {
            <b>this</b>.remove();
            <b>var </b>cb = <b>this</b>.options.callback;
            <b>if </b>(cb) cb(<b>false</b>);
        },

        confirm: <b>function </b>() {
            <b>this</b>.remove();
            <b>var </b>cb = <b>this</b>.options.callback;
            <b>if </b>(cb) cb(<b>true</b>);
        }
    }, {
        // Static function
        show: <b>function </b>(options) {
            <b>return new </b>ModalView(options).show();
        }
    });

    <b>return </b>ModalView;
}); /* Custom Icons */
td.icon {
    text-align: center;
}
td.icon i {
    font-size: 25px;
    text-shadow: 1px 1px #aaa;
}
td.icon .severe {
    color: red;
}
td.icon .elevated {
    color: orangered;
}
td.icon .low {
    color: #006400;
}
/* Row Coloring */
#highlight tr td {
    background-color: #c1ffc3 <b>!important</b>;
}
#highlight tr.range-elevated td {
    background-color: #ffc57a <b>!important</b>;
}
#highlight tr.range-severe td {
    background-color: #d59392 <b>!important</b>;
}
#highlight .table td {
    border-top: 1px solid #fff;
}
#highlight td.range-severe, td.range-elevated {
    font-weight: bold;
}
.icon-inline i {
    font-size: 18px;
    margin-left: 5px;
}
.icon-inline i.icon-alert-circle {
    color: #ef392c;
}
.icon-inline i.icon-alert {
    color: #ff9c1a;
}
.icon-inline i.icon-check {
    color: #5fff5e;
}",splunkzilla,2019-02-01,2019-02-02
Windows Account Management Dashboard -,Dashboards,Here is a dashboard that I have built to look at Windows Account Management events.  The dashboard utilizes a drill-down that will feed a multi-select which is using a dynamic search to give you fields that are available for the stats output in 2nd panel dependent on your selection. Add-on’s: Splunk Add-on for Microsoft Windows …,"<form>
  <label>Windows Account Management</label>
  <fieldset submitButton=""false"">
    <input type=""time"" token=""field1"">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <search>
          <query>index=""wineventlog"" source=""WinEventLog:Security"" CategoryString=""Account Management"" | stats count by signature</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">20</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">cell</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
        <drilldown>
          <set token=""sig"">$click.value$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Looking at $sig$</title>
      <input type=""multiselect"" token=""field2"" searchWhenChanged=""true"">
        <label>Field Selection</label>
        <delimiter> </delimiter>
        <fieldForLabel>field</fieldForLabel>
        <fieldForValue>field</fieldForValue>
        <search>
          <query>index=""wineventlog"" source=""WinEventLog:Security"" CategoryString=""Account Management"" signature=""$sig$"" | fieldsummary | where count&gt;0</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <default>host,user</default>
      </input>
      <table>
        <search>
          <query>index=""wineventlog"" source=""WinEventLog:Security"" CategoryString=""Account Management"" signature=""$sig$"" | stats count by _time $field2$</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">none</option>
        <option name=""refresh.display"">progressbar</option>
      </table>
    </panel>
  </row>
</form>",thall,2019-02-08,2019-02-07
Windows service activity & MSI installs -,Dashboards,Here is a dashboard that built to look for Service activity and MSI installs in Windows.  This dashboard utilizes Post Processing so there is only 2 searches that are launched when the dashboard is loaded to minimize impact on search queuing. Add-on’s: Splunk Add-on for Microsoft Windows – https://splunkbase.splunk.com/app/742/ ,"<form>
  <label>Windows service activity &amp; MSI installs</label>
  <search id=""service_base1"">
    <query>index=wineventlog $filter1$ SourceName=""*Service Control Manager"" LogName=System  | fillnull value=* Service_Name, Service_File_Name, Service_Type, Service_Start_Type, Service_Account| stats count by _time, host, Service_Name, Service_File_Name, Service_Type, Service_Start_Type, Service_Account, Message, EventCode</query>
    <earliest>$time1.earliest$</earliest>
    <latest>$time1.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <fieldset submitButton=""true"" autoRun=""false"">
    <input type=""time"" token=""time1"">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type=""text"" token=""filter1"">
      <label>Filter:</label>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Service was installed</title>
      <table>
        <search base=""service_base1"">
          <query>search EventCode=7045 OR EventCode=7035 Service_Name!=tenable_mw_scan | eval Message=split(Message,""."") | eval Short_Message=mvindex(Message,0) | table _time, host, Service_Name, Service_File_Name, Service_Type, Service_Start_Type, Service_Account, Short_Message</query>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Service entered Running/Stopped state</title>
      <table>
        <search base=""service_base1"">
          <query>search EventCode=7036 | stats sum(count) as count by Message</query>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">cell</option>
        <drilldown>
          <set token=""term1"">$click.value$</set>
        </drilldown>
      </table>
      <table>
        <title>Looking at ""$term1$""</title>
        <search>
          <query>index=wineventlog $term1$ SourceName=""*Service Control Manager"" EventCode=7036 | stats count by _time,host</query>
          <earliest>$time1.earliest$</earliest>
          <latest>$time1.latest$</latest>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">none</option>
      </table>
    </panel>
    <panel>
      <title>Service state changes</title>
      <table>
        <search base=""service_base1"">
          <query>search EventCode=7040 Message!=""The start type of the Windows Modules Installer service*"" Message!=""The start type of the Background Intelligent Transfer Service service*"" | stats sum(count) as count by Message</query>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">cell</option>
        <drilldown>
          <set token=""term2"">$click.value$</set>
        </drilldown>
      </table>
      <table>
        <title>Looking at ""$term2$""</title>
        <search>
          <query>index=wineventlog $term2$ SourceName=""*Service Control Manager"" LogName=System EventCode=7040 Message!=""The start type of the Windows Modules Installer service*"" Message!=""The start type of the Background Intelligent Transfer Service service*"" | stats count by _time,host</query>
          <earliest>$time1.earliest$</earliest>
          <latest>$time1.latest$</latest>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Windows service activity</title>
      <table>
        <search base=""service_base1"">
          <query>search EventCode!=7045 EventCode!=7036 EventCode!=7035 | stats sum(count) as count by Message</query>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">cell</option>
        <drilldown>
          <set token=""term3"">$click.value$</set>
        </drilldown>
      </table>
      <table>
        <title>Looking at ""$term3$""</title>
        <search>
          <query>index=wineventlog $term3$ SourceName=""*Service Control Manager"" EventCode!=7045 EventCode!=7036 EventCode!=7035 | fillnull value=* user | stats count by _time,host,user</query>
          <earliest>$time1.earliest$</earliest>
          <latest>$time1.latest$</latest>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>MSI Installs</title>
      <table>
        <search>
          <query>index=wineventlog $filter1$ ""SourceName=MsiInstaller"" NOT EventCode=""1015"" | stats list(Message) by _time,host,User | sort -_time</query>
          <earliest>$time1.earliest$</earliest>
          <latest>$time1.latest$</latest>
        </search>
        <option name=""count"">10</option>
        <option name=""drilldown"">none</option>
        <option name=""refresh.display"">progressbar</option>
      </table>
    </panel>
  </row>
</form>",thall,2019-02-08,2019-02-07
List all ES Correlation Searches -,Enterprise Security,,"| rest splunk_server=local count=0 /services/saved/searches 
| where match('action.correlationsearch.enabled', ""1|[Tt]|[Tt][Rr][Uu][Ee]"") 
| rex field=action.customsearchbuilder.spec ""datamodel\\\"":\s+\\\""(?<Data_Model>\w+)"" 
| rex field=action.customsearchbuilder.spec ""object\\\"":\s+\\\""(?<Dataset>\w+)"" 
| rename
    action.correlationsearch.label as Search_Name
    title as Rule_Name
    eai:acl.app as Application_Context
    request.ui_dispatch_app as UI_Dispatch_Context
    description as Description
    Data_Model as Guided_Mode:Data_Model
    Dataset as Guided_Mode:Dataset
    action.customsearchbuilder.enabled as Guided_Mode
    action.customsearchbuilder.spec as Guided_Mode:Search_Logic
    search as Search
    dispatch.earliest_time as Earliest_Time
    dispatch.latest_time as Latest_Time
    cron_schedule as Cron_Schedule
    schedule_window as Schedule_Window
    schedule_priority as Schedule_Priority
    alert_type as Trigger_Conditions:Trigger_Alert_When
    alert_comparator as Trigger_Conditions:Alert_Comparator
    alert_threshold as Trigger_Conditions:Alert_Threshold
    alert.suppress.period as Throttling:Window_Duration
    alert.suppress.fields as Throttling:Fields_To_Group_By
    action.notable.param.rule_title as Notable:Title
    action.notable.param.rule_description as Notable:Description
    action.notable.param.security_domain as Notable:Security_Domain
    action.notable.param.severity as Notable:Severity
    action.notable.param.default_owner as Notable:Default_Owner
    action.notable.param.default_status as Notable:Default_Status
    action.notable.param.drilldown_name as Notable:Drill-down_Name
    action.notable.param.drilldown_search as Notable:Drill-down_Search
    action.notable.param.drilldown_earliest_offset as Notable:Drill-down_Earliest_Offset
    action.notable.param.drilldown_latest_offset as Notable:drill-down_Latest_Offset
    action.notable.param.next_steps as Notable:Next_Steps
    action.risk.param._risk_score as Risk_Analysis:Risk_Score
    action.risk.param._risk_object as Risk_Analysis:Risk_Object_Field
    action.risk.param._risk_object_type as Risk_Analysis:Risk_Object_Type 
| eval Guided_Mode:Enabled = if(Guided_Mode == 1, ""Yes"", ""No"") 
| eval Real-time_Scheduling_Enabled = if(realtime_schedule == 1, ""Yes"", ""No"") 
| table
    disabled 
    Search_Name,
    Rule_Name,
    Application_Context,
    UI_Dispatch_Context,
    Description,
    Guided_Mode:Enabled,
    Guided_Mode:Data_Model,
    Guided_Mode:Dataset,
    Guided_Mode:Search_Logic,
    Search,
    Earliest_Time,
    Latest_Time,
    Cron_Schedule,
    Real-time_Scheduling_Enabled,
    Schedule_Window,
    Schedule_Priority,
    Trigger_Conditions:Trigger_Alert_When,
    Trigger_Conditions:Alert_Comparator,
    Trigger_Conditions:Alert_Threshold,
    Throttling:Window_Duration,
    Throttling:Fields_To_Group_By,
    Notable:Title,
    Notable:Description,
    Notable:Security_Domain,
    Notable:Severity,
    Notable:Default_Owner,
    Notable:Default_Status,
    Notable:Drill-down_Name,
    Notable:Drill-down_Search,
    Notable:Drill-down_Earliest_Offset,
    Notable:drill-down_Latest_Offset,
    Notable:Next_Steps,
    Risk_Analysis:Risk_Score,
    Risk_Analysis:Risk_Object_Field,
    Risk_Analysis:Risk_Object_Type",akhamis,2019-02-20,2019-02-20
Check your strftime is correct in the props.conf -,eval,"A simple method on checking if your strftime (TIME_FORMAT=) in the props.conf matches your log file timestamp format. strftime(X,Y) This function takes a UNIX time value, X, as the first argument and renders the time as a string using the format specified by Y. The UNIX time must be in seconds. Use the first 10 …","| makeresults
| eval TIME_FORMAT=strftime(_time,""%F,%T,%3N"")",Azeemering,2019-02-28,2019-02-28
Apache Traffic Dashboard -,Dashboards,Description: The following Dashboard is what I use to monitor traffic to GoSplunk. It uses the built in sourcetype of access_combined. No additional add-on’s or TA’s are required. I replaced my index with index=* so it’ll work out of the box. You’ll want to change this to your index for best practices. Also I have …,"<dashboard>
  <label>Web Traffic</label>
  <row>
    <panel>
      <title>Website traffic over time and error rate</title>
      <chart>
        <search>
          <query>index=* sourcetype=""access_combined"" | timechart span=15m count(status) by status</query>
          <earliest>1551243600</earliest>
          <latest>1551330000</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">line</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Views &amp; Visitors</title>
      <chart>
        <search>
          <query>index=* sourcetype=""access_combined"" 
| eval Direct=if(referer=""-"", ""1"", ""0"")
| eval Referred=if(referer!=""-"", ""1"", ""0"")
| timechart span=1d dc(clientip) as ""Unique Visitors"" count as Hits sum(Direct) as ""Direct Traffic"" sum(Referred) as ""Referred Traffic""</query>
          <earliest>-1mon@mon</earliest>
          <latest>@mon</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">area</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">stacked</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Browser Stats</title>
      <chart>
        <search>
          <query>index=* sourcetype=""access_combined"" 
| dedup useragent 
| eval browser=useragent 
| replace *Firefox* with Firefox, *Chrome* with Chrome, *MSIE* with ""Internet Explorer"", *Version*Safari* with Safari, *Opera* with Opera, *rv:11.0* with ""Internet Explorer"" in browser 
| top limit=5 useother=t browser</query>
          <earliest>1551243600</earliest>
          <latest>1551330000</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">pie</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Devices &amp; Platforms</title>
      <chart>
        <search>
          <query>index=* sourcetype=""access_combined"" 
| dedup useragent 
| eval device=useragent 
| replace *Windows* with Windows, *Macintosh* with Apple, *Android* with Android, *iPhone* with iPhone, *iPad* with iPad in device 
| top limit=5 useother=t device</query>
          <earliest>1551243600</earliest>
          <latest>1551330000</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">pie</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Top 10 Referring Domains</title>
      <chart>
        <search>
          <query>index=* sourcetype=""access_combined"" referer!=""-"" referer!=""*gosplunk.com*"" | top limit=10 referer</query>
          <earliest>-1mon@mon</earliest>
          <latest>@mon</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">pie</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">default</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Traffic by IP</title>
      <chart>
        <search>
          <query>index=* sourcetype=""access_combined"" 
| top limit=20 clientip</query>
          <earliest>1551243600</earliest>
          <latest>1551330000</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">pie</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">stacked</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>400 &amp; 500 Errors</title>
      <table>
        <search>
          <query>index=* sourcetype=""access_combined"" status&gt;=400
| iplocation clientip
| stats latest(_time) as Date count(status) as count by uri, status, Country, Region, City
| convert ctime(Date)
| sort - status count</query>
          <earliest>1551243600</earliest>
          <latest>1551330000</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">10</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
        <format type=""color"" field=""Country"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""status"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""uri"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Geographic Visitor Stats</title>
      <map>
        <search>
          <query>index=* sourcetype=""access_combined""
| iplocation clientip
| geostats latfield=lat longfield=lon count</query>
          <earliest>1551243600</earliest>
          <latest>1551330000</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""drilldown"">none</option>
        <option name=""mapping.choroplethLayer.colorBins"">5</option>
        <option name=""mapping.choroplethLayer.colorMode"">auto</option>
        <option name=""mapping.choroplethLayer.maximumColor"">0xaf575a</option>
        <option name=""mapping.choroplethLayer.minimumColor"">0x62b3b2</option>
        <option name=""mapping.choroplethLayer.neutralPoint"">0</option>
        <option name=""mapping.choroplethLayer.shapeOpacity"">0.75</option>
        <option name=""mapping.choroplethLayer.showBorder"">1</option>
        <option name=""mapping.data.maxClusters"">100</option>
        <option name=""mapping.legend.placement"">bottomright</option>
        <option name=""mapping.map.center"">(0,0)</option>
        <option name=""mapping.map.panning"">1</option>
        <option name=""mapping.map.scrollZoom"">0</option>
        <option name=""mapping.map.zoom"">2</option>
        <option name=""mapping.markerLayer.markerMaxSize"">50</option>
        <option name=""mapping.markerLayer.markerMinSize"">10</option>
        <option name=""mapping.markerLayer.markerOpacity"">0.8</option>
        <option name=""mapping.showTiles"">1</option>
        <option name=""mapping.tileLayer.maxZoom"">7</option>
        <option name=""mapping.tileLayer.minZoom"">0</option>
        <option name=""mapping.tileLayer.tileOpacity"">1</option>
        <option name=""mapping.type"">marker</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </map>
    </panel>
  </row>
  <row>
    <panel>
      <title>Traffic by Day</title>
      <chart>
        <title>Previous Month</title>
        <search>
          <query>index=* sourcetype=""access_combined""
| timechart eval(round(sum(bytes)/1024/1024,4)) as Mbytes</query>
          <earliest>-1mon@mon</earliest>
          <latest>@mon</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""charting.axisLabelsX.majorLabelStyle.overflowMode"">ellipsisNone</option>
        <option name=""charting.axisLabelsX.majorLabelStyle.rotation"">0</option>
        <option name=""charting.axisTitleX.visibility"">visible</option>
        <option name=""charting.axisTitleY.visibility"">visible</option>
        <option name=""charting.axisTitleY2.visibility"">visible</option>
        <option name=""charting.axisX.abbreviation"">none</option>
        <option name=""charting.axisX.scale"">linear</option>
        <option name=""charting.axisY.abbreviation"">none</option>
        <option name=""charting.axisY.scale"">linear</option>
        <option name=""charting.axisY2.abbreviation"">none</option>
        <option name=""charting.axisY2.enabled"">0</option>
        <option name=""charting.axisY2.scale"">inherit</option>
        <option name=""charting.chart"">column</option>
        <option name=""charting.chart.bubbleMaximumSize"">50</option>
        <option name=""charting.chart.bubbleMinimumSize"">10</option>
        <option name=""charting.chart.bubbleSizeBy"">area</option>
        <option name=""charting.chart.nullValueMode"">gaps</option>
        <option name=""charting.chart.showDataLabels"">none</option>
        <option name=""charting.chart.sliceCollapsingThreshold"">0.01</option>
        <option name=""charting.chart.stackMode"">stacked</option>
        <option name=""charting.chart.style"">shiny</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">0</option>
        <option name=""charting.layout.splitSeries.allowIndependentYRanges"">0</option>
        <option name=""charting.legend.labelStyle.overflowMode"">ellipsisMiddle</option>
        <option name=""charting.legend.mode"">standard</option>
        <option name=""charting.legend.placement"">right</option>
        <option name=""charting.lineWidth"">2</option>
        <option name=""trellis.enabled"">0</option>
        <option name=""trellis.scales.shared"">1</option>
        <option name=""trellis.size"">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Data Consumers with Geographic Information</title>
      <table>
        <search>
          <query>index=* sourcetype=""access_combined""
| stats sum(bytes) as bytes by clientip
| iplocation clientip
| eval MB=round(bytes/1024/1024,4)
| fields clientip Country Region City MB
| sort - MB</query>
          <earliest>1551243600</earliest>
          <latest>1551330000</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">10</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">none</option>
        <option name=""percentagesRow"">false</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
        <format type=""color"" field=""Country"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""status"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
        <format type=""color"" field=""uri"">
          <colorPalette type=""sharedList""></colorPalette>
          <scale type=""sharedCategory""></scale>
        </format>
      </table>
    </panel>
  </row>
</dashboard>",SplunkNinja,2019-03-04,2019-03-04
Internal Splunk User Stats -,_internal,"This simple Splunk query will show us unique Splunk user logged into Splunk per day, as well as total count of log-ons. ",index=_audit info=succeeded | timechart span=1d dc(user) as unique_users count(user) as logons_all_users,SplunkNinja,2019-03-05,2019-03-05
Successful File Access Attempts and Filename Accessed -,WinEventLog:Security,Ever need to find when a user accessed a file within a Windows environment? The following Splunk query will show successful file accesses by each user for a given day. Depending on the size of your environment this can get out of hand quickly. You’ll want to tweak to best fit your environment. *Note* you …,"sourcetype=WinEventLog (Relative_Target_Name!=""\\"""""" Relative_Target_Name!=""*.ini"") user!=""*$"" | bucket span=1d _time | stats count by Relative_Target_Name, user, _time, status | rename _time as Day | convert ctime(Day) sourcetype=WinEventLog EventCode=5140 user!=""*$"" Share_Path=""*"" | stats count by Share_Path, user, host, _time | sort - user",SplunkNinja,2019-03-20,2019-03-20
Dashboard and App views by user -,_internal,This Splunk query / search shows historical access to dashboards and apps on a local splunk server. ,"index=_internal sourcetype=splunk_web_access host=* user=*
| rex field=uri_path "".*/(?<title>[^/]*)$"" 
| join title
[| rest /servicesNS/-/-/data/ui/views splunk_server=*
| search isDashboard=1 isVisible=1 
| rename eai:acl.app as app 
| fields title app ]
| rename title as dashboard
| stats count by _time user dashboard app host",john117,2018-11-24,2019-03-22
Windows RDP sessions -,Dashboards,Here is a dashboard I built to look at Windows Logon Type 2 & 10 (remote & remote interactive) that will help identify which users access which servers and how many times.  Also when you click on a user it will run a 30 day search and a 24 hour search that produces a column …,"<form>
  <label>Windows RDP sessions</label>
  <description>Logon Type 2 and 10 events</description>
  <fieldset submitButton=""true"">
    <input type=""time"" token=""time1"">
      <label>Select a Time:</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type=""text"" token=""field1"">
      <label>Filter:</label>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Panels have been filtered to show: $field1$</title>
      <table>
        <search>
          <query>index=wineventlog $field1$ source=WinEventLog:Security EventCode=""4624"" Logon_Type=""2"" OR Logon_Type=""10"" | fillnull value=* Source_Network_Address | stats count by host Source_Network_Address Logon_Type user | eval bar=""(""+count+"") ""+Source_Network_Address | eval bar_host=""(""+count+"") ""+host| stats list(bar) values(bar_host) by  user Logon_Type</query>
          <earliest>$time1.earliest$</earliest>
          <latest>$time1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name=""count"">20</option>
        <option name=""dataOverlayMode"">none</option>
        <option name=""drilldown"">cell</option>
        <option name=""percentagesRow"">false</option>
        <option name=""refresh.display"">progressbar</option>
        <option name=""rowNumbers"">false</option>
        <option name=""totalsRow"">false</option>
        <option name=""wrap"">true</option>
        <drilldown>
          <set token=""user"">$click.value$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Looking at $user$</title>
      <chart>
        <search>
          <query>index=wineventlog $field1$ EventCode=4624 Logon_Type=2 OR Logon_Type=10 earliest=-30d@d latest=-24h user=$user$ | fields _time | timechart count span=1h | eval hour = strftime(_time,""%H"") | stats sum(count) as 30day by hour | join type=outer hour [search index=wineventlog $field1$ EventCode=4624 Logon_Type=2 OR Logon_Type=10 earliest=-24h user=$user$ | fields _time | timechart count span=1h | eval hour = strftime(_time,""%H"") | stats sum(count) as 24h by hour]</query>
          <earliest>$time1.earliest$</earliest>
          <latest>$time1.latest$</latest>
        </search>
        <option name=""charting.chart"">column</option>
        <option name=""charting.chart.stackMode"">stacked</option>
        <option name=""charting.drilldown"">none</option>
        <option name=""charting.layout.splitSeries"">1</option>
        <option name=""refresh.display"">progressbar</option>
      </chart>
    </panel>
  </row>
</form>",thall,2019-04-01,2019-04-01
Utilizing tstats for Page Views within Apache Web Logs -,access_combined,"Here’s a Splunk query to show a timechart of page views from a website running on Apache. Due to the search utilizing tstats, the query will return results incredibly fast over a very LONG period of time if desired. Change the index to reflect yours, as well as the span to reflect a span you …","|tstats count as hits where index=* sourcetype=""access_combined"" by _time
| timechart span=1month sum(hits) as Views |tstats count as hits where index=* sourcetype=""access_combined"" by _time
| timechart span=1month sum(hits) as Views
| predict Views",SplunkNinja,2019-04-01,2019-04-01
Regex Extraction for WordPress Version from Apache Logs -,apache,The following Splunk search extracts the WordPress version from your Apache Web Logs. For fun I also did a time chart using 100% stacked bar chart to show by month each version of wordpress used. This was actually a pretty neat display of colors to show the upgrade path of WordPress over the years! I …,"sourcetype=""access_combined"" | rex ""\""WordPress\/(?P<WP_version>.+?(?=;))"" | where isnotnull(WP_version) | timechart span=1month count by WP_version limit=0 useother=0",SplunkNinja,2019-04-02,2019-04-02
Hard Disk Usage and Information on Splunk Server -,REST,"The following Splunk Query will utilize a “| REST” call to gather information related to disk usage on your Splunk server(s). The following has been modified from the “Distributed Management Console” to be more generic for a copy, paste, and search example.   ","| rest splunk_server=* /services/server/status/partitions-space | eval free = if(isnotnull(available), available, free) | eval usage = round((capacity - free) / 1024, 2) | eval capacity = round(capacity / 1024, 2) | eval compare_usage = usage."" / "".capacity | eval pct_usage = round(usage / capacity * 100, 2) | stats first(fs_type) as fs_type first(compare_usage) as compare_usage first(pct_usage) as pct_usage by mount_point, splunk_server | rename mount_point as ""Mount Point"", fs_type as ""File System Type"", compare_usage as ""Disk Usage (GB)"", capacity as ""Capacity (GB)"", pct_usage as ""Disk Usage (%)"" splunk_server as ""Splunk Server"" | sort - ""Splunk Server""",SplunkNinja,2016-04-22,2019-04-02
find blocking queues -,Monitoring,Blocked queues are (obviously) bad for your environment so here a search to identify those: ,"index=_internal sourcetype=splunkd group=queue (name=parsingQueue OR name=indexqueue OR name=tcpin_queue OR name=aggqueue) 
| eval is_blocked=if(blocked==""true"",1,0), host_queue=host."" - "".name
| stats sparkline sum(is_blocked) as blocked,count by host_queue
| eval blocked_ratio=round(blocked/count*100,2)
| sort 20 -blocked_ratio
| eval requires_attention=case(blocked_ratio>50.0,""fix highly recommended!"",blocked_ratio>40.0,""you better check.."",blocked_ratio>20.0,""usually no need to worry but keep an eye on it"",1=1,""not unusual"")",sedi,2019-04-08,2019-04-08
skipped searches and why -,_internal,Quickly identify high amounts of skipped searches in your cluster or standalone SH(s): ,"index = _internal skipped sourcetype=scheduler status=skipped host=[your splunk SH(s)] 
| stats count by app search_type reason savedsearch_name 
| sort -count",sedi,2019-04-09,2019-04-09
"List permissions for Users, roles, allowed indexes and indexes searched by default -",Uncategorized,Ok that one is a big one so be prepared ;) The following will (on a SH / SH Cluster): list all users and their roles list inherited roles list all indexes allowed by the shown roles list all indexes allowed for inherited roles (one level!) inherited allowed indexes will show the originator (which inherited …,"| rest splunk_server=local /services/authentication/users | rename title as username | mvexpand roles | table realname, username, roles, email 
| join type=outer roles [ rest splunk_server=local /services/authorization/roles | rename title as roles | eval ir=imported_roles | search srchIndexesAllowed=* | fields roles imported_roles ir srchIndexesAllowed srchIndexesDefault | mvexpand ir]
| foreach srchIndexesAllowed
[ eval srchIndexesAllowed=replace(<<FIELD>>,""^_\*$"",""[all internal indexes];"") 
| eval srchIndexesAllowed=replace(<<FIELD>>,""\*\s_\*"",""[all internal and non-internal indexes];"")
| eval srchIndexesAllowed=replace(<<FIELD>>,""\*\s"",""[all non-internal indexes];"")
| eval srchIndexesAllowed=replace(<<FIELD>>,""\*$"",""[all non-internal indexes];"") 
]
| foreach srchIndexesDefault
[ eval srchIndexesDefault=replace(<<FIELD>>,""_\*"",""[all internal indexes];"") 
| eval srchIndexesDefault=replace(<<FIELD>>,""\*\s_\*"",""[all internal and non-internal indexes];"")
| eval srchIndexesDefault=replace(<<FIELD>>,""\*\s"",""[all non-internal indexes];"") 
| eval srchIndexesDefault=replace(<<FIELD>>,""\*$"",""[all non-internal indexes];"")
]
| join type=outer ir
[ | rest splunk_server=local /services/authorization/roles | fields - imported_roles
| rename title as ir
| mvexpand srchIndexesAllowed
| eval inheritedAllowed=if(idxtype==""Invalid"","""",srchIndexesAllowed."" (by "".ir."");"")
| stats values(inheritedAllowed) as inheritedAllowed by ir ]
| fields - ir, splunk_server
| makemv allowempty=t inheritedAllowed delim="";"" 
| makemv allowempty=t srchIndexesAllowed delim="";""
| makemv allowempty=t srchIndexesDefault delim="";""
| rename srchIndexesDefault TO ""Searched by default"", srchIndexesAllowed TO ""AllowedIndexes by Role"", inheritedAllowed TO ""AllowedIndexes by Inheritance"", imported_roles TO ""Inherited Roles"" | rest splunk_server=local /services/authentication/users | rename title as username | mvexpand roles | table realname, username, roles, email 
| join type=outer roles [ rest splunk_server=local /services/authorization/roles | rename title as roles | eval ir=imported_roles | search srchIndexesAllowed=* | fields roles imported_roles ir srchIndexesAllowed srchIndexesDefault | mvexpand ir]
| foreach srchIndexesAllowed
[ eval srchIndexesAllowed=replace(<<FIELD>>,""^_\*$"",""[all internal indexes];"") 
| eval srchIndexesAllowed=replace(<<FIELD>>,""\*\s_\*"",""[all internal and non-internal indexes];"")
| eval srchIndexesAllowed=replace(<<FIELD>>,""\*\s"",""[all non-internal indexes];"")
| eval srchIndexesAllowed=replace(<<FIELD>>,""\*$"",""[all non-internal indexes];"") 
]
| foreach srchIndexesDefault
[ eval srchIndexesDefault=replace(<<FIELD>>,""_\*"",""[all internal indexes];"") 
| eval srchIndexesDefault=replace(<<FIELD>>,""\*\s_\*"",""[all internal and non-internal indexes];"")
| eval srchIndexesDefault=replace(<<FIELD>>,""\*\s"",""[all non-internal indexes];"") 
| eval srchIndexesDefault=replace(<<FIELD>>,""\*$"",""[all non-internal indexes];"")
]
| join type=outer ir
[ | rest splunk_server=local /services/authorization/roles | fields - imported_roles
| rename title as ir
| mvexpand srchIndexesAllowed
| eval inheritedAllowed=if(idxtype==""Invalid"","""",srchIndexesAllowed."" (by "".ir."");"")
| stats values(inheritedAllowed) as inheritedAllowed by ir ]
| fields - ir, splunk_server
| makemv allowempty=t inheritedAllowed delim="";"" 
| makemv allowempty=t srchIndexesAllowed delim="";""
| makemv allowempty=t srchIndexesDefault delim="";""
| search (srchIndexesDefault=""[all internal and non-internal indexes]*"" OR srchIndexesDefault=""[all non-internal indexes]*"") AND (srchIndexesAllowed=""[all internal and non-internal indexes]*"" OR srchIndexesAllowed=""[all non-internal indexes]*"")
| rename srchIndexesDefault TO ""Searched by default"", srchIndexesAllowed TO ""AllowedIndexes by Role"", inheritedAllowed TO ""AllowedIndexes by Inheritance"", imported_roles TO ""Inherited Roles""",sedi,2018-08-30,2019-04-10
Find unused dashboards -,_internal,Use this search to find unused dashboards: ,"| rest /servicesNS/-/-/data/ui/views splunk_server=* 
| search isDashboard=1 
| rename eai:acl.app as app 
| fields title app 
| join type=left title 
[| search index=_internal sourcetype=splunk_web_access host=* user=* 
| rex field=uri_path "".*/(?<title>[^/]*)$"" 
| stats latest(_time) as Time latest(user) as user by title
] 
| where isnotnull(Time) 
| eval Now=now() 
| eval ""Days since last accessed""=round((Now-Time)/86400,2) 
| sort - ""Days since last accessed"" 
| convert ctime(Time) 
| fields - Now",Azeemering,2019-04-16,2019-04-17
"$title$","$sourcetype$","$description$","$query$",kdor,"2019-04-25","2019-04-25"
